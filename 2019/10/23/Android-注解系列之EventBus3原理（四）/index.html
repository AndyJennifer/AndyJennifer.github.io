<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/bangbangtang-32*32.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/bangbangtang-16*16.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="å‰è¨€åœ¨ä¹‹å‰çš„æ–‡ç«  Android æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† APT æŠ€æœ¯çš„åŠå…¶ä½¿ç”¨æ–¹å¼ï¼Œä¹Ÿæåˆ°äº†ä¸€äº›çŸ¥åçš„å¼€æºæ¡†æ¶å¦‚ Dagger2ã€ButterKnifeã€EventBus éƒ½ä½¿ç”¨äº†è¯¥æŠ€æœ¯ã€‚ä¸ºäº†è®©å¤§å®¶æ›´å¥½çš„äº†è§£ APT æŠ€æœ¯çš„ä½¿ç”¨ï¼Œåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­æˆ‘å°†ä¼šç€é‡å¸¦é¢†å¤§å®¶æ¥äº†è§£ EventBus ä¸­ APT æŠ€æœ¯çš„ä½¿ç”¨ï¼Œåœ¨äº†è§£è¯¥çŸ¥è¯†ä¹‹å‰ï¼Œéœ€è¦æˆ‘ä»¬å¯¹ EventBus å†…éƒ¨åŸç†è¾ƒä¸ºç†Ÿæ‚‰">
<meta name="keywords" content="EventBus">
<meta property="og:type" content="article">
<meta property="og:title" content="Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰">
<meta property="og:url" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/index.html">
<meta property="og:site_name" content="AndyJennifer&#39;Blog">
<meta property="og:description" content="å‰è¨€åœ¨ä¹‹å‰çš„æ–‡ç«  Android æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† APT æŠ€æœ¯çš„åŠå…¶ä½¿ç”¨æ–¹å¼ï¼Œä¹Ÿæåˆ°äº†ä¸€äº›çŸ¥åçš„å¼€æºæ¡†æ¶å¦‚ Dagger2ã€ButterKnifeã€EventBus éƒ½ä½¿ç”¨äº†è¯¥æŠ€æœ¯ã€‚ä¸ºäº†è®©å¤§å®¶æ›´å¥½çš„äº†è§£ APT æŠ€æœ¯çš„ä½¿ç”¨ï¼Œåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­æˆ‘å°†ä¼šç€é‡å¸¦é¢†å¤§å®¶æ¥äº†è§£ EventBus ä¸­ APT æŠ€æœ¯çš„ä½¿ç”¨ï¼Œåœ¨äº†è§£è¯¥çŸ¥è¯†ä¹‹å‰ï¼Œéœ€è¦æˆ‘ä»¬å¯¹ EventBus å†…éƒ¨åŸç†è¾ƒä¸ºç†Ÿæ‚‰">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/bus.jpg">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/EventBus-Publish-Subscribe.png">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/EventBusç²—æš´ç†è§£.jpg">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/subscribe()å®é™…åšçš„äº‹.jpg">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/PositingThreadStateä¸çº¿ç¨‹çš„å…³ç³».jpg">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/ç®€å•äº‹ä»¶çš„å‘é€.jpg">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/ç®€å•äº‹ä»¶å‘é€çš„æ•´ä¸ªæµç¨‹.jpg">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/è®¢é˜…æ–¹æ³•è§„åˆ™.png">
<meta property="og:updated_time" content="2019-10-22T16:17:31.078Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰">
<meta name="twitter:description" content="å‰è¨€åœ¨ä¹‹å‰çš„æ–‡ç«  Android æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† APT æŠ€æœ¯çš„åŠå…¶ä½¿ç”¨æ–¹å¼ï¼Œä¹Ÿæåˆ°äº†ä¸€äº›çŸ¥åçš„å¼€æºæ¡†æ¶å¦‚ Dagger2ã€ButterKnifeã€EventBus éƒ½ä½¿ç”¨äº†è¯¥æŠ€æœ¯ã€‚ä¸ºäº†è®©å¤§å®¶æ›´å¥½çš„äº†è§£ APT æŠ€æœ¯çš„ä½¿ç”¨ï¼Œåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­æˆ‘å°†ä¼šç€é‡å¸¦é¢†å¤§å®¶æ¥äº†è§£ EventBus ä¸­ APT æŠ€æœ¯çš„ä½¿ç”¨ï¼Œåœ¨äº†è§£è¯¥çŸ¥è¯†ä¹‹å‰ï¼Œéœ€è¦æˆ‘ä»¬å¯¹ EventBus å†…éƒ¨åŸç†è¾ƒä¸ºç†Ÿæ‚‰">
<meta name="twitter:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/bus.jpg">






  <link rel="canonical" href="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰ | AndyJennifer'Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">AndyJennifer'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">What would life be if we had no courage to attempt anything?</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/AndyJennifer" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="AndyJennifer">
      <meta itemprop="description" content="AndyJennifer ä¸ªäººç«™ï¼Œä¸»è¦æ¶‰åŠAndroidã€Javaã€Kotlinç­‰ç›¸å…³çŸ¥è¯†ï¼Œæ„¿ä¸å¤§å®¶å…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥">
      <meta itemprop="image" content="http://upload-images.jianshu.io/upload_images/2824145-e320240ea6ec767d.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AndyJennifer'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-10-23 00:17:31" itemprop="dateCreated datePublished" datetime="2019-10-23T00:17:31+08:00">2019-10-23</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/æºç åˆ†æ/" itemprop="url" rel="index"><span itemprop="name">æºç åˆ†æ</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             é˜…è¯»æ¬¡æ•°ï¼š 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">29k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">52 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/bus.jpg" title="bus">
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨ä¹‹å‰çš„æ–‡ç«  <a href="/2019/02/23/Android-æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)/" title="Android æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)">Android æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† APT æŠ€æœ¯çš„åŠå…¶ä½¿ç”¨æ–¹å¼ï¼Œä¹Ÿæåˆ°äº†ä¸€äº›çŸ¥åçš„å¼€æºæ¡†æ¶å¦‚ <a href="https://github.com/google/dagger" target="_blank" rel="noopener">Dagger2</a>ã€<a href="https://github.com/JakeWharton/butterknife" target="_blank" rel="noopener">ButterKnife</a>ã€<a href="https://github.com/greenrobot/EventBus" target="_blank" rel="noopener">EventBus</a> éƒ½ä½¿ç”¨äº†è¯¥æŠ€æœ¯ã€‚ä¸ºäº†è®©å¤§å®¶æ›´å¥½çš„äº†è§£ APT æŠ€æœ¯çš„ä½¿ç”¨ï¼Œåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­æˆ‘å°†ä¼šç€é‡å¸¦é¢†å¤§å®¶æ¥äº†è§£ EventBus ä¸­ APT æŠ€æœ¯çš„ä½¿ç”¨ï¼Œåœ¨äº†è§£è¯¥çŸ¥è¯†ä¹‹å‰ï¼Œéœ€è¦æˆ‘ä»¬å¯¹ EventBus å†…éƒ¨åŸç†è¾ƒä¸ºç†Ÿæ‚‰ï¼Œå¦‚æœä½ å·²ç»ç†Ÿæ‚‰å…¶å†…éƒ¨æœºåˆ¶äº†ï¼Œå¯ä»¥è·³è¿‡è¯¥ç¯‡æ–‡ç« ï¼Œç›´æ¥é˜…è¯»ç›´æ¥é˜…è¯» <a href="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/" title="Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€åŠ é€Ÿå¼•æ“â€œï¼ˆäº”ï¼‰">Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€åŠ é€Ÿå¼•æ“â€œï¼ˆäº”ï¼‰</a></p>
<p>é˜…è¯»è¯¥ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå­¦åˆ°å¦‚ä¸‹çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li>EventBus3 å†…éƒ¨åŸç†</li>
<li>EventBus3 è®¢é˜…ä¸å‘é€æ¶ˆæ¯åŸç†</li>
<li>EventBus3 çº¿ç¨‹åˆ‡æ¢çš„åŸç†</li>
<li>EventBus3 ç²˜æ€§äº‹ä»¶çš„å¤„ç†</li>
</ul>
<blockquote>
<p>æ•´ç¯‡æ–‡ç« ç»“åˆ EventBus 3.1.1 ç‰ˆæœ¬è¿›è¡Œè®²è§£ã€‚</p>
</blockquote>
<h3 id="EventBus-ç®€ä»‹"><a href="#EventBus-ç®€ä»‹" class="headerlink" title="EventBus ç®€ä»‹"></a>EventBus ç®€ä»‹</h3><p>EventBus å¯¹äº Android ç¨‹åºå‘˜æ¥è¯´åº”è¯¥ä¸æ˜¯å¾ˆé™Œç”Ÿï¼Œå®ƒæ˜¯åŸºäºè§‚å¯Ÿè€…æ¨¡å¼çš„äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¡†æ¶ï¼Œæˆ‘ä»¬å¸¸å¸¸ç”¨å®ƒæ¥å®ç°ä¸åŒç»„ä»¶çš„é€šè®¯ï¼Œåå°çº¿ç¨‹é€šä¿¡ç­‰ã€‚</p>
<img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/EventBus-Publish-Subscribe.png" title="EventBus-Publish-Subscribe">
<p>è™½ç„¶ EventBus éå¸¸ç®€å•å¥½ç”¨ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šå› ä¸º EventBus æ»¡å¤©é£ï¼Œä½¿ç¨‹åºä»£ç ç»“æ„éå¸¸æ··ä¹±ï¼Œéš¾ä»¥æµ‹è¯•å’Œè¿½è¸ªã€‚å³ä½¿ EventBus æœ‰å¾ˆå¤šè¯Ÿç—…ï¼Œä½†ä»ç„¶ä¸å½±å“æˆ‘ä»¬å»å­¦ä¹ å…¶ä¸­çš„åŸç†ä¸ç¼–ç¨‹æ€æƒ³~</p>
<h3 id="å¤§æ¦‚æµç¨‹"><a href="#å¤§æ¦‚æµç¨‹" class="headerlink" title="å¤§æ¦‚æµç¨‹"></a>å¤§æ¦‚æµç¨‹</h3><p>åœ¨äº†è§£ EventBus å†…éƒ¨åŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ EventBus æ¡†æ¶çš„ä¸€ä¸ªå¤§æ¦‚æµç¨‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/EventBusç²—æš´ç†è§£.jpg" title="EventBusç²—æš´ç†è§£">
<blockquote>
<p>ä¸Šå›¾ä¸­<code>ç»¿è‰²</code>ä¸ºè®¢é˜…æµç¨‹ï¼Œ<code>çº¢è‰²</code>ä¸ºå‘é€äº‹ä»¶æµç¨‹ï¼Œå¤§å®¶å¯ä»¥ç»“åˆä¸Šå›¾ï¼Œæ¥ç†è§£æºç ã€‚</p>
</blockquote>
<p>åœ¨ä¸Šå›¾ä¸­æˆ‘ä»¬åœ¨ <code>A.java</code> ä¸­è®¢é˜…äº†äº‹ä»¶ <code>AEvent</code>ï¼Œåœ¨ <code>B.java</code> ä¸­è®¢é˜…äº†äº‹ä»¶ <code>AEvent</code> ä¸ <code>BEvent</code>ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æ EventBus ä¸­æ³¨å†Œä¸äº‹ä»¶å‘é€çš„ä¸¤ä¸ªæµç¨‹ï¼Œåœ¨ä»‹ç»ä¸¤ä¸ªæµç¨‹ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸‹ <code>Subscription</code> ä¸ <code>SubscriberMethod</code> ä¸­æ‰€åŒ…å«çš„å†…å®¹ã€‚</p>
<p><code>Subscription</code> ç±»ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>å½“å‰æ³¨å†Œå¯¹è±¡</li>
<li>å¯¹åº”è®¢é˜…æ–¹æ³•çš„å°è£…å¯¹è±¡ SubscriberMethod</li>
</ul>
<p><code>SubscriberMethod</code> ç±»ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>åŒ…å« <code>@Subscribe</code> æ³¨è§£çš„æ–¹æ³•çš„ Method (<code>java.lang.reflect</code> åŒ…ä¸‹çš„å¯¹è±¡)ã€‚</li>
<li><code>@Subscribe</code> æ³¨è§£ä¸­è®¾ç½®çš„çº¿ç¨‹æ¨¡å¼ ThreadMode</li>
<li>æ–¹æ³•çš„æ³¨å†Œçš„äº‹ä»¶ç±»å‹çš„ Class å¯¹è±¡</li>
<li><code>@Subscribe</code>ä¸­è®¾ç½®çš„ä¼˜å…ˆçº§ priority</li>
<li><code>@Subscribe</code>ä¸­è®¾ç½®äº‹ä»¶æ˜¯å¦æ˜¯ç²˜æ€§äº‹ä»¶ sticky</li>
</ul>
<h4 id="æ³¨å†Œæµç¨‹"><a href="#æ³¨å†Œæµç¨‹" class="headerlink" title="æ³¨å†Œæµç¨‹"></a>æ³¨å†Œæµç¨‹</h4><p>å½“æˆ‘ä»¬é€šè¿‡è°ƒç”¨ EventBus.register() æ³¨å†Œ Aã€B ä¸¤ä¸ªå¯¹è±¡æ—¶ï¼ŒEventBus ä¼šåšä»¥ä¸‹å‡ ä»¶äº‹ä»¶ï¼š</p>
<ul>
<li>é€šè¿‡å†…éƒ¨çš„ <code>SubscriberMethodFinder</code> æ¥è·å– Aã€Bç±»ä¸­å«æœ‰ <code>@Subscribe</code> æ³¨è§£çš„æ–¹æ³•ï¼Œå¹¶å°†è¯¥æ³¨è§£ä¸­çš„å†…å®¹ä¸å¯¹åº”æ–¹æ³•å°è£…ä¸º <code>SubscriberMethod</code> å¯¹è±¡ã€‚ç„¶åå†å°†å½“å‰è®¢é˜…å¯¹è±¡ä¸å¯¹åº”çš„ <code>SubscriberMethod</code> å†å°è£…ä¸º <code>Subscription</code> å¯¹è±¡ã€‚</li>
<li>å°†æ‰€æœ‰çš„ <code>Subscription</code> æ”¾åœ¨åä¸º <code>subscriptionsByEventType</code> ç±»å‹ä¸º <code>Map&lt;Class&lt;?&gt;, CopyOnWriteArrayList&lt;Subscription&gt;&gt;</code> æ•°æ®ç»“æ„ï¼ˆkey ä¸ºäº‹ä»¶ç±»å‹çš„ Class å¯¹è±¡ï¼‰ ä¸­ï¼Œå› ä¸º <code>Subscription</code> å¯¹è±¡å†…éƒ¨åŒ…å« <code>SubscriberMethod</code>ï¼Œ é‚£ä¹ˆå°±èƒ½çŸ¥é“è®¢é˜…çš„äº‹ä»¶ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®äº‹ä»¶ç±»å‹æ¥åŒºåˆ† <code>Subscription</code> ï¼Œåˆå› ä¸ºç›¸åŒäº‹ä»¶å¯ä»¥è¢«ä¸åŒè®¢é˜…è€…ä¸­çš„æ–¹æ³•æ¥è®¢é˜…ï¼Œæ‰€ä»¥ç›¸åŒç±»å‹çš„äº‹ä»¶ä¹Ÿå°±ä»¥å¯¹åº”ä¸åŒçš„ <code>Subscription</code>ã€‚</li>
<li>å°†è®¢é˜…è€…ä¸­çš„æ‰€æœ‰è®¢é˜…çš„äº‹ä»¶éƒ½å°è£…åœ¨åä¸º <code>typesBySubscriber</code> ç±»å‹ä¸º <code>Map&lt;Object, List&lt;Class&lt;?&gt;&gt;&gt;</code>æ•°æ®ç»“æ„ï¼ˆkey ä¸ºè®¢é˜…å¯¹è±¡ï¼Œvalue ä¸ºè¯¥å¯¹è±¡è®¢é˜…çš„äº‹ä»¶ç±»å‹ Class å¯¹è±¡ï¼‰ã€‚è¯¥é›†åˆä¸»è¦ç”¨äºå–æ¶ˆè®¢é˜…ï¼Œåœ¨ä¸‹æ–‡ä¸­æˆ‘ä»¬ä¼šè¿›è¡Œä»‹ç»ã€‚</li>
</ul>
<p>åœ¨æ•´ä¸ªæ³¨å†Œæµç¨‹ä¸­ï¼Œæœ€ä¸»è¦çš„æµç¨‹å°±æ˜¯ EventBus é€šè¿‡ <code>SubscriberMethodFinder</code> å»è·å–ç±»ä¸­åŒ…å« <code>@Subscribe</code> æ³¨è§£çš„è®¢é˜…æ–¹æ³•ã€‚åœ¨ EventBus 3.0 ä¹‹å‰è¯¥æµç¨‹ä¸€ç›´éƒ½æ˜¯é€šè¿‡<code>åå°„</code>çš„æ–¹å¼å»è·å–ã€‚åœ¨ 3.0 åŠä»¥åç‰ˆæœ¬ï¼ŒEventBus é‡‡ç”¨äº† APT æŠ€æœ¯ï¼Œå¯¹ <code>SubscriberMethodFinder</code> æŸ¥æ‰¾è®¢é˜…æ–¹æ³•æµç¨‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½¿å…¶èƒ½åœ¨ <code>EventBus.register()</code> æ–¹æ³•è°ƒç”¨ä¹‹å‰å°±èƒ½çŸ¥é“ç›¸å…³è®¢é˜…äº‹ä»¶çš„æ–¹æ³•ï¼Œè¿™æ ·å°±å‡å°‘äº†ç¨‹åºåœ¨è¿è¡ŒæœŸé—´ä½¿ç”¨åå°„éå†è·å–æ–¹æ³•æ‰€å¸¦æ¥çš„æ—¶é—´æ¶ˆè€—ã€‚åœ¨ä¸‹æ–‡ä¸­æˆ‘ä»¬ä¹Ÿä¼šæŒ‡å‡ºå…·ä½“çš„ä¼˜åŒ–ç‚¹ã€‚</p>
<h4 id="äº‹ä»¶å‘é€æµç¨‹"><a href="#äº‹ä»¶å‘é€æµç¨‹" class="headerlink" title="äº‹ä»¶å‘é€æµç¨‹"></a>äº‹ä»¶å‘é€æµç¨‹</h4><p>çŸ¥é“äº† EventBus çš„æ³¨å†Œè¿‡ç¨‹ï¼Œå†æ¥äº†è§£äº‹ä»¶çš„å‘ç”Ÿæµç¨‹å°±éå¸¸ç®€å•äº†ã€‚å› ä¸ºæˆ‘ä»¬å·²ç»é€šè¿‡ <code>subscriptionsByEventType</code> å­˜å‚¨äº‹ä»¶å¯¹åº”çš„ <code>Subscription</code>ï¼Œåªè¦æ‰¾åˆ°äº† <code>Subscription</code> ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½ä» <code>Subscription</code> æ‹¿åˆ°è®¢é˜…äº‹ä»¶çš„å¯¹è±¡ <code>subscriber</code> ï¼Œä»¥åŠå¯¹åº”çš„è®¢é˜…æ–¹æ³• Method (<code>java.lang.reflect</code> åŒ…ä¸‹çš„å¯¹è±¡)ã€‚ç„¶åé€šè¿‡åå°„è°ƒç”¨ï¼š</p>
<blockquote>
<p>Subscription å†…éƒ¨åŒ…å«è®¢é˜…è€…åŠ SubscriberMethodï¼ˆå†…éƒ¨åŒ…å«è®¢é˜…æ–¹æ³• Method )</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> method.invoke(subscription.subscriber, event)</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå°±èƒ½å°†å¯¹åº”äº‹ä»¶å‘é€åˆ°ç›¸å…³è®¢é˜…è€…äº†ã€‚å½“ç„¶è¿™é‡Œåªæ˜¯ç®€å•çš„ä»‹ç»äº†äº‹ä»¶æ˜¯å¦‚ä½•å‘é€åˆ°ç›¸å…³è®¢é˜…è€…çš„ã€‚å…³äº EventBus ä¸­ç²˜æ€§äº‹ä»¶çš„å¤„ç†ï¼Œçº¿ç¨‹å¦‚ä½•åˆ‡æ¢ã€‚ä¼šåœ¨ä¸‹æ–‡ä¸­è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p>
<h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>åœ¨äº†è§£äº† EventBus çš„å†…éƒ¨å¤§æ¦‚æµç¨‹åï¼Œç°åœ¨æˆ‘ä»¬é€šè¿‡æºç æ¥æ›´æ·±å±‚æ¬¡çš„äº†è§£å…¶å†…éƒ¨å®ç°ã€‚è¿˜æ˜¯ä»è®¢é˜…è¿‡ç¨‹ä¸äº‹ä»¶çš„å‘é€ä¸¤ä¸ªè¿‡ç¨‹è¿›è¡Œè®²è§£ã€‚</p>
<h4 id="è®¢é˜…è¿‡ç¨‹æºç åˆ†æ"><a href="#è®¢é˜…è¿‡ç¨‹æºç åˆ†æ" class="headerlink" title="è®¢é˜…è¿‡ç¨‹æºç åˆ†æ"></a>è®¢é˜…è¿‡ç¨‹æºç åˆ†æ</h4><p>EventBus çš„è®¢é˜…å…¥å£ä¸º register() æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Object subscriber)</span> </span>&#123;</span><br><span class="line">      Class&lt;?&gt; subscriberClass = subscriber.getClass();</span><br><span class="line">      <span class="comment">//æµç¨‹1ï¼šè·å–å¯¹åº”ç±»ä¸­æ‰€æœ‰çš„è®¢é˜…æ–¹æ³•</span></span><br><span class="line">      List&lt;SubscriberMethod&gt; subscriberMethods = subscriberMethodFinder.findSubscriberMethods(subscriberClass);</span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">          <span class="comment">//æµç¨‹2ï¼šå®é™…è®¢é˜…</span></span><br><span class="line">          <span class="keyword">for</span> (SubscriberMethod subscriberMethod : subscriberMethods) &#123;</span><br><span class="line">              subscribe(subscriber, subscriberMethod);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¸»è¦æ¶‰åŠåˆ° SubscriberMethodFinder æŸ¥æ‰¾æ–¹æ³•ä¸å®é™…è®¢é˜…ä¸¤ä¸ªæµç¨‹ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šå¯¹è¿™ä¸¤ä¸ªæµç¨‹è¿›è¡Œä»‹ç»ã€‚</p>
<h4 id="SubscriberMethodFinder-æŸ¥æ‰¾æ–¹æ³•æµç¨‹"><a href="#SubscriberMethodFinder-æŸ¥æ‰¾æ–¹æ³•æµç¨‹" class="headerlink" title="SubscriberMethodFinder æŸ¥æ‰¾æ–¹æ³•æµç¨‹"></a>SubscriberMethodFinder æŸ¥æ‰¾æ–¹æ³•æµç¨‹</h4><p>åœ¨è¯¥æµç¨‹ä¸­ï¼Œä¸»è¦é€šè¿‡ <code>SubscriberMethodFinder</code> å»è·å–è®¢é˜…è€…ä¸­æ‰€æœ‰çš„ SubscriberMethod ï¼Œæˆ‘ä»¬å…ˆçœ‹ <code>findSubscriberMethods()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;SubscriberMethod&gt; <span class="title">findSubscriberMethods</span><span class="params">(Class&lt;?&gt; subscriberClass)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ä»ç¼“å­˜ä¸­è·å–è®¢é˜…è€…ä¸­çš„è®¢é˜…æ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™è¯»ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡ŒæŸ¥æ‰¾</span></span><br><span class="line">    List&lt;SubscriberMethod&gt; subscriberMethods = (List)METHOD_CACHE.get(subscriberClass);</span><br><span class="line">    <span class="keyword">if</span> (subscriberMethods != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> subscriberMethods;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.ignoreGeneratedIndex) &#123;<span class="comment">//å¦‚æœå¿½ç•¥ç´¢å¼•ç±»ï¼Œåˆ™ä½¿ç”¨åå°„ã€‚</span></span><br><span class="line">            subscriberMethods = <span class="keyword">this</span>.findUsingReflection(subscriberClass);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">//å¦åˆ™ä½¿ç”¨ç´¢å¼•ç±»</span></span><br><span class="line">            subscriberMethods = <span class="keyword">this</span>.findUsingInfo(subscriberClass);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœè®¢é˜…è€…æ²¡æœ‰è®¢é˜…æ–¹æ³•ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> (subscriberMethods.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Subscriber "</span> + subscriberClass + <span class="string">" and its super classes have no public methods with the @Subscribe annotation"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//å°†å¯¹åº”ç±»ä¸­çš„è®¢é˜…æ–¹æ³•ï¼Œæ·»åŠ åˆ°ç¼“å­˜ä¸­ï¼Œæé«˜æ•ˆç‡ï¼Œæ–¹ä¾¿ä¸‹æ¬¡æŸ¥æ‰¾</span></span><br><span class="line">            METHOD_CACHE.put(subscriberClass, subscriberMethods);</span><br><span class="line">            <span class="keyword">return</span> subscriberMethods;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•çš„é€»è¾‘ä¹Ÿéå¸¸ç®€å•ï¼Œä¸ºå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>æ­¥éª¤1ï¼šå…ˆä»ç¼“å­˜( <code>METHOD_CACHE</code> )ä¸­è·å–è®¢é˜…è€…å¯¹åº”çš„ <code>SubscriberMethodï¼ˆè®¢é˜…æ–¹æ³•)</code> ï¼Œå¦‚æœæœ‰åˆ™ä»ç¼“å­˜ä¸­å–ã€‚</li>
<li>æ­¥éª¤2ï¼šå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™é€šè¿‡å¸ƒå°”å˜é‡ <code>ignoreGeneratedIndex</code>ï¼Œæ¥åˆ¤æ–­æ˜¯ç›´æ¥ä½¿ç”¨åå°„è·å–è®¢é˜…æ–¹æ³•ï¼Œè¿˜æ˜¯é€šè¿‡<code>ç´¢å¼•ç±»</code>(EventBus 3.0 ä½¿ç”¨APT å¢åŠ çš„ç±»ï¼‰æ¥è·å–ã€‚å› ä¸º <code>ignoreGeneratedIndex</code> é»˜è®¤å€¼ä¸º false ï¼Œåˆ™é»˜è®¤ä¼šèµ° <code>findUsingInfo()</code> æ–¹æ³•</li>
<li>æ­¥éª¤3ï¼šå°†æ­¥éª¤2ä¸­è·å¾—çš„è®¢é˜…æ–¹æ³•é›†åˆï¼Œå­˜å‚¨åˆ°ç¼“å­˜ä¸­ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ¬¡è·å–ï¼Œæé«˜æ•ˆç‡ã€‚</li>
</ul>
<p>å› ä¸ºé»˜è®¤ä¼šèµ° <code>findUsingInfo()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­æŸ¥çœ‹è¯¥æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> List&lt;SubscriberMethod&gt; <span class="title">findUsingInfo</span><span class="params">(Class&lt;?&gt; subscriberClass)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ­¥éª¤1ï¼šæ„å»ºäº†æŸ¥è¯¢çŠ¶æ€ç¼“å­˜æ± ï¼Œæœ€å¤šç¼“å­˜4ä¸ªç±»çš„æŸ¥è¯¢çŠ¶æ€</span></span><br><span class="line">    FindState findState = prepareFindState();</span><br><span class="line">    findState.initForSubscriber(subscriberClass);</span><br><span class="line">    <span class="keyword">while</span> (findState.clazz != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//æ­¥éª¤2ï¼Œè·å–æŸ¥æ‰¾çŠ¶æ€å¯¹åº”çš„è®¢é˜…ä¿¡æ¯ï¼ŒğŸ‘‡è¿™é‡ŒEventBus 3.0 ä½¿ç”¨äº†ç´¢å¼•ç±»ï¼Œ</span></span><br><span class="line">        findState.subscriberInfo = getSubscriberInfo(findState);</span><br><span class="line">        <span class="keyword">if</span> (findState.subscriberInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">            SubscriberMethod[] array = findState.subscriberInfo.getSubscriberMethods();</span><br><span class="line">            <span class="keyword">for</span> (SubscriberMethod subscriberMethod : array) &#123;</span><br><span class="line">                <span class="comment">//å°†è®¢é˜…è€…çš„æ‰€æœ‰çš„è®¢é˜…æ–¹æ³•æ·»åŠ åˆ°FindStateçš„é›†åˆä¸­</span></span><br><span class="line">                <span class="keyword">if</span> (findState.checkAdd(subscriberMethod.method, subscriberMethod.eventType)) &#123;</span><br><span class="line">                    findState.subscriberMethods.add(subscriberMethod);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">//æ­¥éª¤3ï¼šå¦‚æœè®¢é˜…ä¿¡æ¯ä¸ºnullï¼Œåˆ™é€šè¿‡åå°„æ¥è·å–ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•</span></span><br><span class="line">            findUsingReflectionInSingleClass(findState);</span><br><span class="line">        &#125;<span class="comment">// ç»§ç»­æŸ¥æ‰¾çˆ¶ç±»çš„æ–¹æ³•</span></span><br><span class="line">        findState.moveToSuperclass();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ­¥éª¤4ï¼Œè·å–findStateä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶æ¸…ç©ºå¯¹è±¡æ± </span></span><br><span class="line">    <span class="keyword">return</span> getMethodsAndRelease(findState);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¥éª¤1ï¼šåˆ›å»ºä¸è®¢é˜…è€…ç›¸å…³çš„ FindState å¯¹è±¡ã€‚ä¼šä» FinState å¯¹è±¡ç¼“å­˜æ± (æœ€å¤§ä¸º4ä¸ª)ä¸­è·å–ï¼Œä¸€ä¸ªè®¢é˜…è€…å¯¹è±¡å¯¹åº”ä¸€ä¸ªFindStateï¼Œä¸€ä¸ªè®¢é˜…è€…å¯¹è±¡å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªè®¢é˜…æ–¹æ³•ã€‚</li>
<li>æ­¥éª¤2ï¼šé€šè¿‡ FindState å¯¹è±¡ è°ƒç”¨ <code>getSubscriberInfo()</code> æ–¹æ³•å»è·å–è®¢é˜…è€…ç›¸å…³çš„è®¢é˜…æ–¹æ³•ä¿¡æ¯ã€‚è¯¥æ–¹æ³•ä½¿ç”¨äº† APT æŠ€æœ¯ï¼Œæ„å»ºäº†EventBusçš„ç´¢å¼•ç±»ã€‚å…³äºå…·ä½“çš„ä¼˜åŒ–ï¼Œä¼šåœ¨ä¸‹ç¯‡æ–‡ç« ä¸­ <a href="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/" title="Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€åŠ é€Ÿå¼•æ“â€œï¼ˆäº”ï¼‰">Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€åŠ é€Ÿå¼•æ“â€œï¼ˆäº”ï¼‰</a> è¿›è¡Œæè¿°ï¼Œå¤§å®¶è¿™é‡Œæœ‰ä¸ªå°è±¡å°±å¥½äº†ã€‚</li>
<li>æ­¥éª¤3ï¼šå¦‚æœé€šè¿‡æ­¥éª¤2è·å–ä¸åˆ°è®¢é˜…æ–¹æ³•ä¿¡æ¯ï¼Œåˆ™é€šè¿‡<code>åå°„</code>æ¥è·å–ç±»ä¸­çš„æ‰€æœ‰çš„è®¢é˜…æ–¹æ³•ã€‚å¹¶å°†è·å–çš„æ–¹æ³•ï¼Œå°è£…åˆ° FindState ä¸­çš„ subscriberMethods é›†åˆä¸­å»ã€‚</li>
<li>æ­¥éª¤4ï¼šå°† FindState å¯¹è±¡ä¸­çš„ subscriberMethods é›†åˆè¿”å›ã€‚</li>
</ul>
<p>åœ¨ä¸Šè¿°æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå½“å‰è®¢é˜…ç€æ²¡æœ‰ç›¸å…³çš„è®¢é˜…æ–¹æ³•ï¼Œé‚£ä¹ˆä¼šä¾æ¬¡éå†å…¶çˆ¶ç±»çš„è®¢é˜…æ–¹æ³•ã€‚è¿˜æœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯è¯¥æ–¹æ³•ä¸­ FindState ä½¿ç”¨äº† <code>å¯¹è±¡ç¼“å­˜æ± </code>ï¼Œä¸ä¼šæ¯æ¬¡æ³¨å†Œä¸€ä¸ªè®¢é˜…è€…å°±åˆ›å»º ä¸€ä¸ªFindState å¯¹è±¡ã€‚è¿™æ ·å°±èŠ‚çº¦äº†å†…å­˜çš„ä½¿ç”¨ã€‚</p>
<p>å…³äºç´¢å¼•ç±»çš„çŸ¥è¯†ç‚¹ï¼Œä¼šåœ¨ä¸‹ç¯‡æ–‡ç« ä¸­è¿›è¡Œä»‹ç»ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥æŸ¥çœ‹ <code>findUsingReflectionInSingleClass()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findUsingReflectionInSingleClass</span><span class="params">(FindState findState)</span> </span>&#123;</span><br><span class="line">      Method[] methods;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">//è·å–å½“å‰è®¢é˜…è€…ä¸­çš„æ‰€æœ‰çš„æ–¹æ³•</span></span><br><span class="line">          methods = findState.clazz.getDeclaredMethods();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Throwable th) &#123;</span><br><span class="line">          <span class="comment">//è·å–è¯¥ç±»çš„æ‰€æœ‰public æ–¹æ³• åŒ…æ‹¬ç»§æ‰¿çš„å…¬æœ‰æ–¹æ³•</span></span><br><span class="line">          methods = findState.clazz.getMethods();</span><br><span class="line">          findState.skipSuperClasses = <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//å¾ªç¯éå†æ‰€æœ‰çš„æ–¹æ³•ï¼Œé€šè¿‡ç›¸å…³æ³¨è§£æ‰¾åˆ°ç›¸åº”çš„è®¢é˜…æ–¹æ³•ã€‚</span></span><br><span class="line">      <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">          <span class="keyword">int</span> modifiers = method.getModifiers();</span><br><span class="line">          <span class="comment">//æ»¡è¶³ä¿®é¥°ç¬¦ä¸º public å¹¶ä¸”éæŠ½è±¡ã€éé™æ€</span></span><br><span class="line">          <span class="keyword">if</span> ((modifiers &amp; Modifier.PUBLIC) != <span class="number">0</span> &amp;&amp; (modifiers &amp; MODIFIERS_IGNORE) == <span class="number">0</span>) &#123;</span><br><span class="line">              Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span><br><span class="line">              <span class="comment">//æ‰¾åˆ°å‚æ•°ä¸º1ï¼Œä¸”è¯¥æ–¹æ³•åŒ…å«Subscrileæ³¨è§£çš„æ–¹æ³•</span></span><br><span class="line">              <span class="keyword">if</span> (parameterTypes.length == <span class="number">1</span>) &#123;</span><br><span class="line">                  Subscribe subscribeAnnotation = method.getAnnotation(Subscribe.class);</span><br><span class="line">                  <span class="keyword">if</span> (subscribeAnnotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">                      Class&lt;?&gt; eventType = parameterTypes[<span class="number">0</span>];</span><br><span class="line">                      <span class="keyword">if</span> (findState.checkAdd(method, eventType)) &#123;</span><br><span class="line">                          <span class="comment">// åˆ›å»ºè®¢é˜…æ–¹æ³•å¯¹è±¡ï¼Œå¹¶å°†å¯¹åº”æ–¹æ³•å¯¹è±¡ï¼Œäº‹ä»¶ç±»å‹ï¼Œçº¿ç¨‹æ¨¡å¼ï¼Œä¼˜å…ˆçº§ï¼Œç²˜æ€§äº‹ä»¶å°è£…åˆ°SubscriberMethodå¯¹è±¡ä¸­ã€‚</span></span><br><span class="line">                          ThreadMode threadMode = subscribeAnnotation.threadMode();</span><br><span class="line">                          findState.subscriberMethods.add(<span class="keyword">new</span> SubscriberMethod(method, eventType, threadMode,</span><br><span class="line">                                  subscribeAnnotation.priority(), subscribeAnnotation.sticky()));</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) &#123;</span><br><span class="line">                  String methodName = method.getDeclaringClass().getName() + <span class="string">"."</span> + method.getName();</span><br><span class="line">                  <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"@Subscribe method "</span> + methodName +</span><br><span class="line">                          <span class="string">"must have exactly 1 parameter but has "</span> + parameterTypes.length);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) &#123;</span><br><span class="line">              String methodName = method.getDeclaringClass().getName() + <span class="string">"."</span> + method.getName();</span><br><span class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(methodName +</span><br><span class="line">                      <span class="string">" is a illegal @Subscribe method: must be public, non-static, and non-abstract"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•çš„é€»è¾‘ä¹Ÿéå¸¸ç®€å•ï¼Œé€šè¿‡è·å– FindState ä¸­çš„è®¢é˜…è€…çš„ Class å¯¹è±¡ï¼Œç„¶åé€šè¿‡åå°„è·å–æ‰€æœ‰åŒ…å« <code>@Subscribe</code> æ³¨è§£ä¸”å‚æ•°ä¸º <code>1</code> çš„ Method å¯¹è±¡ï¼Œå¹¶è¯»å–åˆ°è¯¥å‚æ•°çš„ç±»å‹<code>EventType</code>ï¼Œæ¥ç€è¯»å–æ³¨è§£ä¸­çš„ <code>thredMode</code>ã€<code>priority</code>ã€<code>sticy</code>ï¼Œæœ€åå°†è¿™äº›æ•°æ®éƒ½ç»Ÿä¸€åˆ†è£…åˆ°æ–°å»ºçš„<code>SubscriberMethod</code> å¯¹è±¡ä¸­ï¼Œæœ€åå°†è¯¥å¯¹è±¡æ·»åŠ åˆ° FindState ä¸­çš„ subscriberMethods é›†åˆä¸­å»ã€‚</p>
<h4 id="å®é™…è®¢é˜…æ–¹æ³•-subscribe"><a href="#å®é™…è®¢é˜…æ–¹æ³•-subscribe" class="headerlink" title="å®é™…è®¢é˜…æ–¹æ³• subscribe"></a>å®é™…è®¢é˜…æ–¹æ³• subscribe</h4><p>å½“æ‰¾åˆ°è®¢é˜…è€…æ‰€æœ‰çš„æ–¹æ³•é›†åˆåï¼Œæœ€ç»ˆä¼šéå†è°ƒç”¨ <code>subscribe()</code> æ–¹æ³•ï¼ŒæŸ¥çœ‹è¯¥æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Object subscriber, SubscriberMethod subscriberMethod)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; eventType = subscriberMethod.eventType;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ­¥éª¤1ï¼Œå°†æ¯ä¸ªè®¢é˜…æ–¹æ³•å’Œè®¢é˜…è€…å°è£…æˆSubscription</span></span><br><span class="line">        Subscription newSubscription = <span class="keyword">new</span> Subscription(subscriber, subscriberMethod);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ­¥éª¤2ï¼Œè·å–å¯¹åº”äº‹ä»¶ä¸­æ‰€æœ‰çš„ Subscriptionï¼Œåˆ¤æ–­æ˜¯å¦é‡å¤æ·»åŠ </span></span><br><span class="line">        CopyOnWriteArrayList&lt;Subscription&gt; subscriptions = (CopyOnWriteArrayList)<span class="keyword">this</span>.subscriptionsByEventType.get(eventType);</span><br><span class="line">        <span class="keyword">if</span> (subscriptions == <span class="keyword">null</span>) &#123;</span><br><span class="line">            subscriptions = <span class="keyword">new</span> CopyOnWriteArrayList();</span><br><span class="line">            <span class="keyword">this</span>.subscriptionsByEventType.put(eventType, subscriptions);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (subscriptions.contains(newSubscription)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Subscriber "</span> + subscriber.getClass() + <span class="string">" already registered to event "</span> + eventType);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ­¥éª¤3ï¼Œæ ¹æ®ä¼˜å…ˆçº§ï¼Œå°†å½“å‰æ–°å°è£…çš„Subscriptionå¯¹è±¡æ·»åŠ åˆ°subscriptionsByEventTypeä¸­å»</span></span><br><span class="line">        <span class="keyword">int</span> size = subscriptions.size();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= size; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == size || subscriberMethod.priority &gt; ((Subscription)subscriptions.get(i)).subscriberMethod.priority) &#123;</span><br><span class="line">                subscriptions.add(i, newSubscription);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//æ­¥éª¤4ï¼Œå°†å½“å‰è®¢é˜…è€…ä¸­ä¸å½“å‰è®¢é˜…è€…æ‰€è®¢é˜…çš„äº‹ä»¶ç±»å‹ï¼Œæ·»åŠ åˆ°typesBySubscriberä¸­å»</span></span><br><span class="line">        List&lt;Class&lt;?&gt;&gt; subscribedEvents = (List)<span class="keyword">this</span>.typesBySubscriber.get(subscriber);</span><br><span class="line">        <span class="keyword">if</span> (subscribedEvents == <span class="keyword">null</span>) &#123;</span><br><span class="line">            subscribedEvents = <span class="keyword">new</span> ArrayList();</span><br><span class="line">            <span class="keyword">this</span>.typesBySubscriber.put(subscriber, subscribedEvents);</span><br><span class="line">        &#125;</span><br><span class="line">        subscribedEvents.add(eventType);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ­¥éª¤5ï¼Œå¦‚æœè¯¥æ–¹æ³•æœ‰è®¢é˜…äº†ç²˜æ€§äº‹ä»¶ï¼Œåˆ™ä»stickyEventsä¸­è·å–ç›¸åº”ç²˜æ€§äº‹ä»¶ï¼Œå¹¶å‘é€</span></span><br><span class="line">        <span class="keyword">if</span> (subscriberMethod.sticky) &#123;</span><br><span class="line">            <span class="keyword">if</span> (eventInheritance) &#123;</span><br><span class="line">                Set&lt;Map.Entry&lt;Class&lt;?&gt;, Object&gt;&gt; entries = stickyEvents.entrySet();</span><br><span class="line">                <span class="keyword">for</span> (Map.Entry&lt;Class&lt;?&gt;, Object&gt; entry : entries) &#123;</span><br><span class="line">                    Class&lt;?&gt; candidateEventType = entry.getKey();</span><br><span class="line">                    <span class="keyword">if</span> (eventType.isAssignableFrom(candidateEventType)) &#123;</span><br><span class="line">                        Object stickyEvent = entry.getValue();</span><br><span class="line">                        checkPostStickyEventToSubscription(newSubscription, stickyEvent);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Object stickyEvent = <span class="keyword">this</span>.stickyEvents.get(eventType);</span><br><span class="line">                <span class="keyword">this</span>.checkPostStickyEventToSubscription(newSubscription, stickyEvent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šè¿°æ–¹æ³•ä¸­ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ­¥éª¤1ï¼Œå°†æ¯ä¸ªè®¢é˜…æ–¹æ³•å’Œè®¢é˜…è€…å°è£…æˆ Subscriptionã€‚</li>
<li>æ­¥éª¤2ï¼Œè·å–å¯¹åº”äº‹ä»¶ä¸­æ‰€æœ‰çš„ Subscription ï¼Œåˆ¤æ–­æ˜¯å¦é‡å¤æ·»åŠ ã€‚</li>
<li>æ­¥éª¤3ï¼Œæ ¹æ® <code>ä¼˜å…ˆçº§</code>ï¼Œå°†å½“å‰æ–°å°è£…çš„ Subscription å¯¹è±¡æ·»åŠ åˆ° subscriptionsByEventType ä¸­å»ã€‚(è®¾ç½®äº†ä¼˜å…ˆçº§åï¼ŒEvenBus å°±å¯ä»¥æŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºï¼Œå°†äº‹ä»¶å‘é€ç»™è®¢é˜…è€…)</li>
<li>æ­¥éª¤4ï¼Œå°†å½“å‰è®¢é˜…è€…ä¸­ä¸å½“å‰è®¢é˜…è€…æ‰€è®¢é˜…çš„äº‹ä»¶ç±»å‹ï¼Œæ·»åŠ åˆ° typesBySubscriber ä¸­å»ã€‚</li>
<li>æ­¥éª¤5ï¼Œå¦‚æœè¯¥æ–¹æ³•æœ‰è®¢é˜…äº†ç²˜æ€§äº‹ä»¶ï¼Œåˆ™ä» stickyEvents ä¸­è·å–ç›¸åº”ç²˜æ€§äº‹ä»¶ï¼Œå¹¶å‘é€ã€‚</li>
</ul>
<p>å†ç»“åˆæˆ‘ä»¬æœ€å¼€å§‹æ‰€ç”»çš„ EventBus å¤§è‡´æµç¨‹ï¼Œè¯¥æ–¹æ³•å…¶å®å°±åšäº†ä¸‹å›¾<code>çº¢è‰²è™šçº¿æ¡†</code>ä¸­çš„äº‹ï¼š</p>
<img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/subscribe()å®é™…åšçš„äº‹.jpg" title="subscribe()å®é™…åšçš„äº‹">
<p>å…³äºç²˜æ€§äº‹ä»¶çš„çŸ¥è¯†ç‚¹ï¼Œéœ€è¦æˆ‘ä»¬äº†è§£äº‹ä»¶çš„å‘é€æµç¨‹ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹æ–‡è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p>
<h3 id="äº‹ä»¶å‘é€æµç¨‹æºç åˆ†æ"><a href="#äº‹ä»¶å‘é€æµç¨‹æºç åˆ†æ" class="headerlink" title="äº‹ä»¶å‘é€æµç¨‹æºç åˆ†æ"></a>äº‹ä»¶å‘é€æµç¨‹æºç åˆ†æ</h3><p>äº‹ä»¶çš„å‘é€ï¼Œä¸»è¦åˆ†ä¸º<code>ç®€å•äº‹ä»¶</code>ä¸<code>ç²˜æ€§äº‹ä»¶</code>ï¼Œåˆ†åˆ«å¯¹åº”æ–¹æ³•ä¸º  <code>post()</code> ä¸ <code>postSticky()</code> ä¸¤ä¸ªæ–¹æ³•ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆçœ‹ç®€å•äº‹ä»¶çš„å‘é€ï¼Œä»£ç å¦‚ä¸‹:</p>
<h4 id="ç®€å•äº‹ä»¶çš„å‘é€"><a href="#ç®€å•äº‹ä»¶çš„å‘é€" class="headerlink" title="ç®€å•äº‹ä»¶çš„å‘é€"></a>ç®€å•äº‹ä»¶çš„å‘é€</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(Object event)</span> </span>&#123;</span><br><span class="line">   <span class="comment">//æ­¥éª¤1ï¼Œè·å–å½“å‰çº¿ç¨‹ä¸­ç‹¬ç«‹æ‹¥æœ‰çš„PostingThreadStateï¼Œå¹¶ä»ä¸­è·å–äº‹ä»¶é˜Ÿåˆ—ï¼ˆeventQueueï¼‰ï¼Œå°†å‘é€çš„äº‹ä»¶æ·»åŠ åˆ°è¯¥é˜Ÿåˆ—ä¸­</span></span><br><span class="line">      EventBus.PostingThreadState postingState = (EventBus.PostingThreadState)<span class="keyword">this</span>.currentPostingThreadState.get();</span><br><span class="line">      List&lt;Object&gt; eventQueue = postingState.eventQueue;</span><br><span class="line">      eventQueue.add(event);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//æ­¥éª¤2ï¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ­£åœ¨åˆ†å‘äº‹ä»¶ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™å¾ªç¯éå†äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶ï¼Œå¹¶å°†äº‹ä»¶åˆ†å‘å‡ºå»ï¼Œç›´åˆ°å½“å‰äº‹ä»¶é˜Ÿåˆ—ç©ºä¸ºæ­¢</span></span><br><span class="line">      <span class="keyword">if</span> (!postingState.isPosting) &#123;</span><br><span class="line">          postingState.isMainThread = <span class="keyword">this</span>.isMainThread();</span><br><span class="line">          postingState.isPosting = <span class="keyword">true</span>;</span><br><span class="line">          <span class="comment">//å¦‚æœå½“å‰åˆ†å‘äº‹ä»¶çŠ¶æ€ä¸ºå–æ¶ˆï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">          <span class="keyword">if</span> (postingState.canceled) &#123;</span><br><span class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Internal error. Abort state was not reset"</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//å¾ªç¯éå†äº‹ä»¶é˜Ÿåˆ—ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€å‡ºå»</span></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">while</span>(!eventQueue.isEmpty()) &#123;</span><br><span class="line">                  <span class="keyword">this</span>.postSingleEvent(eventQueue.remove(<span class="number">0</span>), postingState);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">              postingState.isPosting = <span class="keyword">false</span>;</span><br><span class="line">              postingState.isMainThread = <span class="keyword">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ EventBus ä¸­ä¼šä¸ºä¸ªæ¯è°ƒç”¨ post() æ–¹æ³•çš„çº¿ç¨‹éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ <code>PostingThreadState</code> å¯¹è±¡ï¼Œç”¨äºè®°å½•å½“å‰çº¿ç¨‹å­˜å‚¨å‘é€æ¶ˆæ¯ä¸å‘é€çš„çŠ¶æ€ï¼Œå…¶å†…éƒ¨ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/PositingThreadStateä¸çº¿ç¨‹çš„å…³ç³».jpg" title="PositingThreadStateä¸çº¿ç¨‹çš„å…³ç³»">
<blockquote>
<p>PostingThreadState ä½¿ç”¨äº† ThreadLocal ä¸ç†Ÿæ‚‰ ThreadLocal çš„å°ä¼™ä¼´ï¼Œå¯ä»¥æŸ¥çœ‹è¯¥ç¯‡æ–‡ç« ï¼šAndroid Handleræœºåˆ¶ä¹‹ThreadLocal</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬è°ƒç”¨ <code>EventBus.post()</code> æ–¹æ³•ï¼Œå…¶å®æ˜¯ä» EventQueue é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ï¼Œç„¶åé€šè¿‡è°ƒç”¨ postSingleEventï¼ˆï¼‰æ–¹æ³• æ¥å®é™…å‘é€æ¶ˆæ¯ï¼Œè¯¥æ–¹æ³•ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postSingleEvent</span><span class="params">(Object event, EventBus.PostingThreadState postingState)</span> <span class="keyword">throws</span> Error </span>&#123;</span><br><span class="line">      Class&lt;?&gt; eventClass = event.getClass();</span><br><span class="line">      <span class="keyword">boolean</span> subscriptionFound = <span class="keyword">false</span>;</span><br><span class="line">      <span class="comment">//æ­¥éª¤1ï¼šğŸ‘‡åˆ¤æ–­å¦äº‹ä»¶ä¼ é€’å‘é€</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.eventInheritance) &#123;</span><br><span class="line">          List&lt;Class&lt;?&gt;&gt; eventTypes = lookupAllEventTypes(eventClass);</span><br><span class="line">          <span class="keyword">int</span> countTypes = eventTypes.size();</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">int</span> h = <span class="number">0</span>; h &lt; countTypes; ++h) &#123;</span><br><span class="line">              Class&lt;?&gt; clazz = (Class)eventTypes.get(h);</span><br><span class="line">              <span class="comment">//ğŸ‘‡å¾ªç¯éå†éå†äº‹ä»¶å¹¶å‘é€</span></span><br><span class="line">              subscriptionFound |= <span class="keyword">this</span>.postSingleEventForEventType(event, postingState, clazz);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//æ­¥éª¤2ï¼šğŸ‘‡å¦‚æœä¸æ”¯æŒäº‹ä»¶çš„ä¼ é€’ï¼Œé‚£ä¹ˆè¿™é‡Œå¼€å§‹å‘é€äº‹ä»¶ã€‚</span></span><br><span class="line">          subscriptionFound = <span class="keyword">this</span>.postSingleEventForEventType(event, postingState, eventClass);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//æ­¥éª¤3ï¼šå¦‚æœæ²¡æœ‰æ‰¾åˆ°è®¢é˜…çš„æ–¹å¼ï¼Œæç¤ºç”¨æˆ·</span></span><br><span class="line">      <span class="keyword">if</span> (!subscriptionFound) &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">this</span>.logNoSubscriberMessages) &#123;</span><br><span class="line">              <span class="keyword">this</span>.logger.log(Level.FINE, <span class="string">"No subscribers registered for event "</span> + eventClass);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">this</span>.sendNoSubscriberEvent &amp;&amp; eventClass != NoSubscriberEvent.class &amp;&amp; eventClass != SubscriberExceptionEvent.class) &#123;</span><br><span class="line">              <span class="keyword">this</span>.post(<span class="keyword">new</span> NoSubscriberEvent(<span class="keyword">this</span>, event));</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•ä¸»è¦ä¸ºå¦‚ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>æ­¥éª¤1ï¼šé€šè¿‡å¸ƒå°”å˜é‡ <code>eventInheritance</code> åˆ¤æ–­æ˜¯å¦æ”¯æŒäº‹ä»¶æ˜¯å¦ä¼ é€’å‘é€ï¼Œå¦‚æœæ”¯æŒï¼Œé‚£ä¹ˆé€šè¿‡<code>lookupAllEventTypes()</code> æ–¹æ³•è·å¾—å‘é€äº‹ä»¶ç¥–å…ˆç±»åŠå…¶æ¥å£ã€‚ç„¶åé€šè¿‡ <code>postSingleEventForEventType()</code>æ–¹æ³•ï¼Œå°†å®ƒä»¬éƒ½å‘é€å‡ºå»ï¼Œ</li>
<li>æ­¥éª¤2ï¼šæ­¥éª¤1è¿”å› false é‚£ä¹ˆå°±ç›´æ¥ä½¿ç”¨ <code>postSingleEventForEventType()</code> æ–¹æ³•å‘é€äº‹ä»¶ã€‚</li>
<li>æ­¥éª¤3ï¼šå¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„è®¢é˜…æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æç¤ºç”¨æˆ·æ²¡æœ‰ç›¸å…³çš„è®¢é˜…æ–¹æ³•ã€‚</li>
</ul>
<blockquote>
<p>å¸ƒå°”å˜é‡ <code>eventInheritance</code> é»˜è®¤ä¸º <code>false</code> ,æˆ‘ä»¬å¯ä»¥é€šè¿‡ EventBusBuilder æ¥é…ç½®è¯¥å˜é‡çš„å€¼ã€‚</p>
</blockquote>
<p>é‚£ä»€ä¹ˆæ˜¯äº‹ä»¶çš„ä¼ é€’å‘é€å‘¢ï¼Ÿæˆ‘ä»¬æ¥æŸ¥çœ‹ <code>lookupAllEventTypes()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Class&lt;?&gt;&gt; lookupAllEventTypes(Class&lt;?&gt; eventClass) &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (eventTypesCache) &#123;</span><br><span class="line">        List&lt;Class&lt;?&gt;&gt; eventTypes = eventTypesCache.get(eventClass);</span><br><span class="line">        <span class="keyword">if</span> (eventTypes == <span class="keyword">null</span>) &#123;</span><br><span class="line">            eventTypes = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            Class&lt;?&gt; clazz = eventClass;</span><br><span class="line">            <span class="comment">//ğŸ‘‡è·å–è¯¥ç±»æ‰€æœ‰ç¥–å…ˆç±»åŠå…¶æ¥å£</span></span><br><span class="line">            <span class="keyword">while</span> (clazz != <span class="keyword">null</span>) &#123;</span><br><span class="line">                eventTypes.add(clazz);</span><br><span class="line">                addInterfaces(eventTypes, clazz.getInterfaces());</span><br><span class="line">                clazz = clazz.getSuperclass();</span><br><span class="line">            &#125;</span><br><span class="line">            eventTypesCache.put(eventClass, eventTypes);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> eventTypes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†æ¥å£æ·»åŠ åˆ°é›†åˆä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addInterfaces</span><span class="params">(List&lt;Class&lt;?&gt;&gt; eventTypes, Class&lt;?&gt;[] interfaces)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Class&lt;?&gt; interfaceClass : interfaces) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!eventTypes.contains(interfaceClass)) &#123;</span><br><span class="line">            eventTypes.add(interfaceClass);</span><br><span class="line">            addInterfaces(eventTypes, interfaceClass.getInterfaces());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¼šè·å–å‘é€äº‹ä»¶çš„æ‰€æœ‰çš„ç¥–å…ˆç±»åŠå…¶æ¥å£ï¼Œæœ€åå°†ä»–ä»¬ä»¥é›†åˆçš„æ–¹å¼è¿”å›ï¼Œåœ¨ <code>postSingleEvent</code> æ–¹æ³•ä¸­æ‹¿åˆ°è¿™ä¸ªé›†åˆä¹‹åï¼Œé‚£ä¹ˆå°±ä¼šå°†é›†åˆä¸­æ‰€æœ‰çš„æ•°æ®éƒ½å‘é€å‡ºå»ã€‚è¿™æ ·åšä¼šé€ æˆä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿå¦‚æœå½“å‰æˆ‘ä»¬çš„ç»§æ‰¿ä½“ç³»ä¸º Aevent -&gt; Bevent -&gt; Cevent ( <code>-&gt;</code> è¡¨ç¤ºç»§æ‰¿)ï¼Œé‚£ä¹ˆé€šè¿‡å‘é€ Aeventï¼Œé‚£ä¹ˆå…¶ä»–æ‰€æœ‰è®¢é˜…è¿‡ Bevent åŠ Cevent çš„è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚</p>
<p>æˆ‘ä»¬ç»§ç»­æŸ¥çœ‹ <code>postSingleEventForEventType()</code> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">postSingleEventForEventType</span><span class="params">(Object event, PostingThreadState postingState, Class&lt;?&gt; eventClass)</span> </span>&#123;</span><br><span class="line">    CopyOnWriteArrayList&lt;Subscription&gt; subscriptions;</span><br><span class="line">    <span class="comment">//ğŸ‘‡ä»ç¼“å­˜ä¸­æ‹¿å–ä¹‹å‰å­˜å–çš„ Subscription</span></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        subscriptions = subscriptionsByEventType.get(eventClass);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (subscriptions != <span class="keyword">null</span> &amp;&amp; !subscriptions.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Subscription subscription : subscriptions) &#123;</span><br><span class="line">            postingState.event = event;</span><br><span class="line">            postingState.subscription = subscription;</span><br><span class="line">            <span class="keyword">boolean</span> aborted = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//ğŸ‘‡è¿™é‡Œæ‰¾åˆ°ç›¸åº”çš„æ–¹æ³•åï¼Œå¼€å§‹åˆ‡æ¢çº¿ç¨‹äº†ã€‚</span></span><br><span class="line">                postToSubscription(subscription, event, postingState.isMainThread);</span><br><span class="line">                aborted = postingState.canceled;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                postingState.event = <span class="keyword">null</span>;</span><br><span class="line">                postingState.subscription = <span class="keyword">null</span>;</span><br><span class="line">                postingState.canceled = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (aborted) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•çš„é€»è¾‘éå¸¸ç®€å•ï¼Œå°±æ˜¯ä»æˆ‘ä»¬ä¹‹å‰çš„ <code>subscriptionsByEventType</code> é›†åˆä¸­æ‹¿åˆ°å­˜å‚¨çš„ <code>Subscription</code>ï¼Œå¹¶æ ¹æ®å½“å‰çº¿ç¨‹çŠ¶æ€è®¾ç½®å…³è”çš„ <code>PostingState</code> ä¸­ <code>canceled</code> ã€<code>subscription</code> ã€<code>isMainThread</code> ç­‰å±æ€§å€¼ï¼Œç„¶åé€šè¿‡ <code>postToSubscription()</code> æ–¹æ³•æ¥çœŸæ­£çš„æ‰§è¡Œäº‹ä»¶çš„ä¼ é€’ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢æ•´ä¸ªæµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/ç®€å•äº‹ä»¶çš„å‘é€.jpg" title="ç®€å•äº‹ä»¶çš„å‘é€">
<h4 id="postToSubscription"><a href="#postToSubscription" class="headerlink" title="postToSubscription()"></a>postToSubscription()</h4><p>postToSubscription() æ–¹æ³•æ˜¯çœŸæ­£å®é™…å°†äº‹ä»¶ä¼ é€’åˆ°è®¢é˜…è€…çš„ä»£ç ã€‚æŸ¥çœ‹è¯¥æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postToSubscription</span><span class="params">(Subscription subscription, Object event, <span class="keyword">boolean</span> isMainThread)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (subscription.subscriberMethod.threadMode) &#123;</span><br><span class="line">        <span class="keyword">case</span> POSTING:</span><br><span class="line">            invokeSubscriber(subscription, event);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MAIN:</span><br><span class="line">            <span class="keyword">if</span> (isMainThread) &#123;</span><br><span class="line">                invokeSubscriber(subscription, event);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                mainThreadPoster.enqueue(subscription, event);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> MAIN_ORDERED:</span><br><span class="line">            <span class="keyword">if</span> (mainThreadPoster != <span class="keyword">null</span>) &#123;</span><br><span class="line">                mainThreadPoster.enqueue(subscription, event);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                invokeSubscriber(subscription, event);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> BACKGROUND:</span><br><span class="line">            <span class="keyword">if</span> (isMainThread) &#123;</span><br><span class="line">                backgroundPoster.enqueue(subscription, event);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                invokeSubscriber(subscription, event);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ASYNC:</span><br><span class="line">            asyncPoster.enqueue(subscription, event);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Unknown thread mode: "</span> + subscription.subscriberMethod.threadMode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šè¿°æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ‹¿åˆ° <code>Subscription</code> ä¸­æˆå‘˜å˜é‡ <code>SubscriberMethod</code> ä¸­çš„çº¿ç¨‹æ¨¡å¼ <code>threadMode</code> æ¥åˆ¤æ–­è®¢é˜…æ–¹æ³•éœ€è¦æ‰§è¡Œçš„çº¿ç¨‹ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ¨¡å¼æ˜¯ <code>POSTING</code> ï¼Œé‚£ä¹ˆé»˜è®¤å°±ç›´æ¥è°ƒç”¨ <code>invokeSubscriber()</code> æ–¹æ³•ã€‚å…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">invokeSubscriber</span><span class="params">(Subscription subscription, Object event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//ğŸ‘‡ç›´æ¥é€šè¿‡åå°„è°ƒç”¨è®¢é˜…æ–¹æ³•ã€‚</span></span><br><span class="line">        subscription.subscriberMethod.method.</span><br><span class="line">        invoke(subscription.subscriber, event);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸ºå…¶ä»–æ¨¡å¼ï¼Œé‚£ä¹ˆä¼šæ ¹æ®ç›¸åº”çš„ <code>poster</code> è°ƒç”¨ <code>enqueue()</code> æ–¹æ³•æ¥æ§åˆ¶æ‰§è¡Œè®¢é˜…æ–¹æ³•æ‰€åœ¨çš„çº¿ç¨‹ã€‚åœ¨ EventBus ä¸­æä¾›äº†å¦‚ä¸‹ä¸‰ä¸ª Poster æ¥æ§åˆ¶è®¢é˜…æ–¹æ³•çš„æ‰€è¿è¡Œçš„çº¿ç¨‹ã€‚</p>
<ul>
<li>HandlerPoster ï¼ˆåˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ï¼‰</li>
<li>BackgroundPoster ï¼ˆåˆ‡æ¢åˆ°åå°çº¿ç¨‹ï¼‰</li>
<li>AsyncPoster ï¼ˆåˆ‡æ¢åˆ°åå°çº¿ç¨‹ï¼‰</li>
</ul>
<p>ä»¥ä¸Šä¸‰ä¸ª Poster éƒ½å®ç°äº† Poster æ¥å£ï¼Œä¸”å†…éƒ¨éƒ½ç»´æŠ¤äº†ä¸€ä¸ªåä¸º <code>PendingPostQueue</code> çš„é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä»¥ <code>PendingPost</code> ä¸ºå­˜å‚¨å•å…ƒï¼Œå…¶ä¸­ <code>PendingPost</code> ä¸­å­˜å‚¨å†…å®¹ä¸ºæˆ‘ä»¬æ ¹æ®å½“å‰äº‹ä»¶æ‰€æ‰¾åˆ°çš„ <code>Subscription</code> ä¸å½“å‰æ‰€å‘ç”Ÿçš„äº‹ä»¶ã€‚</p>
<p>é‚£ä¹ˆç»“åˆæ•´ä¸ªæµç¨‹ï¼Œæˆ‘ä»¬èƒ½å¾—åˆ°ä¸‹å›¾ï¼š</p>
<img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/ç®€å•äº‹ä»¶å‘é€çš„æ•´ä¸ªæµç¨‹.jpg" title="ç®€å•äº‹ä»¶å‘é€çš„æ•´ä¸ªæµç¨‹">
<p>é’ˆå¯¹ä¸Šå›¾ï¼Œå†è¿›è¡Œä¸€ä¸‹ç®€å•çš„è¯´æ˜ã€‚</p>
<ul>
<li>å½“æˆ‘ä»¬è°ƒç”¨ <code>EventBus.post()</code> å‘é€ç®€å•äº‹ä»¶æ—¶ï¼Œä¼šå°†è¯¥äº‹ä»¶æ”¾å…¥ä¸çº¿ç¨‹ç›¸å…³çš„ <code>PostingThreadState</code> çš„ <code>EventQueue</code> ä¸­ã€‚</li>
<li>æ¥ç€ä¼šä»ä¹‹å‰åœ¨ <code>subscriptionsByEventType</code> é›†åˆä¸­æ‰¾åˆ°ä¸è¯¥äº‹ä»¶ç›¸å…³çš„ <code>Subscription</code>ã€‚</li>
<li>æ¥ç€å°†æ‰¾åˆ°çš„ <code>Subscription</code> ä¸å½“å‰æ‰€å‘é€çš„äº‹ä»¶éƒ½å°è£…ä¸º <code>PendingPost</code> å¹¶æ·»åŠ åˆ°å¯¹åº” <code>Poster</code> ä¸­çš„ <code>PendingPostQueue</code> é˜Ÿåˆ—ä¸­ã€‚</li>
<li>æœ€åå¯¹åº”çš„ <code>Poster</code> ä»é˜Ÿåˆ—ä¸­å–å‡ºç›¸åº”çš„ <code>PendingPost</code>,é€šè¿‡åå°„è°ƒç”¨è®¢é˜…è€…çš„è®¢é˜…æ–¹æ³•ã€‚</li>
</ul>
<p>å…¶ä¸­è®¢é˜…æ–¹æ³•æ‰§è¡Œçº¿ç¨‹çš„è§„åˆ™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/è®¢é˜…æ–¹æ³•è§„åˆ™.png" title="è®¢é˜…æ–¹æ³•è§„åˆ™">
<h4 id="çº¿ç¨‹çš„åˆ‡æ¢"><a href="#çº¿ç¨‹çš„åˆ‡æ¢" class="headerlink" title="çº¿ç¨‹çš„åˆ‡æ¢"></a>çº¿ç¨‹çš„åˆ‡æ¢</h4><p>åœ¨ä¸ŠèŠ‚ä¸­ï¼Œè®¢é˜…è€…çš„è®¢é˜…æ–¹æ³•æ‰§è¡Œçš„æ‰€åœ¨çº¿ç¨‹ï¼Œæ˜¯ç”± EventBus ä¸­å†…éƒ¨çš„ä¸‰ä¸ª <code>Poster</code>æ¥å®ç°çš„ã€‚é‚£ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸‰ä¸ª <code>Poster</code> çš„å®ç°ã€‚</p>
<h5 id="HandlerPoster"><a href="#HandlerPoster" class="headerlink" title="HandlerPoster"></a>HandlerPoster</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerPoster</span> <span class="keyword">extends</span> <span class="title">Handler</span> <span class="keyword">implements</span> <span class="title">Poster</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PendingPostQueue queue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> maxMillisInsideHandleMessage;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EventBus eventBus;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> handlerActive;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é»˜è®¤ä¼šä¼ é€’ä¸»çº¿ç¨‹çš„Looper</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">HandlerPoster</span><span class="params">(EventBus eventBus, Looper looper, <span class="keyword">int</span> maxMillisInsideHandleMessage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(looper);</span><br><span class="line">        <span class="keyword">this</span>.eventBus = eventBus;</span><br><span class="line">        <span class="keyword">this</span>.maxMillisInsideHandleMessage = maxMillisInsideHandleMessage;</span><br><span class="line">        queue = <span class="keyword">new</span> PendingPostQueue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(Subscription subscription, Object event)</span> </span>&#123;</span><br><span class="line">        PendingPost pendingPost = PendingPost.obtainPendingPost(subscription, event);</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="comment">//ğŸ‘‡è¿™é‡Œå°†PedingPostæ”¾å…¥PendingPostQueueä¸­ï¼Œç„¶åå‘é€æ¶ˆæ¯</span></span><br><span class="line">            queue.enqueue(pendingPost);</span><br><span class="line">            <span class="keyword">if</span> (!handlerActive) &#123;</span><br><span class="line">                handlerActive = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">if</span> (!sendMessage(obtainMessage())) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Could not send handler message"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> rescheduled = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> started = SystemClock.uptimeMillis();</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="comment">//ğŸ‘‡ä»é˜Ÿåˆ—ä¸­å–å‡ºæœ€è¿‘çš„PendingPost</span></span><br><span class="line">                PendingPost pendingPost = queue.poll();</span><br><span class="line">                <span class="keyword">if</span> (pendingPost == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">                        <span class="comment">// Check again, this time in synchronized</span></span><br><span class="line">                        pendingPost = queue.poll();</span><br><span class="line">                        <span class="keyword">if</span> (pendingPost == <span class="keyword">null</span>) &#123;</span><br><span class="line">                            handlerActive = <span class="keyword">false</span>;</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//ğŸ‘‡ç›´æ¥é€šè¿‡åå°„ï¼Œè°ƒç”¨è®¢é˜…è€…çš„è®¢é˜…æ–¹æ³•ã€‚</span></span><br><span class="line">                eventBus.invokeSubscriber(pendingPost);</span><br><span class="line">                <span class="keyword">long</span> timeInMethod = SystemClock.uptimeMillis() - started;</span><br><span class="line">                <span class="keyword">if</span> (timeInMethod &gt;= maxMillisInsideHandleMessage) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!sendMessage(obtainMessage())) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Could not send handler message"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    rescheduled = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            handlerActive = rescheduled;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HanderPoster ä¸­çš„é€»è¾‘éå¸¸å®¹æ˜“ç†è§£ï¼Œç»§æ‰¿ Handlerï¼Œå¹¶åœ¨åˆå§‹åŒ–çš„æ—¶å€™é»˜è®¤ä¼šå…³è” <code>ä¸»çº¿ç¨‹</code> çš„ Looperï¼Œè¿™æ ·è¯¥ Handler æ‰€å‘é€çš„æ¶ˆæ¯å°†ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­è¢«å¤„ç†ã€‚</p>
<p>åˆ†æä¸€ä¸‹ HanderPoster ä¸­ä¸»è¦çš„æ­¥éª¤ï¼š</p>
<ul>
<li>åœ¨è°ƒç”¨ <code>enqueue()</code> æ–¹æ³•æ—¶ï¼Œä¼šå°†ä¹‹å‰æˆ‘ä»¬å°è£…å¥½çš„ <code>PendingPost</code> æ”¾å…¥ <code>PendingPostQueue</code> é˜Ÿåˆ—ä¸­ï¼ŒåŒæ—¶å‘é€æ¶ˆæ¯ã€‚</li>
<li>åœ¨ <code>handleMessage()</code> æ–¹æ³•ä¸­ï¼Œä» <code>PendingPostQueue</code> é˜Ÿåˆ—ä¸­å–å‡ºæœ€è¿‘çš„ <code>PendingPost</code>ï¼Œç„¶åç›´æ¥é€šè¿‡ <code>eventBus.invokeSubscriber()</code> åå°„æ‰§è¡Œè®¢é˜…è€…çš„è®¢é˜…æ–¹æ³•ã€‚</li>
</ul>
<h5 id="BackgroundPoster"><a href="#BackgroundPoster" class="headerlink" title="BackgroundPoster"></a>BackgroundPoster</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BackgroundPoster</span> <span class="keyword">implements</span> <span class="title">Runnable</span>, <span class="title">Poster</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PendingPostQueue queue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EventBus eventBus;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> executorRunning;</span><br><span class="line"></span><br><span class="line">    BackgroundPoster(EventBus eventBus) &#123;</span><br><span class="line">        <span class="keyword">this</span>.eventBus = eventBus;</span><br><span class="line">        queue = <span class="keyword">new</span> PendingPostQueue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(Subscription subscription, Object event)</span> </span>&#123;</span><br><span class="line">        PendingPost pendingPost = PendingPost.obtainPendingPost(subscription, event);</span><br><span class="line">        <span class="comment">//ä½¿ç”¨çº¿ç¨‹æ± æ¥æäº¤ä»»åŠ¡ï¼Œè¯¥æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            queue.enqueue(pendingPost);</span><br><span class="line">            <span class="keyword">if</span> (!executorRunning) &#123;</span><br><span class="line">                executorRunning = <span class="keyword">true</span>;</span><br><span class="line">                eventBus.getExecutorService().execute(<span class="keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                    PendingPost pendingPost = queue.poll(<span class="number">1000</span>);</span><br><span class="line">                    <span class="keyword">if</span> (pendingPost == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">                            <span class="comment">// Check again, this time in synchronized</span></span><br><span class="line">                            pendingPost = queue.poll();</span><br><span class="line">                            <span class="keyword">if</span> (pendingPost == <span class="keyword">null</span>) &#123;</span><br><span class="line">                                executorRunning = <span class="keyword">false</span>;</span><br><span class="line">                                <span class="keyword">return</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    eventBus.invokeSubscriber(pendingPost);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                eventBus.getLogger().log(Level.WARNING, Thread.currentThread().getName() + <span class="string">" was interruppted"</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            executorRunning = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BackgroundPoster ä¸ HandlerPoster æœ€å¤§çš„ä¸åŒæ˜¯å…¶å†…éƒ¨ä½¿ç”¨äº†çº¿ç¨‹æ± ï¼Œå¹¶ä¸”è¯¥ç±»ä¹Ÿå®ç°äº† Runnable æ¥å£ã€‚</p>
<p>åœ¨ BackgroundPoster ä¸­çš„ <code>enqueue()</code> æ–¹æ³•ä¸­ï¼Œé»˜è®¤ä¼šä½¿ç”¨ EventBus ä¸­é»˜è®¤çš„çº¿ç¨‹æ±  <code>DEFAULT_EXECUTOR_SERVICE</code>æ¥æäº¤ä»»åŠ¡ ï¼Œè¯¥çº¿ç¨‹æ± çš„å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> ExecutorService DEFAULT_EXECUTOR_SERVICE = Executors.newCachedThreadPool();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>CachedThreadPool é€‚ç”¨äºå¤§é‡çš„ä¸”è€—æ—¶è¾ƒå°‘çš„ä»»åŠ¡</p>
</blockquote>
<p>åŒæ ·çš„ï¼ŒBackgroundPoster ä¹Ÿå°±æ˜¯é€šè¿‡åå°„è°ƒç”¨è®¢é˜…è€…çš„è®¢é˜…æ–¹æ³•ï¼Œåªä¸è¿‡ä¸åŒçš„æ˜¯å®ƒæ˜¯æ”¾å…¥çº¿ç¨‹æ± ä¸­çš„éä¸»çº¿ç¨‹ä¸­è¿›è¡Œæ‰§è¡Œã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ä¸ç®¡æ˜¯åœ¨ä»»ä½•çº¿ç¨‹ä¸­å‘é€æ¶ˆæ¯ï¼ŒEventBus æ€»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä» BackgroundPoster çš„ä»£ç ä¸­æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºã€‚</p>
<h5 id="AsyncPoster"><a href="#AsyncPoster" class="headerlink" title="AsyncPoster"></a>AsyncPoster</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncPoster</span> <span class="keyword">implements</span> <span class="title">Runnable</span>, <span class="title">Poster</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PendingPostQueue queue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EventBus eventBus;</span><br><span class="line"></span><br><span class="line">    AsyncPoster(EventBus eventBus) &#123;</span><br><span class="line">        <span class="keyword">this</span>.eventBus = eventBus;</span><br><span class="line">        queue = <span class="keyword">new</span> PendingPostQueue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(Subscription subscription, Object event)</span> </span>&#123;</span><br><span class="line">        PendingPost pendingPost = PendingPost.obtainPendingPost(subscription, event);</span><br><span class="line">        queue.enqueue(pendingPost);</span><br><span class="line">        eventBus.getExecutorService().execute(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PendingPost pendingPost = queue.poll();</span><br><span class="line">        <span class="keyword">if</span>(pendingPost == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"No pending post available"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        eventBus.invokeSubscriber(pendingPost);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°±ä¸å¯¹ AsyncPoster è¿›è¡Œè®²è§£äº†ï¼Œç›¸ä¿¡å¤§å®¶æ ¹æ®ä¹‹å‰çš„å†…å®¹ä¹Ÿèƒ½ç†è§£ã€‚</p>
<h4 id="ç²˜æ€§äº‹ä»¶çš„å‘é€"><a href="#ç²˜æ€§äº‹ä»¶çš„å‘é€" class="headerlink" title="ç²˜æ€§äº‹ä»¶çš„å‘é€"></a>ç²˜æ€§äº‹ä»¶çš„å‘é€</h4><p>ç°åœ¨æˆ‘ä»¬è¿˜å‰©æœ€åä¸€ä¸ªçŸ¥è¯†ç‚¹äº†ï¼Œå°±æ˜¯ç²˜æ€§äº‹ä»¶çš„å‘é€ã€‚åœ¨ EventBus ä¸­å‘é€ç²˜æ€§äº‹ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨æ–¹æ³• <code>postSticky()</code> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postSticky</span><span class="params">(Object event)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (stickyEvents) &#123;</span><br><span class="line">          stickyEvents.put(event.getClass(), event);</span><br><span class="line">      &#125;</span><br><span class="line">      post(event);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹å‡ºï¼Œç²˜æ€§çš„äº‹ä»¶å‘é€ä¸ç®€å•äº‹ä»¶çš„å‘é€å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å°†å‘é€çš„äº‹ä»¶æ·»åŠ åˆ° <code>stickyEvents</code> é›†åˆä¸­å»äº†ã€‚é‚£ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿåœ¨äº†è§£å…·ä½“çš„åŸå› ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ç²˜æ€§äº‹ä»¶çš„æ¦‚å¿µã€‚</p>
<p>ç²˜æ€§äº‹ä»¶çš„æ¦‚å¿µï¼šå½“è®¢é˜…è€…è¿˜æ²¡æœ‰è®¢é˜…ç›¸å…³äº‹ä»¶ <code>A</code> æ—¶ï¼Œç¨‹åºå·²ç»å‘é€äº†ä¸€äº›äº‹ä»¶ <code>A</code>ï¼ŒæŒ‰ç…§æ­£å¸¸çš„é€»è¾‘ï¼Œå½“è®¢é˜…è€…å¼€å§‹è®¢é˜…äº‹ä»¶ <code>A</code> æ—¶ï¼Œæ˜¯æ¥å—ä¸åˆ°ç¨‹åºå·²ç»å‘é€è¿‡çš„äº‹ä»¶ <code>A</code> ,ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›æ¥å—åˆ°é‚£äº›å·²ç»å‘é€è¿‡çš„æ¶ˆæ¯ã€‚è¿™ç§å·²ç»è¿‡æ—¶ï¼Œä½†åˆè¢«é‡æ–°æ¥å—çš„äº‹ä»¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç²˜æ€§äº‹ä»¶ã€‚</p>
<p>é‚£ä¹ˆæ ¹æ®ç²˜æ€§äº‹ä»¶çš„æ€æƒ³ï¼Œæˆ‘ä»¬éœ€è¦å°†å·²ç»å‘é€çš„äº‹ä»¶å­˜å‚¨ä¸‹æ¥ï¼Œå¹¶åœ¨ç²˜æ€§äº‹ä»¶çš„è®¢é˜…çš„è¿‡ç¨‹ä¸­è¿›è¡Œç‰¹åˆ«çš„å¤„ç†ï¼Œä¹Ÿå°±æ˜¯åœ¨ <code>EventBus.register()</code> æ–¹æ³•ä¸­è¿›è¡Œå¤„ç†ã€‚è¿˜è®°å¾—ä¹‹å‰æ³¨å†Œè¿‡ç¨‹ä¸­çš„ <code>subscribe()</code> æ–¹æ³•å—ï¼Ÿè¯¥æ–¹æ³•å†…éƒ¨å¯¹ç²˜æ€§äº‹ä»¶è¿›è¡Œäº†ç‰¹æ®Šçš„å¤„ç†ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Object subscriber, SubscriberMethod subscriberMethod)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line">       <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯ç²˜æ€§äº‹ä»¶</span></span><br><span class="line">       <span class="keyword">if</span> (subscriberMethod.sticky) &#123;</span><br><span class="line">           <span class="comment">//ğŸ‘‡æ”¯æŒäº‹ä»¶ä¼ é€’çš„ç²˜æ€§äº‹ä»¶</span></span><br><span class="line">           <span class="keyword">if</span> (eventInheritance) &#123;</span><br><span class="line">               Set&lt;Map.Entry&lt;Class&lt;?&gt;, Object&gt;&gt; entries = stickyEvents.entrySet();</span><br><span class="line">               <span class="keyword">for</span> (Map.Entry&lt;Class&lt;?&gt;, Object&gt; entry : entries) &#123;</span><br><span class="line">                   Class&lt;?&gt; candidateEventType = entry.getKey();</span><br><span class="line">                   <span class="keyword">if</span> (eventType.isAssignableFrom(candidateEventType)) &#123;</span><br><span class="line">                       Object stickyEvent = entry.getValue();</span><br><span class="line">                       checkPostStickyEventToSubscription(newSubscription, stickyEvent);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">//ğŸ‘‡å¼€å§‹æ‰§è¡Œè®¢é˜…æ–¹æ³•ã€‚</span></span><br><span class="line">               Object stickyEvent = stickyEvents.get(eventType);</span><br><span class="line">               checkPostStickyEventToSubscription(newSubscription, stickyEvent);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šè¿°é€»è¾‘ä¸­ï¼Œä¼šä» <code>stickyEvents</code> ä¸­è·å–ä¹‹å‰å‘é€çš„äº‹ä»¶ï¼Œç„¶åè°ƒç”¨ <code>checkPostStickyEventToSubscription()</code>ã€‚è¯¥æ–¹æ³•ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkPostStickyEventToSubscription</span><span class="params">(Subscription newSubscription, Object stickyEvent)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (stickyEvent != <span class="keyword">null</span>) &#123;</span><br><span class="line">           postToSubscription(newSubscription, stickyEvent, isMainThread());</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>åˆå› ä¸º<code>checkPostStickyEventToSubscription()</code> æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨ <code>postToSubscription()</code> æ–¹æ³•ã€‚é‚£ä¹ˆæœ€ç»ˆè®¢é˜…è€…å°±èƒ½æ¥å—åˆ°ä¹‹å‰å‘é€çš„äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„è®¢é˜…æ–¹æ³•å•¦ã€‚</p>
<h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>EventBus ä¸»è¦çš„æµç¨‹åˆ°ç°åœ¨å·²ç»è®²å®Œäº†ã€‚ä»å®é™…çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…èƒ½çœ‹åˆ°å…¶è‰¯å¥½çš„ä»£ç è§„èŒƒä»¥åŠå°è£…æ€æƒ³ã€‚è¿˜èƒ½çœ‹åˆ°è¯¥æ¡†æ¶å¯¹æ€§èƒ½çš„ä¼˜åŒ–ï¼Œå°¤å…¶æ˜¯æ·»åŠ äº†ä¸€äº›å¿…è¦çš„ç¼“å­˜ã€‚æˆ‘ç›¸ä¿¡ä»¥ä¸Šçš„è¿™äº›ç‚¹ï¼Œéƒ½æ˜¯å€¼å¾—æˆ‘ä»¬å€Ÿé‰´ä¸å‚è€ƒçš„ã€‚åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­æˆ‘ä»¬ä¼šè®²è§£ EventBus ä¸­çš„ <code>â€œåŠ é€Ÿå¼•æ“&quot;</code>  ç´¢å¼•ç±»ã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç»§ç»­å…³æ³¨ã€‚</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/EventBus/" rel="tag"># EventBus</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/" rel="next" title="Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€åŠ é€Ÿå¼•æ“â€œï¼ˆäº”ï¼‰">
                <i class="fa fa-chevron-left"></i> Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€åŠ é€Ÿå¼•æ“â€œï¼ˆäº”ï¼‰
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/" rel="prev" title="Androidx ä¸‹ Fragment æ‡’åŠ è½½çš„æ–°å®ç°">
                Androidx ä¸‹ Fragment æ‡’åŠ è½½çš„æ–°å®ç° <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://upload-images.jianshu.io/upload_images/2824145-e320240ea6ec767d.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AndyJennifer">
            
              <p class="site-author-name" itemprop="name">AndyJennifer</p>
              <p class="site-description motion-element" itemprop="description">AndyJennifer ä¸ªäººç«™ï¼Œä¸»è¦æ¶‰åŠAndroidã€Javaã€Kotlinç­‰ç›¸å…³çŸ¥è¯†ï¼Œæ„¿ä¸å¤§å®¶å…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">60</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/AndyJennifer" title="GitHub &rarr; https://github.com/AndyJennifer" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="/andyjennifer@126.com" title="E-Mail &rarr; andyjennifer@126.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#å‰è¨€"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EventBus-ç®€ä»‹"><span class="nav-number">2.</span> <span class="nav-text">EventBus ç®€ä»‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¤§æ¦‚æµç¨‹"><span class="nav-number">3.</span> <span class="nav-text">å¤§æ¦‚æµç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ³¨å†Œæµç¨‹"><span class="nav-number">3.1.</span> <span class="nav-text">æ³¨å†Œæµç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#äº‹ä»¶å‘é€æµç¨‹"><span class="nav-number">3.2.</span> <span class="nav-text">äº‹ä»¶å‘é€æµç¨‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æºç åˆ†æ"><span class="nav-number">4.</span> <span class="nav-text">æºç åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#è®¢é˜…è¿‡ç¨‹æºç åˆ†æ"><span class="nav-number">4.1.</span> <span class="nav-text">è®¢é˜…è¿‡ç¨‹æºç åˆ†æ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SubscriberMethodFinder-æŸ¥æ‰¾æ–¹æ³•æµç¨‹"><span class="nav-number">4.2.</span> <span class="nav-text">SubscriberMethodFinder æŸ¥æ‰¾æ–¹æ³•æµç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å®é™…è®¢é˜…æ–¹æ³•-subscribe"><span class="nav-number">4.3.</span> <span class="nav-text">å®é™…è®¢é˜…æ–¹æ³• subscribe</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#äº‹ä»¶å‘é€æµç¨‹æºç åˆ†æ"><span class="nav-number">5.</span> <span class="nav-text">äº‹ä»¶å‘é€æµç¨‹æºç åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç®€å•äº‹ä»¶çš„å‘é€"><span class="nav-number">5.1.</span> <span class="nav-text">ç®€å•äº‹ä»¶çš„å‘é€</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#postToSubscription"><span class="nav-number">5.2.</span> <span class="nav-text">postToSubscription()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#çº¿ç¨‹çš„åˆ‡æ¢"><span class="nav-number">5.3.</span> <span class="nav-text">çº¿ç¨‹çš„åˆ‡æ¢</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#HandlerPoster"><span class="nav-number">5.3.1.</span> <span class="nav-text">HandlerPoster</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BackgroundPoster"><span class="nav-number">5.3.2.</span> <span class="nav-text">BackgroundPoster</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#AsyncPoster"><span class="nav-number">5.3.3.</span> <span class="nav-text">AsyncPoster</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç²˜æ€§äº‹ä»¶çš„å‘é€"><span class="nav-number">5.4.</span> <span class="nav-text">ç²˜æ€§äº‹ä»¶çš„å‘é€</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æœ€å"><span class="nav-number">6.</span> <span class="nav-text">æœ€å</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AndyJennifer</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="ç«™ç‚¹æ€»å­—æ•°">612k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">18:32</span>
  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="æ€»è®¿å®¢é‡">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="æ€»è®¿é—®é‡">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>


  
  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
