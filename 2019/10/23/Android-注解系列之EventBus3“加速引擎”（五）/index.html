<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/bangbangtang-32*32.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/bangbangtang-16*16.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="å‰è¨€åœ¨ä¸Šç¯‡æ–‡ç«  Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰ä¸­æˆ‘ä»¬è®²è§£äº† EventBus3 çš„å†…éƒ¨åŸç†ï¼Œåœ¨è¯¥ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å°†è®²è§£ EventBus3 ä¸­çš„ â€œåŠ é€Ÿå¼•æ“â€œâ€”ç´¢å¼•ç±»ã€‚é˜…è¯»è¯¥ç¯‡æ–‡ç« æˆ‘ä»¬èƒ½å¤Ÿå­¦åˆ°å¦‚ä¸‹çŸ¥è¯†ç‚¹ã€‚  EventBus3 ç´¢å¼•ç±»å‡ºç°çš„åŸå›  EventBus3 ç´¢å¼•ç±»çš„ä½¿ç”¨ EventBus3 ç´¢å¼•ç±»ç”Ÿæˆçš„è¿‡ç¨‹ EventBus3 æ··æ·†æ³¨æ„äº‹é¡¹   å¯¹ APT æŠ€æœ¯ä¸">
<meta name="keywords" content="EventBus">
<meta property="og:type" content="article">
<meta property="og:title" content="Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€åŠ é€Ÿå¼•æ“â€œï¼ˆäº”ï¼‰">
<meta property="og:url" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/index.html">
<meta property="og:site_name" content="AndyJennifer&#39;Blog">
<meta property="og:description" content="å‰è¨€åœ¨ä¸Šç¯‡æ–‡ç«  Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰ä¸­æˆ‘ä»¬è®²è§£äº† EventBus3 çš„å†…éƒ¨åŸç†ï¼Œåœ¨è¯¥ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å°†è®²è§£ EventBus3 ä¸­çš„ â€œåŠ é€Ÿå¼•æ“â€œâ€”ç´¢å¼•ç±»ã€‚é˜…è¯»è¯¥ç¯‡æ–‡ç« æˆ‘ä»¬èƒ½å¤Ÿå­¦åˆ°å¦‚ä¸‹çŸ¥è¯†ç‚¹ã€‚  EventBus3 ç´¢å¼•ç±»å‡ºç°çš„åŸå›  EventBus3 ç´¢å¼•ç±»çš„ä½¿ç”¨ EventBus3 ç´¢å¼•ç±»ç”Ÿæˆçš„è¿‡ç¨‹ EventBus3 æ··æ·†æ³¨æ„äº‹é¡¹   å¯¹ APT æŠ€æœ¯ä¸">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/bus.jpg">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/EventBus3ä¼˜åŒ–.jpg">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/eventbus3-registration-perf-nexus9m.png">
<meta property="og:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/EventBusæ³¨è§£å¤„ç†å™¨.png">
<meta property="og:updated_time" content="2019-10-22T16:21:55.720Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€åŠ é€Ÿå¼•æ“â€œï¼ˆäº”ï¼‰">
<meta name="twitter:description" content="å‰è¨€åœ¨ä¸Šç¯‡æ–‡ç«  Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰ä¸­æˆ‘ä»¬è®²è§£äº† EventBus3 çš„å†…éƒ¨åŸç†ï¼Œåœ¨è¯¥ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å°†è®²è§£ EventBus3 ä¸­çš„ â€œåŠ é€Ÿå¼•æ“â€œâ€”ç´¢å¼•ç±»ã€‚é˜…è¯»è¯¥ç¯‡æ–‡ç« æˆ‘ä»¬èƒ½å¤Ÿå­¦åˆ°å¦‚ä¸‹çŸ¥è¯†ç‚¹ã€‚  EventBus3 ç´¢å¼•ç±»å‡ºç°çš„åŸå›  EventBus3 ç´¢å¼•ç±»çš„ä½¿ç”¨ EventBus3 ç´¢å¼•ç±»ç”Ÿæˆçš„è¿‡ç¨‹ EventBus3 æ··æ·†æ³¨æ„äº‹é¡¹   å¯¹ APT æŠ€æœ¯ä¸">
<meta name="twitter:image" content="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/bus.jpg">






  <link rel="canonical" href="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€åŠ é€Ÿå¼•æ“â€œï¼ˆäº”ï¼‰ | AndyJennifer'Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">AndyJennifer'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">What would life be if we had no courage to attempt anything?</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/AndyJennifer" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="AndyJennifer">
      <meta itemprop="description" content="AndyJennifer ä¸ªäººç«™ï¼Œä¸»è¦æ¶‰åŠAndroidã€Javaã€Kotlinç­‰ç›¸å…³çŸ¥è¯†ï¼Œæ„¿ä¸å¤§å®¶å…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥">
      <meta itemprop="image" content="http://upload-images.jianshu.io/upload_images/2824145-e320240ea6ec767d.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AndyJennifer'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€åŠ é€Ÿå¼•æ“â€œï¼ˆäº”ï¼‰

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-10-23 00:16:48 / ä¿®æ”¹æ—¶é—´ï¼š00:21:55" itemprop="dateCreated datePublished" datetime="2019-10-23T00:16:48+08:00">2019-10-23</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/æºç åˆ†æ/" itemprop="url" rel="index"><span itemprop="name">æºç åˆ†æ</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             é˜…è¯»æ¬¡æ•°ï¼š 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">22k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">40 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/bus.jpg" title="bus">
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨ä¸Šç¯‡æ–‡ç«  <a href="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/" title="Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰">Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰</a>ä¸­æˆ‘ä»¬è®²è§£äº† EventBus3 çš„å†…éƒ¨åŸç†ï¼Œåœ¨è¯¥ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å°†è®²è§£ EventBus3 ä¸­çš„ <code>â€œåŠ é€Ÿå¼•æ“â€œ</code>â€”ç´¢å¼•ç±»ã€‚é˜…è¯»è¯¥ç¯‡æ–‡ç« æˆ‘ä»¬èƒ½å¤Ÿå­¦åˆ°å¦‚ä¸‹çŸ¥è¯†ç‚¹ã€‚</p>
<ul>
<li>EventBus3 ç´¢å¼•ç±»å‡ºç°çš„åŸå› </li>
<li>EventBus3 ç´¢å¼•ç±»çš„ä½¿ç”¨</li>
<li>EventBus3 ç´¢å¼•ç±»ç”Ÿæˆçš„è¿‡ç¨‹</li>
<li>EventBus3 æ··æ·†æ³¨æ„äº‹é¡¹</li>
</ul>
<blockquote>
<p>å¯¹ APT æŠ€æœ¯ä¸ç†Ÿæ‚‰çš„å°ä¼™ä¼´ï¼Œå¯ä»¥æŸ¥çœ‹æ–‡ç«  <a href="/2019/02/23/Android-æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)/" title="Android æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)">Android æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)</a></p>
</blockquote>
<h3 id="å‰æ™¯å›é¡¾"><a href="#å‰æ™¯å›é¡¾" class="headerlink" title="å‰æ™¯å›é¡¾"></a>å‰æ™¯å›é¡¾</h3><p>åœ¨  <a href="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/" title="Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰">Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰</a>ä¸­ï¼Œæˆ‘ä»¬ç‰¹åˆ«æŒ‡å‡ºåœ¨ EventBus3 ä¸­ä¼˜åŒ–äº† <code>SubscriberMethodFinder</code> è·å–ç±»ä¸­åŒ…å« <code>@Subscribe</code> æ³¨è§£çš„è®¢é˜…æ–¹æ³•çš„æµç¨‹ã€‚ä½¿å…¶èƒ½åœ¨ <code>EventBus.register()</code> æ–¹æ³•è°ƒç”¨ä¹‹å‰å°±èƒ½çŸ¥é“ç›¸å…³è®¢é˜…äº‹ä»¶çš„æ–¹æ³•ï¼Œè¿™æ ·å°±å‡å°‘äº†ç¨‹åºåœ¨è¿è¡ŒæœŸé—´ä½¿ç”¨åå°„éå†è·å–æ–¹æ³•æ‰€å¸¦æ¥çš„æ—¶é—´æ¶ˆè€—ã€‚ä¼˜åŒ–ç‚¹å¦‚ä¸‹å›¾ä¸­ <code>çº¢è‰²è™šçº¿æ¡†</code> æ‰€ç¤ºï¼š</p>
<img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/EventBus3ä¼˜åŒ–.jpg" title="EventBus3ä¼˜åŒ–">
<p>EventBus ä½œè€… <a href="http://androiddevblog.com/eventbus-3-droidcon/" target="_blank" rel="noopener">Markus Junginger</a> ä¹Ÿç»™å‡ºäº†ä½¿ç”¨ç´¢å¼•ç±»å‰å EventBus çš„æ•ˆç‡å¯¹æ¯”ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/eventbus3-registration-perf-nexus9m.png" title="eventbus3-registration-perf-nexus9m">
<p>ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç´¢å¼•ç±»åï¼ŒEventBus çš„æ•ˆç‡æœ‰ç€æ˜æ˜¾çš„æå‡ï¼Œè€Œæ•ˆç‡æå‡çš„èƒŒåï¼Œæ­£æ˜¯ä½¿ç”¨äº† <code>APT</code> æŠ€æœ¯æ‰€åˆ›å»ºçš„<code>ç´¢å¼•ç±»</code>ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹ä¸€çœ‹ EventBus3 ä¸­æ˜¯å¦‚ä½•ç»“åˆ <code>APT</code> æŠ€æœ¯æ¥è¿›è¡Œä¼˜åŒ–çš„ã€‚</p>
<h3 id="å…³é”®ä»£ç "><a href="#å…³é”®ä»£ç " class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h3><p>é˜…è¯»è¿‡ EventBus3 æºç çš„å°ä¼™ä¼´åº”è¯¥éƒ½çŸ¥é“ï¼Œåœ¨ EventBus3 ä¸­è·å–ç±»ä¸­åŒ…å« <code>@Subscribe</code> æ³¨è§£çš„è®¢é˜…æ–¹æ³•æœ‰ä¸¤ç§æ–¹å¼ã€‚</p>
<ul>
<li>ç¬¬ä¸€ç§ï¼šæ˜¯ç›´æ¥åœ¨ç¨‹åºè¿è¡Œæ—¶åå°„è·å–</li>
<li>ç¬¬äºŒç§ï¼šå°±æ˜¯é€šè¿‡ç´¢å¼•ç±»ã€‚</li>
</ul>
<p>è€Œä½¿ç”¨ç´¢å¼•ç±»çš„å…³é”®ä»£ç ä¸º <code>SubscriberMethodFinder</code> ä¸­çš„<br><a href="https://github.com/greenrobot/EventBus/blob/master/EventBus/src/org/greenrobot/eventbus/SubscriberMethodFinder.java#L122" target="_blank" rel="noopener">getSubscriberInfo()</a> æ–¹æ³•ä¸ <a href="https://github.com/greenrobot/EventBus/blob/master/EventBus/src/org/greenrobot/eventbus/SubscriberMethodFinder.java#L75" target="_blank" rel="noopener">findUsingInfo()</a> æ–¹æ³• ã€‚<br>æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<h4 id="findUsingInfo-æ–¹æ³•"><a href="#findUsingInfo-æ–¹æ³•" class="headerlink" title="findUsingInfo æ–¹æ³•"></a>findUsingInfo æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> List&lt;SubscriberMethod&gt; <span class="title">findUsingInfo</span><span class="params">(Class&lt;?&gt; subscriberClass)</span> </span>&#123;</span><br><span class="line">    FindState findState = prepareFindState();</span><br><span class="line">    findState.initForSubscriber(subscriberClass);</span><br><span class="line">    <span class="keyword">while</span> (findState.clazz != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//ğŸ‘‡å…³é”®ä»£ç ï¼Œä»ç´¢å¼•ç±»ä¸­è·å– SubscriberInfo</span></span><br><span class="line">        findState.subscriberInfo = getSubscriberInfo(findState);</span><br><span class="line">        <span class="comment">//æ–¹å¼1ï¼šå¦‚æœ subscriberInfo ä¸ä¸ºç©ºï¼Œåˆ™ä»è¯¥å¯¹è±¡ä¸­è·å– SubscriberMethod å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> (findState.subscriberInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">            SubscriberMethod[] array = findState.subscriberInfo.getSubscriberMethods();</span><br><span class="line">            <span class="keyword">for</span> (SubscriberMethod subscriberMethod : array) &#123;</span><br><span class="line">                <span class="keyword">if</span> (findState.checkAdd(subscriberMethod.method, subscriberMethod.eventType)) &#123;</span><br><span class="line">                    findState.subscriberMethods.add(subscriberMethod);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//æ–¹å¼2ï¼šå¦‚æœ subscriberInfo ä¸ºç©ºï¼Œé‚£ä¹ˆç›´æ¥é€šè¿‡åå°„è·å–</span></span><br><span class="line">            findUsingReflectionInSingleClass(findState);</span><br><span class="line">        &#125;</span><br><span class="line">        findState.moveToSuperclass();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> getMethodsAndRelease(findState);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬èƒ½ä»è¯¥æ–¹æ³•ä¸­è·å¾—ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>EventBus3 ä¸­é»˜è®¤ä¼šè°ƒç”¨ <a href="https://github.com/greenrobot/EventBus/blob/master/EventBus/src/org/greenrobot/eventbus/SubscriberMethodFinder.java#L122" target="_blank" rel="noopener">getSubscriberInfo()</a> æ–¹æ³•å»è·å– subscriberInfo å¯¹è±¡ä¿¡æ¯ã€‚</li>
<li>å¦‚æœ subscriberInfo ä¸ä¸ºç©ºï¼Œåˆ™ä¼šä»è¯¥å¯¹è±¡ä¸­è·å– <code>SubscriberMethod</code> æ•°ç»„ã€‚</li>
<li>å¦‚æœ subscriberInfo ä¸ºç©ºï¼Œé‚£ä¹ˆä¼šç›´æ¥é€šè¿‡<code>åå°„</code>å»è·å– <code>SubscriberMethod</code> é›†åˆä¿¡æ¯ã€‚</li>
</ul>
<blockquote>
<p>SubscriberMethod ç±»ä¸­å«æœ‰ <code>@Subscribe</code> æ³¨è§£çš„æ–¹æ³•ä¿¡æ¯å°è£…ï¼ˆä¼˜å…ˆçº§ï¼Œæ˜¯å¦ç²˜æ€§ï¼Œçº¿ç¨‹æ¨¡å¼,è®¢é˜…çš„äº‹ä»¶ï¼‰ï¼Œä»¥åŠå½“å‰æ–¹æ³•çš„ Method å¯¹è±¡(<code>java.lang.reflect</code> åŒ…ä¸‹çš„å¯¹è±¡)ã€‚</p>
</blockquote>
<p>ä¹Ÿå°±è¯´ EventBus æ˜¯å¦é€šè¿‡åå°„è·å–ä¿¡æ¯ï¼Œæ˜¯ç”± getSubscriberInfoï¼ˆï¼‰æ–¹æ³•æ¥å†³å®šï¼Œé‚£ä¹ˆæˆ‘ä»¬æŸ¥çœ‹è¯¥æ–¹æ³•ã€‚</p>
<h4 id="getSubscriberInfo-æ–¹æ³•"><a href="#getSubscriberInfo-æ–¹æ³•" class="headerlink" title="getSubscriberInfo æ–¹æ³•"></a>getSubscriberInfo æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> SubscriberInfo <span class="title">getSubscriberInfo</span><span class="params">(FindState findState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (findState.subscriberInfo != <span class="keyword">null</span> &amp;&amp; findState.subscriberInfo.getSuperSubscriberInfo() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        SubscriberInfo superclassInfo = findState.subscriberInfo.getSuperSubscriberInfo();</span><br><span class="line">        <span class="keyword">if</span> (findState.clazz == superclassInfo.getSubscriberClass()) &#123;</span><br><span class="line">            <span class="keyword">return</span> superclassInfo;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ğŸ‘‡è¿™é‡Œæ˜¯EventBus3ä¸­ä¼˜åŒ–çš„å…³é”®ï¼Œç´¢å¼•ç±»</span></span><br><span class="line">    <span class="keyword">if</span> (subscriberInfoIndexes != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (SubscriberInfoIndex index : subscriberInfoIndexes) &#123;</span><br><span class="line">            SubscriberInfo info = index.getSubscriberInfo(findState.clazz);</span><br><span class="line">            <span class="keyword">if</span> (info != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> info;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä»£ç é€»è¾‘ä¸­æˆ‘ä»¬èƒ½å¾—å‡ºï¼Œå¦‚æœ <code>subscriberInfoIndexes</code> é›†åˆä¸ä¸ºç©ºçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šä» <code>SubscriberInfoIndexï¼ˆç´¢å¼•ç±»ï¼‰</code> ä¸­å»è·å– <code>SubscriberInfo</code> å¯¹è±¡ä¿¡æ¯ã€‚è¯¥æ–¹æ³•çš„é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œå”¯ä¸€çš„ç–‘æƒ‘å°±æ˜¯è¿™ä¸ª SubscriberInfoIndex(ç´¢å¼•ç±») å¯¹è±¡æ˜¯ä»ä½•è€Œæ¥çš„å‘¢ï¼Ÿ</p>
<p>èªæ˜çš„å°ä¼™ä¼´ä»¬å·²ç»æƒ³åˆ°äº†ã€‚å¯¹ï¼ï¼ï¼å°±æ˜¯é€šè¿‡ APT æŠ€æœ¯è‡ªåŠ¨ç”Ÿæˆçš„ç±»ã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆä½¿ç”¨ EventBus3 ä¸­çš„ç´¢å¼•ç±»ï¼Ÿä»¥åŠ EventBus3 ä¸­æ˜¯å¦‚ä½•ç”Ÿæˆçš„ç´¢å¼•ç±»çš„å‘¢ï¼Ÿ ä¸æ€¥ä¸æ€¥ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªçš„è§£å†³é—®é¢˜ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ç´¢å¼•ç±»ã€‚</p>
<h3 id="EventBusä¸­ç´¢å¼•ç±»çš„ä½¿ç”¨"><a href="#EventBusä¸­ç´¢å¼•ç±»çš„ä½¿ç”¨" class="headerlink" title="EventBusä¸­ç´¢å¼•ç±»çš„ä½¿ç”¨"></a>EventBusä¸­ç´¢å¼•ç±»çš„ä½¿ç”¨</h3><p>å¦‚æœéœ€è¦ä½¿ç”¨ EventBus3 ä¸­çš„ç´¢å¼•ç±»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ App çš„ <code>build.gradle</code> ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        javaCompileOptions &#123;</span><br><span class="line">            annotationProcessorOptions &#123;</span><br><span class="line">                <span class="comment">// æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µï¼ŒæŒ‡å®šç´¢å¼•ç±»çš„åç§°å’ŒåŒ…å</span></span><br><span class="line">                arguments = [ eventBusIndex : <span class="string">'com.eventbus.project.EventBusIndex'</span> ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    implementation <span class="string">'org.greenrobot:eventbus:3.1.1'</span></span><br><span class="line">    <span class="comment">// å¼•å…¥æ³¨è§£å¤„ç†å™¨</span></span><br><span class="line">    annotationProcessor <span class="string">'org.greenrobot:eventbus-annotation-processor:3.1.1'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœæœ‰å°ä¼™ä¼´ä¸ç†Ÿæ‚‰ gradle é…ç½®ï¼Œå¯ä»¥æŸ¥çœ‹ <a href="http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.AnnotationProcessorOptions.html" target="_blank" rel="noopener">AnnotationProcessorOptions</a></p>
</blockquote>
<p>åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å¦‚æœä½ ä¸ä½¿ç”¨ç´¢å¼•ç±»ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦è®¾ç½® <code>annotationProcessorOptions</code> å‚æ•°ä¸­çš„å€¼ã€‚ä¹Ÿæ²¡æœ‰å¿…è¦å¼•å…¥ EventBus çš„æ³¨è§£å¤„ç†å™¨ã€‚</li>
<li>å¦‚æœè¦ä½¿ç”¨ç´¢å¼•ç±»ï¼Œå¹¶ä¸”ä¹Ÿå¼•å…¥äº† EventBus çš„æ³¨è§£å¤„ç†å™¨ï¼ˆeventbus-annotation-processorï¼‰ï¼Œä½†å´æ²¡æœ‰è®¾ç½® arguments çš„è¯ï¼Œç¼–è¯‘æ—¶å°±ä¼šæŠ¥é”™ï¼š<code>No option eventBusIndex passed to annotation processor</code>ã€‚</li>
<li>ç´¢å¼•ç±»çš„ç”Ÿæˆï¼Œéœ€è¦æˆ‘ä»¬å¯¹ä»£ç é‡æ–°ç¼–è¯‘ã€‚ç¼–è¯‘æˆåŠŸåï¼Œå…¶è¯¥ç±»å¯¹åº”è·¯å¾„ä¸º<code>\ProjectName\app\build\generated\source\apt\ä½ è®¾ç½®çš„åŒ…å</code>ã€‚</li>
</ul>
<p>å½“æˆ‘ä»¬çš„ç´¢å¼•ç±»ç”Ÿæˆåï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨åˆå§‹åŒ– EventBus æ—¶åº”ç”¨æˆ‘ä»¬ç”Ÿæˆçš„ç´¢å¼•ç±»ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EventBus.builder().addIndex(<span class="keyword">new</span> EventBusIndex()).installDefaultEventBus();</span><br></pre></td></tr></table></figure>
<p>ä¹‹æ‰€ä»¥è¦é…ç½®ç´¢å¼•ç±»ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬ç”Ÿæˆçš„ç´¢å¼•ç±»æ·»åŠ åˆ° <code>subscriberInfoIndexes</code> é›†åˆä¸­ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½ä»ä¹‹å‰è®²è§£çš„ <code>getSubscriberInfoï¼ˆï¼‰</code>æ‰¾åˆ°æˆ‘ä»¬é…ç½®çš„ç´¢å¼•ç±»ã€‚<code>addIndex()</code> ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">addIndex</span><span class="params">(SubscriberInfoIndex index)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (subscriberInfoIndexes == <span class="keyword">null</span>) &#123;</span><br><span class="line">           subscriberInfoIndexes = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//ğŸ‘‡è¿™é‡Œæ·»åŠ ç´¢å¼•ç±»åˆ° subscriberInfoIndexes é›†åˆä¸­</span></span><br><span class="line">       subscriberInfoIndexes.add(index);</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="ç´¢å¼•ç±»å®é™…ä½¿ç”¨åˆ†æ"><a href="#ç´¢å¼•ç±»å®é™…ä½¿ç”¨åˆ†æ" class="headerlink" title="ç´¢å¼•ç±»å®é™…ä½¿ç”¨åˆ†æ"></a>ç´¢å¼•ç±»å®é™…ä½¿ç”¨åˆ†æ</h4><p>å¦‚æœä½ å·²ç»é…ç½®å¥½äº†ç´¢å¼•ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œè¿™é‡Œæˆ‘é…ç½®çš„ç´¢å¼•ç±»ä¸º <code>EventBusIndex</code> å¯¹åº”åŒ…åä¸ºï¼š <code>&#39;com.eventbus.project&#39;</code> ã€‚æˆ‘åœ¨ EventBusDemo.java ä¸­å£°æ˜äº†å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventBusDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Subscribe</span>(threadMode = ThreadMode.MAIN)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessageEventOne</span><span class="params">(MessageEvent event)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Subscribe</span>(threadMode = ThreadMode.MAIN)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessageEventTwo</span><span class="params">(MessageEvent event)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"world"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡ªåŠ¨ç”Ÿæˆçš„ç´¢å¼•ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventBusIndex</span> <span class="keyword">implements</span> <span class="title">SubscriberInfoIndex</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, SubscriberInfo&gt; SUBSCRIBER_INDEX;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        SUBSCRIBER_INDEX = <span class="keyword">new</span> HashMap&lt;Class&lt;?&gt;, SubscriberInfo&gt;();</span><br><span class="line"></span><br><span class="line">        putIndex(<span class="keyword">new</span> SimpleSubscriberInfo(EventBusDemo.class, <span class="keyword">true</span>, <span class="keyword">new</span> SubscriberMethodInfo[] &#123;</span><br><span class="line">            <span class="keyword">new</span> SubscriberMethodInfo(<span class="string">"onMessageEventOne"</span>, MessageEvent.class, ThreadMode.MAIN),</span><br><span class="line">            <span class="keyword">new</span> SubscriberMethodInfo(<span class="string">"onMessageEventTwo"</span>, MessageEvent.class, ThreadMode.MAIN),</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putIndex</span><span class="params">(SubscriberInfo info)</span> </span>&#123;</span><br><span class="line">        SUBSCRIBER_INDEX.put(info.getSubscriberClass(), info);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SubscriberInfo <span class="title">getSubscriberInfo</span><span class="params">(Class&lt;?&gt; subscriberClass)</span> </span>&#123;</span><br><span class="line">        SubscriberInfo info = SUBSCRIBER_INDEX.get(subscriberClass);</span><br><span class="line">        <span class="keyword">if</span> (info != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> info;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ç”Ÿæˆçš„ç´¢å¼•ç±»ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li>ç”Ÿæˆçš„ç´¢å¼•ç±»ä¸­ï¼Œç»´æŠ¤äº†ä¸€ä¸ª key ä¸º è®¢é˜…å¯¹è±¡ value ä¸º <code>SimpleSubscriberInfo</code> çš„ HashMapã€‚</li>
<li><code>SimpleSubscriberInfo</code> ç±»ä¸­ç»´æŠ¤äº†å½“å‰è®¢é˜…è€…çš„ class å¯¹è±¡ä¸ <code>SubscriberMethodInfo[] æ•°ç»„</code>ã€‚</li>
<li>HashMap ä¸­çš„æ•°æ®æ·»åŠ æ˜¯æ”¾åˆ°é™æ€ä»£ç å—ä¸­æ‰§è¡Œçš„ã€‚</li>
</ul>
<blockquote>
<p>SubscriberMethodInfo ç±»ä¸­å«æœ‰ <code>@Subscribe</code> æ³¨è§£çš„æ–¹æ³•ä¿¡æ¯å°è£…ï¼ˆä¼˜å…ˆçº§ï¼Œæ˜¯å¦ç²˜æ€§ï¼Œçº¿ç¨‹æ¨¡å¼ï¼Œè®¢é˜…çš„äº‹ä»¶ï¼‰ï¼Œä»¥åŠå½“å‰æ–¹æ³•çš„<code>åç§°</code>ã€‚</p>
</blockquote>
<p>åˆ°ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†æˆ‘ä»¬ç´¢å¼•ç±»ä¸­çš„å†…å®¹ï¼Œé‚£ä¹ˆç°åœ¨åœ¨å›åˆ° <code>findUsingInfo()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> List&lt;SubscriberMethod&gt; <span class="title">findUsingInfo</span><span class="params">(Class&lt;?&gt; subscriberClass)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line">    <span class="keyword">while</span> (findState.clazz != <span class="keyword">null</span>) &#123;</span><br><span class="line">        findState.subscriberInfo = getSubscriberInfo(findState);</span><br><span class="line">        <span class="keyword">if</span> (findState.subscriberInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">             <span class="comment">//ğŸ‘‡å…³é”®ä»£ç ï¼Œä»ç´¢å¼•ç±»ä¸­è·å– SubscriberMethod</span></span><br><span class="line">            SubscriberMethod[] array = findState.subscriberInfo.getSubscriberMethods();</span><br><span class="line">            <span class="keyword">for</span> (SubscriberMethod subscriberMethod : array) &#123;</span><br><span class="line">                <span class="keyword">if</span> (findState.checkAdd(subscriberMethod.method, subscriberMethod.eventType)) &#123;</span><br><span class="line">                    findState.subscriberMethods.add(subscriberMethod);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ <code>subscriberInfo</code> ä¸ä¸ºç©ºæ—¶ï¼Œä¼šé€šè¿‡ <code>getSubscriberMethods()</code>æ–¹æ³•ï¼Œå»è·å–ç´¢å¼•ç±»ä¸­ <code>SubscriberMethod[]æ•°ç»„</code> ä¿¡æ¯ã€‚å› ä¸ºç´¢å¼•ç±»ä½¿ç”¨çš„æ˜¯ <code>SimpleSubscriberInfo</code> ç±»ï¼Œæˆ‘ä»¬æŸ¥çœ‹è¯¥ç±»ä¸­è¯¥æ–¹æ³•çš„å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">synchronized</span> SubscriberMethod[] getSubscriberMethods() &#123;</span><br><span class="line">     <span class="keyword">int</span> length = methodInfos.length;</span><br><span class="line">     SubscriberMethod[] methods = <span class="keyword">new</span> SubscriberMethod[length];</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">         SubscriberMethodInfo info = methodInfos[i];</span><br><span class="line">         methods[i] = createSubscriberMethod(info.methodName, info.eventType, info.threadMode,</span><br><span class="line">                 info.priority, info.sticky);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> methods;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿè¯¥ä»£ç ï¼Œæˆ‘ä»¬å‘ç° SubscriberMethod å¯¹è±¡çš„åˆ›å»ºæ˜¯é€šè¿‡ <code>createSubscriberMethod</code> æ–¹æ³•åˆ›å»ºçš„ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¸ªã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> SubscriberMethod <span class="title">createSubscriberMethod</span><span class="params">(String methodName, Class&lt;?&gt; eventType, ThreadMode threadMode,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                    <span class="keyword">int</span> priority, <span class="keyword">boolean</span> sticky)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          Method method = subscriberClass.getDeclaredMethod(methodName, eventType);</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> SubscriberMethod(method, eventType, threadMode, priority, sticky);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Could not find subscriber method in "</span> + subscriberClass +</span><br><span class="line">                  <span class="string">". Maybe a missing ProGuard rule?"</span>, e);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º <code>SubscriberMethod</code> ä¸­çš„ <code>Method</code> å¯¹è±¡ï¼Œå…¶å®æ˜¯è°ƒç”¨è®¢é˜…è€…çš„ class å¯¹è±¡å¹¶ä½¿ç”¨ <code>getDeclaredMethodï¼ˆï¼‰</code>æ–¹æ³•æ‰¾åˆ°çš„ã€‚</p>
<p>ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£ï¼Œç´¢å¼•ç±»ä¹‹æ‰€ä»¥ç›¸æ¯”ä¼ ç»Ÿçš„é€šè¿‡åå°„éå†å»è·å–è®¢é˜…æ–¹æ³•æ•ˆç‡è¦æ›´é«˜ã€‚æ˜¯å› ä¸ºåœ¨è‡ªåŠ¨ç”Ÿæˆçš„ç´¢å¼•ç±»ä¸­ï¼Œå·²ç»åŒ…å«äº†ç›¸å…³è®¢é˜…è€…ä¸­çš„è®¢é˜…æ–¹æ³•çš„åç§°åŠæ³¨è§£ä¿¡æ¯ï¼Œé‚£ä¹ˆå½“ EventBus æ³¨å†Œè®¢é˜…è€…æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡<code>æ–¹æ³•åç§°</code>æ‹¿åˆ° Method å¯¹è±¡ã€‚è¿™æ ·å°±å‡å°‘äº†é€šè¿‡éå†å¯»æ‰¾æ–¹æ³•çš„æ—¶é—´ã€‚</p>
<h3 id="ç´¢å¼•ç±»çš„ç”Ÿæˆ"><a href="#ç´¢å¼•ç±»çš„ç”Ÿæˆ" class="headerlink" title="ç´¢å¼•ç±»çš„ç”Ÿæˆ"></a>ç´¢å¼•ç±»çš„ç”Ÿæˆ</h3><p>é‚£ç°åœ¨æˆ‘ä»¬ç»§ç»­å­¦ä¹  EventBus3 ä¸­æ˜¯å¦‚ä½•åˆ›å»ºç´¢å¼•ç±»çš„ã€‚ç´¢å¼•ç±»çš„åˆ›å»ºæ˜¯é€šè¿‡ <code>APT</code> æŠ€æœ¯ï¼Œå¦‚æœä½ ä¸äº†è§£è¿™é—¨æŠ€æœ¯ï¼Œä½ å¯èƒ½éœ€è¦æŸ¥çœ‹æ–‡ç«  <a href="/2019/02/23/Android-æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)/" title="Android æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)">Android æ³¨è§£ç³»åˆ—ä¹‹APTå·¥å…·(ä¸‰)</a></p>
<blockquote>
<p><code>APT(Annotation Processing Tool)</code>æ˜¯ javac ä¸­æä¾›çš„ä¸€ç§ç¼–è¯‘æ—¶æ‰«æå’Œå¤„ç†æ³¨è§£çš„å·¥å…·ï¼Œå®ƒä¼šå¯¹æºä»£ç æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶æ‰¾å‡ºå…¶ä¸­çš„æ³¨è§£ï¼Œç„¶åæ ¹æ®ç”¨æˆ·è‡ªå®šä¹‰çš„æ³¨è§£å¤„ç†æ–¹æ³•è¿›è¡Œé¢å¤–çš„å¤„ç†ã€‚APTå·¥å…·ä¸ä»…èƒ½è§£ææ³¨è§£ï¼Œè¿˜èƒ½æ ¹æ®æ³¨è§£ç”Ÿæˆå…¶ä»–çš„æºæ–‡ä»¶ï¼Œæœ€ç»ˆå°†ç”Ÿæˆçš„æ–°çš„æºæ–‡ä»¶ä¸åŸæ¥çš„æºæ–‡ä»¶å…±åŒç¼–è¯‘ï¼ˆ<code>æ³¨æ„ï¼šAPTå¹¶ä¸èƒ½å¯¹æºæ–‡ä»¶è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œåªèƒ½ç”Ÿæˆæ–°çš„æ–‡ä»¶ï¼Œä¾‹å¦‚åœ¨å·²æœ‰çš„ç±»ä¸­æ·»åŠ æ–¹æ³•</code>ï¼‰</p>
</blockquote>
<p>ä½¿ç”¨APTæŠ€æœ¯éœ€è¦åˆ›å»ºè‡ªå·±çš„æ³¨è§£å¤„ç†å™¨ï¼Œåœ¨ EventBus ä¸­ä¹Ÿåˆ›å»ºäº†è‡ªå·±çš„æ³¨è§£å¤„ç†å™¨ï¼Œä»å…¶æºä»£ç ä¸­æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºã€‚</p>
<img src="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3â€œåŠ é€Ÿå¼•æ“â€ï¼ˆäº”ï¼‰/EventBusæ³¨è§£å¤„ç†å™¨.png" title="EventBusæ³¨è§£å¤„ç†å™¨">
<p>é‚£ä¸‹é¢ï¼Œæˆ‘ä»¬å°±ç›´æ¥æŸ¥çœ‹æºç ï¼š</p>
<blockquote>
<p>ä»¥ä¸‹çš„ä»£ç ï¼Œéƒ½å‡ºè‡³äº <a href="https://github.com/greenrobot/EventBus/blob/master/EventBusAnnotationProcessor/src/org/greenrobot/eventbus/annotationprocessor/EventBusAnnotationProcessor.java" target="_blank" rel="noopener">EventBusAnnotationProcessor</a></p>
</blockquote>
<p>æŸ¥çœ‹ EventBusAnnotationProcessor ä¸­çš„ <code>process()</code> æ–¹æ³•ï¼š</p>
<blockquote>
<p><code>process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</code>ï¼šæ³¨è§£å¤„ç†å™¨å®é™…å¤„ç†æ–¹æ³•ï¼Œä¸€èˆ¬è¦æ±‚å­ç±»å®ç°è¯¥æŠ½è±¡æ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨åœ¨è¿™é‡Œå†™ä½ çš„æ‰«æä¸å¤„ç†æ³¨è§£çš„ä»£ç ï¼Œä»¥åŠç”Ÿæˆ Java æ–‡ä»¶ã€‚å…¶ä¸­å‚æ•° RoundEnvironment ï¼Œå¯ä»¥è®©ä½ æŸ¥è¯¢å‡ºåŒ…å«ç‰¹å®šæ³¨è§£çš„è¢«æ³¨è§£å…ƒç´ .</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SupportedAnnotationTypes</span>(<span class="string">"org.greenrobot.eventbus.Subscribe"</span>)</span><br><span class="line"><span class="meta">@SupportedOptions</span>(value = &#123;<span class="string">"eventBusIndex"</span>, <span class="string">"verbose"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventBusAnnotationProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String OPTION_EVENT_BUS_INDEX = <span class="string">"eventBusIndex"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment env)</span> </span>&#123;</span><br><span class="line">        Messager messager = processingEnv.getMessager();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//æ­¥éª¤1ï¼šğŸ‘‡è·å–æˆ‘ä»¬é…ç½®çš„ç´¢å¼•ç±»ï¼Œ</span></span><br><span class="line">            String index = processingEnv.getOptions().get(OPTION_EVENT_BUS_INDEX);</span><br><span class="line">            <span class="keyword">if</span> (index == <span class="keyword">null</span>) &#123;</span><br><span class="line">                messager.printMessage(Diagnostic.Kind.ERROR, <span class="string">"No option "</span> + OPTION_EVENT_BUS_INDEX +</span><br><span class="line">                        <span class="string">" passed to annotation processor"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ­¥éª¤2:ğŸ‘‡æ”¶é›†å½“å‰è®¢é˜…è€…ä¿¡æ¯</span></span><br><span class="line">            collectSubscribers(annotations, env, messager);</span><br><span class="line">            <span class="comment">//æ­¥éª¤3ï¼šğŸ‘‡åˆ›å»ºç´¢å¼•ç±»æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> (!methodsByClass.isEmpty()) &#123;</span><br><span class="line">                createInfoIndexFile(index);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                messager.printMessage(Diagnostic.Kind.WARNING, <span class="string">"No @Subscribe annotations found"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            writerRoundDone = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            <span class="comment">//çœç•¥éƒ¨åˆ†ä»£ç </span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•ä¸­ä¸»è¦é€»è¾‘ä¸ºä¸‰ä¸ªé€»è¾‘ï¼š</p>
<ul>
<li>æ­¥éª¤1ï¼šè¯»å–æˆ‘ä»¬ä¹‹å‰åœ¨ APP ä¸­çš„ build.gradle è®¾ç½®çš„ç´¢å¼•ç±»å¯¹åº”çš„åŒ…åä¸ç±»åã€‚</li>
<li>æ­¥éª¤2ï¼šè¯»å–æºæ–‡ä»¶ä¸­çš„åŒ…å« <code>@Subscribe</code> æ³¨è§£çš„æ–¹æ³•ã€‚å¹¶å°†è®¢é˜…è€…ä¸è®¢é˜…æ–¹æ³•è¿›è¡Œè®°å½•åœ¨ <code>methodsByClass</code> Map é›†åˆä¸­ã€‚</li>
<li>æ­¥éª¤3ï¼šæ ¹æ®è¯»å–çš„ç´¢å¼•ç±»è®¾ç½®ï¼Œé€šè¿‡ <code>createInfoIndexFile()</code> æ–¹æ³•å¼€å§‹åˆ›å»ºç´¢å¼•ç±»æ–‡ä»¶ã€‚</li>
</ul>
<blockquote>
<p>å› ä¸ºå£°æ˜äº†<code>@SupportedAnnotationTypes(&quot;org.greenrobot.eventbus.Subscribe&quot;)</code>  åœ¨æ³¨è§£å¤„ç†å™¨ä¸Šï¼Œé‚£ä¹ˆ APT åªä¼šå¤„ç†åŒ…å«è¯¥æ³¨è§£çš„æ–‡ä»¶ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹æ­¥éª¤2ä¸­çš„æ–¹æ³• <code>collectSubscribers()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">collectSubscribers</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment env, Messager messager)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (TypeElement annotation : annotations) &#123;</span><br><span class="line">        Set&lt;? extends Element&gt; elements = env.getElementsAnnotatedWith(annotation);</span><br><span class="line">        <span class="keyword">for</span> (Element element : elements) &#123;</span><br><span class="line">            <span class="keyword">if</span> (element <span class="keyword">instanceof</span> ExecutableElement) &#123;</span><br><span class="line">                ExecutableElement method = (ExecutableElement) element;</span><br><span class="line">                <span class="keyword">if</span> (checkHasNoErrors(method, messager)) &#123;</span><br><span class="line">                    <span class="comment">//è·å–åŒ…å«`@Subscribe`ç±»çš„classå¯¹è±¡</span></span><br><span class="line">                    TypeElement classElement = (TypeElement) method.getEnclosingElement();</span><br><span class="line">                    methodsByClass.putElement(classElement, method);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                messager.printMessage(Diagnostic.Kind.ERROR, <span class="string">"@Subscribe is only valid for methods"</span>, element);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨æ³¨è§£å¤„ç†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰«ææ‰€æœ‰çš„Javaæºæ–‡ä»¶ï¼Œæºä»£ç çš„æ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ªç‰¹å®šç±»å‹çš„<code>Element</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ Element ä»£è¡¨æºæ–‡ä»¶ä¸­çš„å…ƒç´ ï¼Œä¾‹å¦‚åŒ…ã€ç±»ã€å­—æ®µã€æ–¹æ³•ç­‰ã€‚</p>
</blockquote>
<p>åœ¨ä¸Šè¿°æ–¹æ³•ä¸­ï¼Œ<code>annotations</code> ä¸ºæ‰«æåˆ°åŒ…å« <code>@Subscribe</code> æ³¨è§£ çš„ <code>Element</code> é›†åˆã€‚å…¶ä¸­ ExecutableElement è¡¨ç¤ºç±»æˆ–æ¥å£çš„æ–¹æ³•ã€æ„é€ å‡½æ•°æˆ–åˆå§‹åŒ–å™¨ï¼ˆé™æ€æˆ–å®ä¾‹ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡ getEnclosingElementï¼ˆï¼‰æ–¹æ³•ï¼Œæ‹¿åˆ°å½“å‰ <code>ExecutableElement</code> çš„æœ€è¿‘çš„çˆ¶ Elementï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½è·å¾—å½“å‰çš„ç±»çš„ element å¯¹è±¡äº†ã€‚é‚£ä¹ˆé€šè¿‡è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬å°±èƒ½çŸ¥é“æ‰€æœ‰è®¢é˜…è€…ä¸å…¶å¯¹åº”çš„è®¢é˜…æ–¹æ³•äº†ã€‚</p>
<p>æˆ‘ä»¬ç»§ç»­è·Ÿè¸ªæŸ¥çœ‹ç´¢å¼•ç±»æ–‡ä»¶çš„åˆ›å»ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createInfoIndexFile</span><span class="params">(String index)</span> </span>&#123;</span><br><span class="line">    BufferedWriter writer = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        JavaFileObject sourceFile = processingEnv.getFiler().createSourceFile(index);</span><br><span class="line">        <span class="keyword">int</span> period = index.lastIndexOf(<span class="string">'.'</span>);</span><br><span class="line">        String myPackage = period &gt; <span class="number">0</span> ? index.substring(<span class="number">0</span>, period) : <span class="keyword">null</span>;</span><br><span class="line">        String clazz = index.substring(period + <span class="number">1</span>);</span><br><span class="line">        writer = <span class="keyword">new</span> BufferedWriter(sourceFile.openWriter());</span><br><span class="line">        <span class="keyword">if</span> (myPackage != <span class="keyword">null</span>) &#123;</span><br><span class="line">            writer.write(<span class="string">"package "</span> + myPackage + <span class="string">";\n\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        writer.write(<span class="string">"import org.greenrobot.eventbus.meta.SimpleSubscriberInfo;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"import org.greenrobot.eventbus.meta.SubscriberMethodInfo;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"import org.greenrobot.eventbus.meta.SubscriberInfo;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"import org.greenrobot.eventbus.meta.SubscriberInfoIndex;\n\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"import org.greenrobot.eventbus.ThreadMode;\n\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"import java.util.HashMap;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"import java.util.Map;\n\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"/** This class is generated by EventBus, do not edit. */\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"public class "</span> + clazz + <span class="string">" implements SubscriberInfoIndex &#123;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"    private static final Map&lt;Class&lt;?&gt;, SubscriberInfo&gt; SUBSCRIBER_INDEX;\n\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"    static &#123;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"        SUBSCRIBER_INDEX = new HashMap&lt;Class&lt;?&gt;, SubscriberInfo&gt;();\n\n"</span>);</span><br><span class="line">        <span class="comment">//ğŸ‘‡è¿™é‡Œæ˜¯å…³é”®çš„ä»£ç </span></span><br><span class="line">        writeIndexLines(writer, myPackage);</span><br><span class="line">        writer.write(<span class="string">"    &#125;\n\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"    private static void putIndex(SubscriberInfo info) &#123;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"        SUBSCRIBER_INDEX.put(info.getSubscriberClass(), info);\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"    &#125;\n\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"    @Override\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"    public SubscriberInfo getSubscriberInfo(Class&lt;?&gt; subscriberClass) &#123;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"        SubscriberInfo info = SUBSCRIBER_INDEX.get(subscriberClass);\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"        if (info != null) &#123;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"            return info;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"        &#125; else &#123;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"            return null;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"        &#125;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"    &#125;\n"</span>);</span><br><span class="line">        writer.write(<span class="string">"&#125;\n"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Could not write source for "</span> + index, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (writer != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                writer.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="comment">//Silent</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé€šè¿‡ <code>processingEnv.getFiler().createSourceFile(index)</code> æ‹¿åˆ°æˆ‘ä»¬éœ€è¦åˆ›å»ºçš„ç´¢å¼•ç±»æ–‡ä»¶å¯¹è±¡ï¼Œç„¶åé€šè¿‡æ–‡ä»¶IOæµå‘è¯¥æ–‡ä»¶ä¸­è¾“å…¥ç´¢å¼•ç±»ä¸­éœ€è¦çš„å†…å®¹ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæœ€ä¸ºä¸»è¦çš„å°±æ˜¯ <code>writeIndexLines()</code> æ–¹æ³•äº†ã€‚æŸ¥çœ‹è¯¥æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeIndexLines</span><span class="params">(BufferedWriter writer, String myPackage)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (TypeElement subscriberTypeElement : methodsByClass.keySet()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (classesToSkip.contains(subscriberTypeElement)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å½“å‰è®¢é˜…å¯¹è±¡çš„classå¯¹è±¡</span></span><br><span class="line">        String subscriberClass = getClassString(subscriberTypeElement, myPackage);</span><br><span class="line">        <span class="keyword">if</span> (isVisible(myPackage, subscriberTypeElement)) &#123;</span><br><span class="line">            writeLine(writer, <span class="number">2</span>,</span><br><span class="line">                    <span class="string">"putIndex(new SimpleSubscriberInfo("</span> + subscriberClass + <span class="string">".class,"</span>,</span><br><span class="line">                    <span class="string">"true,"</span>, <span class="string">"new SubscriberMethodInfo[] &#123;"</span>);</span><br><span class="line">            List&lt;ExecutableElement&gt; methods = methodsByClass.get(subscriberTypeElement);</span><br><span class="line">            <span class="comment">//ğŸ‘‡å…³é”®ä»£ç </span></span><br><span class="line">            writeCreateSubscriberMethods(writer, methods, <span class="string">"new SubscriberMethodInfo"</span>, myPackage);</span><br><span class="line">            writer.write(<span class="string">"        &#125;));\n\n"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            writer.write(<span class="string">"        // Subscriber not visible to index: "</span> + subscriberClass + <span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¼šä» <code>methodsByClass</code> Map ä¸­éå†è·å–æˆ‘ä»¬ä¹‹å‰çš„è®¢é˜…è€…ï¼Œç„¶åè·å–å…¶æ‰€æœ‰çš„è®¢é˜…æ–¹æ³•ï¼Œå¹¶ä¹¦å†™æ¨¡æ¿æ–¹æ³•ã€‚å…¶ä¸­å…³æ„é€  <code>SubscriberMethodInfo</code> ä»£ç çš„å…³é”®æ–¹æ³•ä¸º <code>writeCreateSubscriberMethods()</code>ï¼Œè·Ÿè¸ªè¯¥æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeCreateSubscriberMethods</span><span class="params">(BufferedWriter writer, List&lt;ExecutableElement&gt; methods,</span></span></span><br><span class="line"><span class="function"><span class="params">                                             String callPrefix, String myPackage)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       <span class="keyword">for</span> (ExecutableElement method : methods) &#123;</span><br><span class="line">           <span class="comment">//è·å–å½“å‰æ–¹æ³•ä¸Šçš„å‚æ•°</span></span><br><span class="line">           List&lt;? extends VariableElement&gt; parameters = method.getParameters();</span><br><span class="line">           TypeMirror paramType = getParamTypeMirror(parameters.get(<span class="number">0</span>), <span class="keyword">null</span>);</span><br><span class="line">           <span class="comment">//è·å–ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹</span></span><br><span class="line">           TypeElement paramElement = (TypeElement) processingEnv.getTypeUtils().asElement(paramType);</span><br><span class="line">           <span class="comment">//è·å–æ–¹æ³•çš„åç§°</span></span><br><span class="line">           String methodName = method.getSimpleName().toString();</span><br><span class="line">           <span class="comment">//è·å–è®¢é˜…çš„äº‹ä»¶classç±»å‹å­—ç¬¦ä¸²ä¿¡æ¯</span></span><br><span class="line">           String eventClass = getClassString(paramElement, myPackage) + <span class="string">".class"</span>;</span><br><span class="line">           <span class="comment">//è·å–æ–¹æ³•ä¸Šçš„æ³¨è§£ä¿¡æ¯</span></span><br><span class="line">           Subscribe subscribe = method.getAnnotation(Subscribe.class);</span><br><span class="line">           List&lt;String&gt; parts = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">           parts.add(callPrefix + <span class="string">"(\""</span> + methodName + <span class="string">"\","</span>);</span><br><span class="line">           String lineEnd = <span class="string">"),"</span>;</span><br><span class="line">           <span class="comment">//è®¾ç½®ä¼˜å…ˆçº§ï¼Œæ˜¯å¦ç²˜æ€§ï¼Œçº¿ç¨‹æ¨¡å¼ï¼Œè®¢é˜…äº‹ä»¶classç±»å‹</span></span><br><span class="line">           <span class="keyword">if</span> (subscribe.priority() == <span class="number">0</span> &amp;&amp; !subscribe.sticky()) &#123;</span><br><span class="line">               <span class="keyword">if</span> (subscribe.threadMode() == ThreadMode.POSTING) &#123;</span><br><span class="line">                   parts.add(eventClass + lineEnd);</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   parts.add(eventClass + <span class="string">","</span>);</span><br><span class="line">                   parts.add(<span class="string">"ThreadMode."</span> + subscribe.threadMode().name() + lineEnd);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               parts.add(eventClass + <span class="string">","</span>);</span><br><span class="line">               parts.add(<span class="string">"ThreadMode."</span> + subscribe.threadMode().name() + <span class="string">","</span>);</span><br><span class="line">               parts.add(subscribe.priority() + <span class="string">","</span>);</span><br><span class="line">               parts.add(subscribe.sticky() + lineEnd);</span><br><span class="line">           &#125;</span><br><span class="line">           writeLine(writer, <span class="number">3</span>, parts.toArray(<span class="keyword">new</span> String[parts.size()]));</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (verbose) &#123;</span><br><span class="line">               processingEnv.getMessager().printMessage(Diagnostic.Kind.NOTE, <span class="string">"Indexed @Subscribe at "</span> +</span><br><span class="line">                       method.getEnclosingElement().getSimpleName() + <span class="string">"."</span> + methodName +</span><br><span class="line">                       <span class="string">"("</span> + paramElement.getSimpleName() + <span class="string">")"</span>);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¼šè·å–è®¢é˜…æ–¹æ³•çš„å‚æ•°ä¿¡æ¯ï¼Œå¹¶æ„å»º <code>SubscriberMethodInfo</code> ä¿¡æ¯ã€‚è¿™é‡Œå°±ä¸å¯¹è¯¥æ–¹æ³•è¿›è¡Œè¯¦ç»†çš„ä»‹ç»äº†ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®ä»£ç ä¸­çš„æ³¨é‡Šè¿›è¡Œç†è§£ã€‚</p>
<h3 id="æ··æ·†ç›¸å…³"><a href="#æ··æ·†ç›¸å…³" class="headerlink" title="æ··æ·†ç›¸å…³"></a>æ··æ·†ç›¸å…³</h3><p>åœ¨ä½¿ç”¨ EventBus3 çš„æ—¶å€™ï¼Œå¦‚æœä½ çš„é¡¹ç›®é‡‡ç”¨äº†æ··æ·†ï¼Œéœ€è¦æ³¨æ„ keep ä»¥ä¸‹ç±»åŠæ–¹æ³•ã€‚å®˜æ–¹ä¸­å·²ç»ç»™å‡ºäº†è¯¦ç»†çš„ keep è§„åˆ™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-keepattributes *Annotation*</span><br><span class="line">-keepclassmembers <span class="class"><span class="keyword">class</span> * </span>&#123;</span><br><span class="line">    <span class="meta">@org</span>.greenrobot.eventbus.Subscribe &lt;methods&gt;;</span><br><span class="line">&#125;</span><br><span class="line">-keep <span class="keyword">enum</span> org.greenrobot.eventbus.ThreadMode &#123; *; &#125;</span><br><span class="line"></span><br><span class="line"># Only required if you use AsyncExecutor</span><br><span class="line">-keepclassmembers <span class="class"><span class="keyword">class</span> * <span class="keyword">extends</span> <span class="title">org</span>.<span class="title">greenrobot</span>.<span class="title">eventbus</span>.<span class="title">util</span>.<span class="title">ThrowableFailureEvent</span> </span>&#123;</span><br><span class="line">    &lt;init&gt;(java.lang.Throwable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æ³¨è§£"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æ³¨è§£" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æ³¨è§£"></a>ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æ³¨è§£</h4><p>androidåœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œåº”ç”¨ç¨‹åºä¼šè¿›è¡Œä»£ç ä¼˜åŒ–ï¼Œä¼˜åŒ–çš„è¿‡ç¨‹å°±æŠŠæ³¨è§£ç»™å»æ‰äº†ã€‚ä¸ºäº†åœ¨ç¨‹åºè¿è¡ŒæœŸé—´è¯»å–åˆ°æ³¨è§£ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿å­˜æ³¨è§£ä¿¡æ¯ä¸è¢«æ··æ·†ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†åŒ…å«-Subscribe-æ³¨è§£çš„æ–¹æ³•"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†åŒ…å«-Subscribe-æ³¨è§£çš„æ–¹æ³•" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†åŒ…å« @Subscribe æ³¨è§£çš„æ–¹æ³•"></a>ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†åŒ…å« @Subscribe æ³¨è§£çš„æ–¹æ³•</h4><p>å› ä¸ºå½“æˆ‘ä»¬åœ¨ä½¿ç”¨ç´¢å¼•ç±»æ—¶ï¼Œè·å–ç›¸å…³è®¢é˜…çš„æ–¹æ³•æ˜¯é€šè¿‡<code>æ–¹æ³•åç§°</code>è·å–çš„ï¼Œé‚£ä¹ˆå½“ä»£ç è¢«æ··æ·†è¿‡åï¼Œè®¢é˜…è€…çš„æ–¹æ³•åç§°å°†ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæ¯”å¦‚åŸæ¥è®¢é˜…æ–¹æ³•åç§°ä¸ºonMessageEventï¼Œæ··æ·†åæœ‰å¯èƒ½æ”¹ä¸ºaï¼Œæˆ–bæ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™æ˜¯æ‰¾ä¸åˆ°ç›¸å…³çš„è®¢é˜…è€…çš„æ–¹æ³•çš„ ï¼Œå°±ä¼šæŠ›å‡º <code>Could not find subscriber method in  + subscriberClass + Maybe a missing ProGuard rule?</code> çš„å¼‚å¸¸ï¼Œæ‰€ä»¥åœ¨æ··æ·†çš„æ—¶å€™æˆ‘ä»¬éœ€è¦ä¿ç•™è®¢é˜…è€…æ‰€æœ‰åŒ…å« <code>@Subscribe</code> æ³¨è§£çš„æ–¹æ³•ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æšä¸¾ç±»ä¸­çš„é™æ€å˜é‡"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æšä¸¾ç±»ä¸­çš„é™æ€å˜é‡" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æšä¸¾ç±»ä¸­çš„é™æ€å˜é‡"></a>ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æšä¸¾ç±»ä¸­çš„é™æ€å˜é‡</h4><p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨æ··æ·†è§„åˆ™ä¸­æ·»åŠ å¦‚ä¸‹è¯­å¥:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-keep <span class="keyword">public</span> <span class="keyword">enum</span> org.greenrobot.eventbus.ThreadMode &#123; <span class="keyword">public</span> <span class="keyword">static</span> *; &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿è¡Œç¨‹åºçš„æ—¶å€™ï¼Œä¼šæŠ¥<code>java.lang.NoSuchFieldError: No static field POSTING</code>ã€‚åŸå› æ˜¯å› ä¸ºåœ¨ <code>SubscriberMethodFinder</code> çš„ <code>findUsingReflection</code> æ–¹æ³•ä¸­ï¼Œåœ¨è°ƒç”¨ <code>Method.getAnnotation()</code>æ—¶è·å– <code>ThreadMode</code> è¿™ä¸ª <code>enum</code> å¤±è´¥äº†ã€‚</p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“å½“æˆ‘ä»¬å£°æ˜æšä¸¾ç±»æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬çš„æšä¸¾ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç»§æ‰¿<br><code>java.lang.Enum</code> çš„ <code>final</code> ç±»ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨å‘½ä»¤ javap ThreadMode.class</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">tian</span>.<span class="title">auto</span>.<span class="title">ThreadMode</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Enum</span>&lt;<span class="title">com</span>.<span class="title">tian</span>.<span class="title">auto</span>.<span class="title">ThreadMode</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> com.tian.auto.ThreadMode POSTING;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> com.tian.auto.ThreadMode MAIN;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> com.tian.auto.ThreadMode MAIN_ORDERED;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> com.tian.auto.ThreadMode BACKGROUND;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> com.tian.auto.ThreadMode ASYNC;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> com.tian.auto.ThreadMode[] values();</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> com.tian.auto.<span class="function">ThreadMode <span class="title">valueOf</span><span class="params">(java.lang.String)</span></span>;</span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨æšä¸¾ä¸­å£°æ˜çš„å…ƒç´ ï¼Œå…¶å®æœ€åå¯¹åº”çš„æ˜¯ç±»ä¸­çš„é™æ€å…¬æœ‰çš„å¸¸é‡ã€‚</p>
<p>é‚£ä¹ˆåœ¨ç»“åˆåœ¨æ²¡æœ‰æ·»åŠ æ··æ·†è§„åˆ™æ—¶ï¼Œç¨‹åºæ‰€æç¤ºçš„é”™è¯¯ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥ç¡®å®šå½“æˆ‘ä»¬åœ¨æ³¨è§£ä¸­åŒ…å«<code>æšä¸¾ç±»å‹</code>çš„æ³¨è§£å…ƒç´ æ—¶ä¸”è®¾ç½®äº†é»˜è®¤å€¼æ—¶ã€‚è¯¥é»˜è®¤å€¼æ˜¯é€šè¿‡æšä¸¾ç±»çš„ class å¯¹è±¡.getField(String name) å»è·å–çš„ã€‚å› ä¸ºåªæœ‰è¯¥æ–¹æ³•æ‰ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚<code>getField()</code> ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Field <span class="title">getField</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> NoSuchFieldException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"name == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Field result = getPublicFieldRecursive(name);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchFieldException(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆä¹Ÿå°±è¯´å¦‚æœä¸æ·»åŠ ä¸Šè¿°çš„ keep è§„åˆ™ï¼Œå°±ä¼šå¯¼è‡´æˆ‘ä»¬ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„é™æ€å¸¸é‡åå‘ç”Ÿå˜åŒ–ï¼Œåˆå› ä¸ºæ³¨è§£ä¸­çš„é»˜è®¤æšä¸¾å€¼ï¼Œæ˜¯é€šè¿‡ <code>getField(String name)</code> è·å¾—çš„ã€‚æ‰€ä»¥å°±ä¼šå‡ºç°æ‰¾ä¸åˆ°å­—æ®µçš„æƒ…å†µã€‚</p>
<blockquote>
<p>å…¶å®åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ  keep è§„åˆ™ï¼Œå¸¸å¸¸æ˜¯å› ä¸ºä»£ç ä¸­æ˜¯ç›´æ¥æ‹¿<strong>æ··æ·†å‰</strong>çš„æ–¹æ³•åç§°æˆ–å­—æ®µåç§°å»ç›´æ¥å¯»æ‰¾<strong>æ··æ·†å</strong>çš„æ–¹æ³•ä¸å­—æ®µåç§°ï¼Œæˆ‘ä»¬åªè¦åœ¨é¡¹ç›®ä¸­æ³¨æ„è¿™äº›æƒ…å†µï¼Œæ·»åŠ ç›¸åº”çš„ keep è§„åˆ™ï¼Œå°±å¯ä»¥é¿å…å› ä¸ºä»£ç è¢«æ··æ·†è€Œäº§ç”Ÿçš„å¼‚å¸¸å•¦ã€‚</p>
</blockquote>
<h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>EventBus3 ä¸­çš„ç´¢å¼•ç±»åŠå…¶ç›¸å…³å†…å®¹åˆ°è¿™é‡Œå°±è®²å®Œå•¦ï¼æˆ‘ç›¸åº”å¤§å®¶å·²ç»äº†è§£äº†ç´¢å¼•ç±»åœ¨æ€§èƒ½ä¼˜åŒ–ä¸Šçš„é‡è¦ä½œç”¨ã€‚å¸Œæœ›å¤§å®¶åœ¨åç»­ä½¿ç”¨EventBus3æ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨ç´¢å¼•ç±»å‘¦ã€‚åœ¨æ¥ä¸‹æ¥çš„ä¸€æ®µæ—¶é—´å†…ï¼Œæˆ‘å¯èƒ½ä¸ä¼šç»§ç»­æ›´æ–°åšå®¢å•¦ï¼Œå› ä¸ºä½œè€…æˆ‘è¦å»å­¦ä¹  flutter å»å•¦~ æ²¡æœ‰åŠæ³•ï¼Œæ€»è¦ä¿æŒå‰è¿›å‘¢ã€‚ä¼˜ç§€çš„äººè¿˜åœ¨åŠªåŠ›ï¼Œæ›´ä½•å†µè‡ªå·±å¹¶ä¸èªæ˜å‘¢ã€‚å“~ä¼¤å¿ƒ</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/EventBus/" rel="tag"># EventBus</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/10/13/Gitæ–°æ‰‹æ•™ç¨‹-æ·»åŠ å¿½ç•¥æ–‡ä»¶ï¼ˆåï¼‰/" rel="next" title="Gitæ–°æ‰‹æ•™ç¨‹-æ·»åŠ å¿½ç•¥æ–‡ä»¶ï¼ˆåï¼‰">
                <i class="fa fa-chevron-left"></i> Gitæ–°æ‰‹æ•™ç¨‹-æ·»åŠ å¿½ç•¥æ–‡ä»¶ï¼ˆåï¼‰
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/" rel="prev" title="Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰">
                Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://upload-images.jianshu.io/upload_images/2824145-e320240ea6ec767d.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AndyJennifer">
            
              <p class="site-author-name" itemprop="name">AndyJennifer</p>
              <p class="site-description motion-element" itemprop="description">AndyJennifer ä¸ªäººç«™ï¼Œä¸»è¦æ¶‰åŠAndroidã€Javaã€Kotlinç­‰ç›¸å…³çŸ¥è¯†ï¼Œæ„¿ä¸å¤§å®¶å…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">61</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/AndyJennifer" title="GitHub &rarr; https://github.com/AndyJennifer" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="/andyjennifer@126.com" title="E-Mail &rarr; andyjennifer@126.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#å‰è¨€"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‰æ™¯å›é¡¾"><span class="nav-number">2.</span> <span class="nav-text">å‰æ™¯å›é¡¾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å…³é”®ä»£ç "><span class="nav-number">3.</span> <span class="nav-text">å…³é”®ä»£ç </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#findUsingInfo-æ–¹æ³•"><span class="nav-number">3.1.</span> <span class="nav-text">findUsingInfo æ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getSubscriberInfo-æ–¹æ³•"><span class="nav-number">3.2.</span> <span class="nav-text">getSubscriberInfo æ–¹æ³•</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EventBusä¸­ç´¢å¼•ç±»çš„ä½¿ç”¨"><span class="nav-number">4.</span> <span class="nav-text">EventBusä¸­ç´¢å¼•ç±»çš„ä½¿ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç´¢å¼•ç±»å®é™…ä½¿ç”¨åˆ†æ"><span class="nav-number">4.1.</span> <span class="nav-text">ç´¢å¼•ç±»å®é™…ä½¿ç”¨åˆ†æ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç´¢å¼•ç±»çš„ç”Ÿæˆ"><span class="nav-number">5.</span> <span class="nav-text">ç´¢å¼•ç±»çš„ç”Ÿæˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ··æ·†ç›¸å…³"><span class="nav-number">6.</span> <span class="nav-text">æ··æ·†ç›¸å…³</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æ³¨è§£"><span class="nav-number">6.1.</span> <span class="nav-text">ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æ³¨è§£</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†åŒ…å«-Subscribe-æ³¨è§£çš„æ–¹æ³•"><span class="nav-number">6.2.</span> <span class="nav-text">ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†åŒ…å« @Subscribe æ³¨è§£çš„æ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æšä¸¾ç±»ä¸­çš„é™æ€å˜é‡"><span class="nav-number">6.3.</span> <span class="nav-text">ä¸ºä»€ä¹ˆä¸èƒ½æ··æ·†æšä¸¾ç±»ä¸­çš„é™æ€å˜é‡</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æœ€å"><span class="nav-number">7.</span> <span class="nav-text">æœ€å</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AndyJennifer</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="ç«™ç‚¹æ€»å­—æ•°">614k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">18:36</span>
  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="æ€»è®¿å®¢é‡">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="æ€»è®¿é—®é‡">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>


  
  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
