---
title: Jvm系列之Java对象的创建、存储及访问
tags:
- Jvm
categories:
- Jvm
---


### Jvm系列之判断对象是否存活（二)

### 判断Java对象是否已经死亡
- 引用计数法
- 可达性分析算法


#### 引用计数法
- 原理：给对象添加一个引用计数器，每当有一个地方引用它是，计数器就加1，当引用失效时，计数器就减1
- 优点：实现简单，判定效率也高
- 缺点：不能解决循环引用的问题

#### 可达性分析算法
- 原理：通过一系列的的称为"GC Roots"的对象作为起始点，从这些节点开始向下搜索，搜索所走过的路径称为引用链，当一个对象到GC Roots没有任何引用链相连，则证明此对象是不可用的

>在Java语言中，可作为GC Roots的对象包括下面几种。
> - 虚拟机栈（栈帧中的本地变量表）中引用的对象。
> - 方法区中静态属性引用的对象。
> - 方法区中常量引用的对象。
> - 本地方法栈中JNI引用的对象。


### 引用类型
- 强引用
- 软引用
- 弱引用
- 虚引用

### 真正判断对象是否死亡
需要经过两次标记过程：
- 第一次：通过可达性分析算法中得到不可达的对象后，会进行第一次标记并筛选（筛选条件，此对象是否有必要执行finalize()方法，（是否有必要指，对象是否覆盖finalize()方法，或者finalize（）方法已经被虚拟机调用）
- 第二次：该对象会被放到一个 F-Queue 队列中，并由 虚拟机自动建立、优先级低的Finalizer 线程去执行 队列中该对象的finalize()在执行finalize()过程中，若对象依然没与引用链上的GC Roots 直接关联 或 间接关联（即关联上与GC Roots 关联的对象），那么该对象将被判断死亡，不筛选（留在”即将回收“集合里） 并 等待回收


### 回收方法区
- 回收内容：回收运行时常量池中无用的数据，回收无用的类

#### 无用的类的判断
- 该类所有的实例都已经被回收，也就是Java堆中不存在该类的任何实例。
- 加载该类的Classloader已经被回收
- 该类对应的java.lang.Class对象没有被任何地方引用，无法在任何地方通过反射访问该类的方法。

