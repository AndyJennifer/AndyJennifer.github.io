---
title: 'Java并发编程之线程篇之线程简介(一)'
tags:
- 线程
categories:
- 线程篇
---

### 前言
在Java并发编程中线程的使用尤为重要。了解线程的由来，使用场景及注意事项是作为一个合格的Java程序员必备的技能。本文章中会对线程的由来、进程与线程的区别、及线程的使用场景进行简单介绍。希望通过该文章，小伙伴们能对线程有一个更深的了解。

### 从操作系统发展了解线程
线程的出现，离不开进程。而进程的出现又离不开操作系统。操作系统的发展促进了线程与进程的技术崛起。所以了解操作系统的发展，对我们理解线程尤为重要。
整个操作系统大致分为如下几个阶段：
- 手工操作
- 单批处理系统
- 多批处理系统
- 分时系统

#### 手工操作
最早的计算机并位出现真正意义上的操作系统，这时的计算机智能解决简单的数学问题，比如正铉，余铉等。其运行方式也特别简单。程序员将对应于程序和数据的已穿孔的纸带（或卡片）装入输入机，然后启动输入机把程序和数据输入计算机内存，接着通过控制台开关启动程序针对数据运行；计算完毕，打印机输出计算结果；用户取走结果并卸下纸带（或卡片）后，才让下一个用户上机。具体如下图所示：

手工操作方式两个特点：
- 用户独占全机，不会出现因资源已被其他用户占用而等待的现象，但资源的利用率低
- CPU等待手工操作，CPU的利用不充分。

手工操作的缺点：
- 手工操作数据输入与计算机处理数据速度极为不对称，手工操作方式严重损害了系统的利用率（在等待用户输入数据的时，CPU处于闲置）。

#### 单批处理系统
为了摆脱手动操作带来的耗时性，实现作业（程序、数据、指令）的自动过渡。接着又出现了单批处理系统。单批处理系统在原来手动操作主要的区别是在输入机与主机之间增加了一个存储设备`磁带`，并在主机系统上配上监督程序（在它的控制下使这批作业能一个接一个地连续处理）。如下图所示：

具体运行方式：通常是把一批作业（程序、数据、指令）以输入到磁带上，然后由监督程序将磁带上的第一个作业装入内存，并把运行控制权交给该作业。当该作业处理完成时，又把控制权交还给监督程序，再由监督程序把磁带（盘）上的第二个作业调入内存。计算机系统就这样自动地一个作业一个作业地进行处理，直至磁带上的所有作业全部完成。

单批处理操作系统虽然能够解决计算机的空闲问题，但是当某一个作业因为等待磁盘或者其他I/O操作而暂停，那CPU就只能阻塞直到该I/O完成，对于CPU操作密集型的程序，I/O操作相对较少，因此浪费的时间也很少。但是对于I/O操作较多的场景来说，CPU的资源是属于严重浪费的。

#### 多批处理系统
为了解决单批处理系统因为输入/输出（I/O）请求后，导致CPU等待低速的I/O完成而造成的CPU资源的浪费。接下来又出现了多批处理系统。多批处理系统与单批处理系统的主要区别是在`内存中允许一个或多个作业`，当一个作业在等待I/O处理时，多批处理系统会通过相应调度算法调度另外一个作业让CPU执行。从而使CPU的利用率得到更大的提高。如下图所示:


### 进程的由来
在多批处理系统中引申出了一个非常重要的概念，及允许多个作业进入内存并运行。由于在内存中存储了多个作业，那么多个作业如何进行区分？当某个作业因为等待I/O暂停时，怎么恢复到之前的运行状态呢？

这个时候，聪明的人们就发明了——`进程`，用进程来表示每个作业（程序、数据、指令），每个进程来对应一定的内存地址空间，并且只能使用它自己的内存空间，各个进程之间互不干扰。进程同时也保存了程序每个时刻的运行状态，为进程切换提供了可能。当进程暂停时，它会保存当前进程的状态（进程标识，进程使用的资源等），在下一次切换回来时根据之前保存的状态进行恢复，接着继续执行。

### 线程的由来
>并发：操作系统从宏观上看起来同一个时间段有多个任务在执行。
多批处理系统所引入的进程的概念，确实提高了计算机的运行效率，但是单单使用进程来处理程序的`并发`的弊端也越来与突出，因为一个进程在一个时间段内只能做一件事情。如果某个程序有多个任务，只能逐个执行这些任务。


所以，聪明的人儿们又进一步的发明了更轻量级进程——`线程`。将进程的资源分布和执行调度分开，各个线程既可以共享进程资源（内存地址，文件	I/O等）又可以独立的被操作系统调度。进程与线程的关系如下图所示：

![进程线程的关系.png](https://upload-images.jianshu.io/upload_images/2824145-c9331166fee59a5f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 线程的使用场景
线程的出现确实提高了程序运行的性能，同时也提高了CPU的利用率，那么线程的使用场景有哪些呢？

- 执行后台任务，在很多场景中，可能会有一些定时的批量任务，比如定时发送短信、定时生成批量文件。在这些场景中可以通过多线程的来执行。
- 异步处理，比如在用户注册成功以后给用户发送优惠券或者短信，可以通过异步的方式来执行，一方面提升主程序的执行性能；另一方面可以解耦核心功能，防止非核心功能对核心功能造成影响。
- 分布式处理，比如fork/join，将一个任务拆分成多个子任务分别执行。
- BIO模型中的线程任务分发，也是一种比较常见的使用场景，一个请求对应一个线程。

### 线程使用注意事项
虽然在程序中我们可以创建多个线程来提高程序的运行效率与吞吐率，但是也会出现以下问题：

- 由于多个线程共同占有所属进程的资源和地址空间，那么多个线程要同时访问某个资源，这个时候该怎么处理？
- 是否创建越多线程越好，线程之间的切换是否存在着消耗。

这些问题其实是关于线程同步与合理的创建线程数的问题。这里就不做过多的介绍，如果大家对这部分感兴趣，可以关注后续文章或查阅相关资料。

### 最后
站在巨人的肩膀上，才能看的更远~
- [线程的发展历史](https://segmentfault.com/a/1190000017252672)
- [Java并发编程：进程和线程之由来](https://www.cnblogs.com/dolphin0520/p/3910667.html)