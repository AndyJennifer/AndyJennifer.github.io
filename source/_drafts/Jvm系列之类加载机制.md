---
title: Jvm系列之类加载机制
tags:
- Jvm
categories:
- Jvm
---
### Jvm系列之类加载机制（五）


### 整体过程
验证-准备-解析，统称为连接。且加载，连接，初始化这三个过程是在程序运行期间的。所以Java是动态扩展的语言。

### 加载
作用：将外部的class文件加载到虚拟机，并在方法区中生成该类的信息数据。
具体步骤：
1. 通过一个类的全限定名来获取定义此类的二进制流
2. 将这个字节流所代表的静态存储结构转换为方法区的运行时数据结构
3. 在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问的入口



#### 数组类的加载
数组类不直接通过类加载器完成加载，它是由Java 虚拟机直接创建的。

##### 数组类中引用类型的加载方式
如果数组类中的组件类型是引用类型，还是通过上面的类的加载过程加载该组件类型，
##### 数组类中基本数据类型的加载方式
如果数组类中的组件类型是基本类型，Java虚拟机将会把数组，标记为与引导类加载器关联。

### 验证
作用：确保Class文件的字节流中包含的信息符合当前虚拟机的要求。并且不会危害虚拟机自身的安全
 验证步骤：
 1. 文件格式验证
 2. 元数据验证
 3. 字节码验证
 4. 符号引用验证
 
### 准备
作用：为类中的变量分配内存，变量类型（被static修饰的变量）
具体设置：将上述变量的初始值设置为0
注意：如果类变量为常量（被final 修饰）则直接赋值为开发者定义的值

### 解析
作用：主要是解析字段、接口、方法、将常量池的符号引用（在class文件加载到虚拟机时生成的符号引用）阶段直接转为直接引用。
解析过程：
1. 解析类/接口
2. 解析字段
3. 解析方法


### 初始化
作用：主要完成静态代码块，和所有类变量的赋值操作，这是类加载的最后阶段。
触发初始化的时机：
- 创建相应类的实例的时候
- 访问类的静态方法或者静态变量的时候
- Class.forName()反射类的时候
- 当初始化一个类的时候，如果发现其父类还没有进行初始化。则需要先触发父类的初始化
- 当虚拟机启动时，用户需要制定一个执行的主类，虚拟机会先初始化这个主类
- 使用jdk1.7的动态语言支持的实时。