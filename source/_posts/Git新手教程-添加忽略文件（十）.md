---
title: Git新手教程-添加忽略文件（十）
tags:
  - Git
categories:
  - Git相关
date: 2019-10-13 20:35:01
---


### 前言

通过前面的文章，我相信大家已经对 Git 有所掌握了，现在还剩下最后一个知识点，就是让 Git 添加忽略某些文件。在实际的项目开发中，我们可能不想将一些文件添加到 Git 仓库中。比如，一些敏感文件、临时文件、自动生成文件、日志文件等。那应该怎么操作呢？

### 实际例子

假设我们想创建一个项目并使用 Git 进行管理，现在我们有三个文件 `A.md`、`B.md`、`C.md`，现在我们不希望将 `C.md`文件添加到仓库中。但是 Git 会看到这些文件，所以在我们运行 `git status` 命令时，它仍然会显示在文件列表中：

> 下图中的项目 `GitTestProject` 项目，已经通过 `git init` 初始化过了。

{% asset_img 忽略文件1.png 忽略文件1 %}

那这个时候我们应该怎么办呢？如果我们想某个文件保留在项目中，又不想它受到 Git 的跟踪管理，那我们可以使用文件 `.gitignore` 文件，我们只需要创建该文件，然后并添加到我们项目的根目录中，最后把你想要忽略（让 Git 不进行跟踪）的文件名称填写到该文件中就可以了。如果我们要忽略 `C.md` 我们可以将这行添加到 `.gitignore` 文件中。

>在 Mac 系统中不能直接创建 `.gitignore` 文件，我们需要在当前项目的根目录打开控制台，并输入 `touch .gitignore` 来生成 `.gitignore` 文件。

```bash
C.md
```

这时我们再使用 `git status` 来查看我们的仓库的状态：

{% asset_img 忽略文件2.png 忽略文件2 %}

从上图中，我们可以发现 `C.md`文件已经不再受 Git 控制了。因为 Git 会查看 `.gitignore` 文件中的内容，并根据该文件中的内容，自动忽略你想忽略的文件。

那既然 `C.md`文件已经被忽略了，那么我们就可以直接使用 `git add .` 来添加当前目录的所有文件啦。

>还记得之前章节中我们学习的 `git add`命令吗？我们可以使用一个特殊的字符来表示当前目录和所有的子目录，而不是一个个的添加文件。还记得是什么字符吗？对就是 `.(点）`。

### 忽略文件通配符

虽然我们可以直接在 `.gitignore` 文件中直接书写我们要忽略的文件名称，但是我们也可以使用 `通配符` 来忽略一系列满足条件的文件或文件夹。

通配符允许你使用特殊的字符来表示某些格式/字符。在 `.gitignore` 文件中，我们可以使用：

- 空白行作为空格
- `#` ： 将行标记为注释
- `*` ： 与 0 个或多个字符匹配
- `?` ：与 1 个字符匹配
- `[abc]` ： - 与 a、b 或 c 匹配
- `**` ： 与嵌套目录匹配，比如 a/**/z 与以下项匹配
  - a/z
  - a/b/z
  - a/b/c/z

下面我们来看一些简单的例子来学习一下通配符的使用，比如我们需要忽略当前项目根目下的 `A` 文件夹中的所有的 80 张 `PNG` 格式的图片，我们可以在 `.gitignore` 文件中书写：

```bash
/A/*.png
```

> 注意：Git 默认会忽略文件名的大小写，我们可使用命令 `git config --get core.ignorecase` 来查看我们的设置，当然我们也可以通过命令 `git config core.ignorecase false` 将其置为 false 。

### 常见问题

现在我们已经学会如何在 Git 中添加忽略文件了，但是在使用的过程中，以下几个问题我们也是会常常遇见的。

#### 不能将文件添加到 git 仓库

有些时候，我们想添加一个文件到仓库中，但是我们发现我们添加不了，原因是这个文件已经被添加到 `.gitignore` 文件中忽略了。比如结合上述例子，我们想添加 `C.md` 文件，会有如下提示：

```bash
git add C.md
The following paths are ignored by one of your .gitignore files:
C.md
Use -f if you really want to add them.
```

如果我们确实需要添加该文件，那么我们可以使用 `-f` 选项来强制添加。

```bash
git add -f C.md
```

通过 `-f` 选项强制添加的文件，在后续的使用中与其他正常被 Git 跟踪的文件使用效果一样。也就是说 `C.md` 文件将会受到 Git 的跟踪管理。

如果你觉得 `gitignore` 中的忽略文件的书写有误，我们也可以使用 `git check-ignore` 来查看我们的忽略文件的规则：

```bash
git check-ignore -v c.md
.gitignore:1:C.md c.md
```

>关于该命令的更多介绍，可以查看官方文档[git-check-ignore](https://git-scm.com/docs/git-check-ignore)

#### 已经添加到暂存区中的文件如何忽略

还是结合我们上述的例子，在项目中，我们忘记了在 `.gitignore` 文件中添加忽略文件 `C.md`，直接使用了 `gid add .` 命令，将所有的文件都添加到了`暂存区`中，如下所示：

{% asset_img 忽略文件3.png 忽略文件3 %}

那么这个时候，我们可以使用 `git rm --cached` 命令，将 `C.md` 文件从暂存区中移除：

> 关于 `git rm` 命令的使用，可以查看官方文档[git rm](https://git-scm.com/docs/git-rm)

```bash
git rm --cached C.md
```

这个时候，我们在使用 `git status` 命令来仓库我们的仓库的状态，我们会发现 `C.md` 文件已经从暂存区中移除了。

{% asset_img 忽略文件4.png 忽略文件4 %}

那么接下来，我们就可以修改我们的 `.gitignore` 文件，将 `C.md` 添加到该忽略文件中去了。

#### 已经被跟踪文件如何忽略

不仅将文件添加到 Git 仓库，还推送到远程仓库了。并且其他合作的小伙伴已经从远程仓库拉取了更新。这个时候才发现某些文件需要忽略。

这种情况下，如果我们再将想忽略的文件添加到 `.gitignore` 文件中，已经完全不起任何作用了。

那怎么办呢？我们可以使用另外一个命令:

```bash
git update-index --assume-unchanged <file>
```

还是以上文中的 `C.md` 为例子，我们可以这样：

```bash
git update-index --assume-unchanged C.md
```

使用该命令后，即使我们修改了已经被跟踪的 `C.md` 文件，Git 也会默认我们没有更改该文件。什么意思呢？也就是我们本地随便修改该文件，Git 始终认为它和原来的版本一样。那么在之后的项目开发中，就不会产生包含该文件的提交了。

同样，我们也可以恢复对该文件的追踪，我们可以使用命令：

```bash
git update-index --no-assume-unchanged <file>
```

>关于该命令的使用，可以查看官方文档[--no-assume-unchanged](https://git-scm.com/docs/git-update-index#Documentation/git-update-index.txt---no-assume-unchanged)

### 小小的建议

通过阅读本篇文章，相信小伙伴已经意识到了找准正确的时间，添加忽略文件是多么的重要。这里需要提醒第一次使用 Git 或其他版本管理系统的小伙伴们。在创建仓库时，`一定要先处理忽略文件`，也就是你的 `.gitignore` 文件**一定要在项目初始化完成后提交！！！！** 因为后期再来处理忽略文件，就非常的麻烦与复杂。

所以在平时的项目中，一定要确定自己项目中哪些文件到底应该被追踪，哪些应该不被追踪。以 Android 项目为例：

```bash
*.iml
.gradle
/local.properties
/.idea/workspace.xml
/.idea/libraries
.DS_Store
/build
/captures
.externalNativeBuild
```

上述忽略文件是一般 Android 项目都会设置，因为这些都是一些配置文件、中间文件、项目配置文件等。当然不同的项目所需要配置的忽略文件并不相同，大家可以结合自身的需求来配置。这里就不具体讲解其他项目的忽略文件的配置了。

### 最后

整个 Git 新手系列教程，到现在已经写完了，虽然前前后后花费了一个月的时间，但是当自己完成后，却忍不住的满足与自豪。不是自己涨了好多粉丝，而是为自己能坚持做一件事而感到高兴。给自己定一个小目标，一步一步实现的感觉真好~
