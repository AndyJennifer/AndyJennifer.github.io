---
title: Andrido Sutido 4.1å·¥ç¨‹æ¨¡æ¿åŒ–æ€è€ƒä¸å®è·µ
tags:
  - å·¥ç¨‹æ¨¡æ¿
categories:
  - Android Studio
date: 2021-06-07 19:58:51
---


>å¿«ä¸€å¹´æ²¡æœ‰æ›´æ–°æ–‡ç« äº†ã€‚è¿™ä¸€æ®µæ—¶é—´ï¼Œå‘ç”Ÿäº†è®¸å¤šäº‹æƒ…å§ã€‚å¯èƒ½æ˜¯å·¥ä½œä¸Šï¼Œä¹Ÿè®¸æ˜¯ç”Ÿæ´»ä¸Šã€‚ä¸è¿‡ï¼Œæœ€ç»ˆè¿˜æ˜¯å›å½’åˆ°äº†æ­£å¸¸çš„çŠ¶æ€ä¸­æ¥ã€‚ä¸ç®¡æ€ä¹ˆæ ·ï¼Œæˆ‘å›æ¥äº†ã€‚åç»­æ–‡ç« ï¼Œå¤§å®¶æ•¬è¯·æœŸå¾…å§~

### å‰è¨€

å› ä¸ºå·¥ä½œéœ€è¦ï¼Œç»„å†…éœ€è¦åšä¸€å¥— Android é¡¹ç›®å·¥ç¨‹æ¨¡æ¿çš„æ–¹æ¡ˆï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³å¼€å‘äººå‘˜åœ¨åˆå§‹åŒ–é¡¹ç›®æ—¶é‡å¤åŠ³åŠ¨çš„é—®é¢˜ã€‚ä¸‹é¢æˆ‘æƒ³å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹ï¼Œå…³äºè¿™ä¸ªâ€œè¯¾é¢˜â€æˆ‘çš„æ€è€ƒè¿‡ç¨‹ä»¥åŠæˆ‘é€‰æ‹©çš„æŠ€æœ¯æ–¹æ¡ˆã€‚å¸Œæœ›è¯¥ç¯‡æ–‡ç« ï¼Œèƒ½ä¸ºéœ€è¦çš„å°ä¼™ä¼´æä¾›ä¸€äº›æ€è·¯å’Œå¸®åŠ©ã€‚

>å¦‚æœåªæƒ³å…³å¿ƒå¦‚ä½•åœ¨ Android Studio 4.1+ å®ç°å·¥ç¨‹æ¨¡æ¿åŒ–ï¼Œå¯ä»¥ç›´æ¥æŸ¥çœ‹æ–‡ç« --

### Android å·¥ç¨‹æ¨¡æ¿åŒ–éœ€è¦è§£å†³çš„é—®é¢˜

åˆ°è¿™é‡Œï¼Œå¯èƒ½æœ‰å°ä¼™ä¼´ä¼šè¯´ï¼šâ€å·¥ç¨‹æ¨¡æ¿åŒ–ä¸å°±æ˜¯åˆ›å»ºæ ·æ¿æ–‡ä»¶ï¼Ÿæ¯”å¦‚è‡ªåŠ¨ç”Ÿæˆ `â€MVVM"`ã€`â€œMVP"`ã€`â€MVI"`æ–‡ä»¶ï¼Œ è¿˜æœ‰å®˜æ–¹æä¾›çš„æ¨¡æ¿åˆ—è¡¨å—ï¼Ÿâ€œ


{% asset_img å®˜æ–¹æ¨¡æ¿.jpg å®˜æ–¹æ¨¡æ¿ %}


å¯¹ï¼Œå·¥ç¨‹æ¨¡æ¿åŒ–æœ€ç»ˆçš„äº§ç‰©å°±æ˜¯ `æ¨¡æ¿ä»£ç `ï¼Œä½†åˆšåˆšæˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„å†…å®¹ï¼Œåªæ˜¯é¡¹ç›®æ¨¡æ¿åŒ–çš„ä¸€ä¸ªå°ç‚¹ã€‚é™¤äº† `æ¨¡æ¿ä»£ç ` ä»¥å¤–ï¼Œåœ¨ Android é¡¹ç›®çš„ç”Ÿæˆä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä»`æ„å»º`ä¸`æ‰“åŒ…`ä¸¤ä¸ªç»´åº¦æ¥è€ƒè™‘ã€‚å¦‚ï¼š

- Project/Library çš„æ„å»ºï¼ˆåŸºç¡€é…ç½®ã€ä¾èµ–é…ç½®ã€ç¼–è¯‘é€‰é¡¹ã€æ¨¡æ¿ä»£ç ç­‰ï¼‰
- Project/Library çš„æ‰“åŒ…ï¼ˆç­¾åé…ç½®ã€æ‰“åŒ…é…ç½®ï¼‰


{% asset_img æ€è€ƒæ–¹å‘.jpg æ€è€ƒæ–¹å‘ %}

å¦‚æœæˆ‘ä»¬å†æŠŠè¿™äº›é…ç½®ç»†åŒ–æ¥çœ‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰æ›´å¤šçš„æ€è€ƒç‚¹ã€‚ğŸ¤”ğŸ¤”ğŸ¤”

{% asset_img å®‰å“å·¥ç¨‹æ¨¡æ¿åŒ–.png å®‰å“å·¥ç¨‹æ¨¡æ¿åŒ– %}

åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘å¤§æ¦‚æ¢³ç†å‡ºäº† Android å·¥ç¨‹æ¨¡æ¿éœ€è¦è€ƒè™‘çš„åŠŸèƒ½ç‚¹ã€‚å½“ç„¶ï¼Œä¸åŒçš„é¡¹ç›®å¯¹å·¥ç¨‹æ¨¡æ¿åŒ–çš„è¦æ±‚ä¸åŒï¼Œå¤§å®¶å¯ä»¥å‚è€ƒè¿™ä¸ªæ€è·¯å¯¹è‡ªå·±çš„é¡¹ç›®æ¨¡æ¿è¿›è¡Œè®¢åˆ¶ã€‚

### è°ƒç ”çš„æŠ€æœ¯æ–¹æ¡ˆ

åœ¨æœ‰äº†å¤§è‡´çš„æ€è·¯ä¹‹åï¼Œæˆ‘è°ƒç ”äº†ç°é˜¶æ®µå®ç° Android é¡¹ç›®æ¨¡æ¿çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œä¸‹é¢åˆ†åˆ«å¯¹è¿™å‡ ç§æ–¹æ¡ˆè¿›è¡Œä»‹ç»ã€‚

#### è‡ªå®šä¹‰è„šæœ¬

è‡ªå®šä¹‰è„šæœ¬çš„æ–¹æ¡ˆæ€è·¯å…¶å®éå¸¸ç®€å•ï¼Œå°±æ˜¯åœ¨æœ¬åœ°å»ºç«‹å¥½é¡¹ç›®æ¨¡æ¿ï¼Œç„¶åæ ¹æ®ç”¨æˆ·åœ¨å‘½ä»¤è¡Œè¾“å…¥çš„å‚æ•°æˆ–é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®è§„åˆ™å¤åˆ¶æˆ–åˆ›å»ºæ–°çš„æ–‡ä»¶ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š

{% asset_img è„šæœ¬æµç¨‹.png è„šæœ¬æµç¨‹ %}

è¯¥æ–¹æ¡ˆçš„ä¼˜ç‚¹ï¼š

- å®ç°ç®€å•å¿«é€Ÿã€‚ç”Ÿæˆå¥½çš„é¡¹ç›®å¯ä»¥ç›´æ¥é€šè¿‡ Android Studio æ‰“å¼€å¹¶é‡æ–°  build å°±å¥½äº†ã€‚

ç¼ºç‚¹ï¼š

- å› ä¸ºæ˜¯é€šè¿‡è„šæœ¬æ¥å¿«é€Ÿç”Ÿæˆï¼Œéœ€è¦è‡ªå·±å®šä¹‰ä¸€å¥—ç”Ÿæˆè§„åˆ™ã€‚
- æ— æ³•æ§åˆ¶é¡¹ç›®æ¨¡å—ä¹‹é—´çš„ä¾èµ–æ€§ã€‚éœ€è¦äººä¸ºä»‹å…¥
- å¯¹äºè¿™ç§é¡¹ç›®æ„å»ºçš„ï¼Œå‘½ä»¤è¡Œæˆ–è€…é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œå¯¹å¼€å‘äººå‘˜æ¥è¯´ï¼Œå¯èƒ½ä¸æ˜¯å¾ˆå‹å¥½ã€‚


#### FreeMarker æ¨¡æ¿æ–¹æ¡ˆ

åœ¨ Android 4.1 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæä¾›äº†ä¸€å¥—åŸºäº `FreeMarker` æŠ€æœ¯çš„æ¨¡æ¿å®ç°ï¼Œéœ€è¦åœ¨æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸­æä¾›ç›¸åº”çš„`.ftl`æ–‡ä»¶ã€‚å¦‚:

- Windows çš„è·¯å¾„åœ¨ `${android studio å®‰è£…è·¯å¾„}/plugins/android/lib/templates/`
- MacOS çš„è·¯å¾„åœ¨ `${Android Studio.app å­˜æ”¾è·¯å¾„}/Contents/plugins/android/lib/templates/`

å…·ä½“çš„ä»£ç ç”Ÿæˆè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š

{% asset_img ä»£ç ç”Ÿæˆè¿‡ç¨‹.jpg ä»£ç ç”Ÿæˆè¿‡ç¨‹ %}

ä½†æ˜¯åœ¨ `Android 4.1`ä¹‹åï¼Œè°·æ­Œåœæ­¢äº†å¯¹è¯¥æ¨¡æ¿çš„æ”¯æŒï¼Œå…·ä½“åŸå› æ˜¯å› ä¸ºé…ç½®å‚æ•°æ˜¯ `.ftl` çš„æ–¹å¼æ¥æè¿°é…ç½®ä¿¡æ¯ï¼Œè¿™ç§å¯¹å¼€å‘è€…æ¥è¯´å¾ˆå®¹æ˜“é…ç½®é”™è¯¯ã€‚æœ€ä¸ºé‡è¦çš„æ˜¯ä¸ºäº†çœ‹åˆ°å®é™…çš„æ¨¡æ¿æ•ˆæœï¼Œå¼€å‘è€…å¿…é¡»è¦é‡å¯ Android Studioï¼Œè¿™æ ·çš„æ“ä½œå¤ªè¿‡å‚»ç“œå¼ã€‚æ‰€ä»¥è°·æ­Œäº†æä¾›äº†å¦ä¸€ç§æ›´å‹å¥½ï¼Œé˜…è¯»æ€§æ›´å¼ºçš„æ–¹æ¡ˆã€‚ä¹Ÿå°±æ˜¯æ¥ä¸‹æ¥æˆ‘ä»¬è¦ä»‹ç»çš„æ’ä»¶æ–¹æ¡ˆã€‚

å¯¹ `FreeMarke` æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥å‚è€ƒä¸‹åˆ—æ–‡ç« ï¼Œè¿™é‡Œå°±ä¸å†è¿›è¡Œä»‹ç»äº†ã€‚

- [ç½‘æ˜“Androidå·¥ç¨‹æ¨¡æ¿åŒ–å®è·µ](https://www.jianshu.com/p/a264afa089bc)
- [custom-android-code-templates](https://www.slideshare.net/murphonic/custom-android-code-templates-15537501)
- [Android ADT Template Format Document](https://www.i-programmer.info/professional-programmer/resources-and-tools/6845-android-adt-template-format-document.html)
- [FreeMarker åœ¨çº¿æ‰‹å†Œ](http://freemarker.foofun.cn/ref_directives.html)


#### è‡ªå®šä¹‰ Android Studio æ’ä»¶æ–¹æ¡ˆ

ä» Android Studio 4.1 å¼€å§‹ï¼ŒGoogle åœæ­¢äº†å¯¹è‡ªå®šä¹‰ FreeMarker æ¨¡æ¿çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯ `ä¸æ”¯æŒä¹¦å†™.ftlæ–‡ä»¶å¹¶æ”¾åœ¨ç‰¹å®šæ–‡ä»¶å¤¹æ¥ç”Ÿæˆæ¨¡æ¿çš„æ–¹å¼è¿™ä¸­æ–¹å¼`ï¼Œè€Œæ˜¯é€šè¿‡æ‰©å±•[android-plugin](https://plugins.jetbrains.com/docs/intellij/extension-point-list.html#android-pluginxml)æ’ä»¶ä¸­çš„æ¨¡æ¿æ‰©å±•ç‚¹ `WizardTemplateProvider`  æ¥å®ç°æˆ‘ä»¬è‡ªå·±æ¨¡æ¿å·¥ç¨‹ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š


{% asset_img AndroidPluginæ‰©å±•.jpg AndroidPluginæ‰©å±• %}

åŸºäº `WizardTemplateProvider` æ¨¡æ¿æ–¹æ¡ˆçš„ä¸»è¦æµç¨‹å¹¶ä¸å¤æ‚ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹ï¼š


{% asset_img Wizard.png Wizard %}


åœ¨æˆ‘ä»¬ä½¿ç”¨ Android Studio æ–°å»º Project/Library çš„æ—¶å€™ä¼šå…ˆè·å–`æ¨¡æ¿åˆ—è¡¨`ï¼Œæ¨¡æ¿åˆ—è¡¨ä¸­ç»´æŠ¤äº†ä¸€ä¸ªä¸ª `Template`ã€‚è¿™äº› `Template` å¯¹åº”åˆ° Android Studio ä¸­ï¼Œå…¶å®å°±æ˜¯è¿™äº›ï¼š


{% asset_img å®˜æ–¹æ¨¡æ¿2.jpg å®˜æ–¹æ¨¡æ¿2 %}


è€Œè¿™äº› `Template` æ˜¯ç”±å¤šä¸ª `WizardTemplateProvider` æä¾›çš„ã€‚ `Template` å†…éƒ¨ç»´æŠ¤äº†ä¸€æ•´å¥—æ¨¡æ¿é…ç½®æµç¨‹ï¼ŒåŒ…æ‹¬é…ç½®ç•Œé¢å‚æ•°->å®é™…æ–‡ä»¶ç”Ÿæˆä¸¤ä¸ªå…³é”®æ­¥éª¤ï¼Œè¿™ä¸¤ä¸ªæ­¥éª¤åˆ†åˆ«ç”±å†…éƒ¨çš„ `UI Parameters`ã€ `Recipe`, `RecipeExecutor` ç»„ä»¶æ¥æ§åˆ¶ï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š

{% asset_img Recipe.png Recipe %}

å…¶ä¸­ `UI Parameters`ã€ `Recipe`, `RecipeExecutor` ä¸»è¦ä½œç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š

- UI Parameters: æ¨¡æ¿é…ç½®UIç•Œé¢ã€‚ä¸»è¦è´Ÿè´£å½•å…¥æ¨¡æ¿é…ç½®å‚æ•°ã€‚å¦‚æ¨¡å—åç§°ï¼Œæœ€å°æ”¯æŒSDKç­‰
- Recipe: æ¨¡æ¿å·¥ç¨‹æ ¸å¿ƒé€»è¾‘ã€‚æ ¹æ® UI Parametersç»„ä»¶æä¾›çš„é…ç½®å‚æ•°ï¼Œåˆ›å»ºæ¨¡æ¿æ–‡ä»¶ã€æ¨¡æ¿ä»£ç ç­‰æ“ä½œ
- RecipeExecutor: æ¨¡æ¿å·¥ç¨‹åº•å±‚APIã€‚æä¾›æ·»åŠ ä¾èµ–ï¼Œæ‹·è´æ–‡ä»¶ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹ï¼Œåˆå¹¶xmlæ–‡ä»¶ç­‰åŸºç¡€èƒ½åŠ›


è¯¥æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼š

ä¼˜ç‚¹ï¼š

1. å› ä¸ºæ˜¯å®˜æ–¹æä¾›çš„APIï¼Œæ¯”å¦‚


ç¼ºç‚¹ï¼š

- é—®é¢˜å¦‚æœè¦å¤šé¡¹ç›®çš„æ„å»ºç‰ˆæœ¬åŠä»€ä¹ˆè¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚æ— æ³•ä¿®æ”¹ã€‚å®˜æ–¹å°±åªæä¾›äº†é‚£å‡ ä¸ªAPI

### æœ€å


- [Magic Templating for Android Projects](https://medium.com/hh-ru/magic-templating-for-android-projects-f937aedfe691)
- [Template plugin for Android Studio 4.1+](https://steewsc.medium.com/template-plugin-for-android-studio-4-1-92dcbc689d39)
- [Android Studio source code and the code of relevant tamplates](https://cs.android.com/android-studio/platform/tools/base/+/mirror-goog-studio-master-dev:wizard/template-impl/src/com/android/tools/idea/wizard/template/impl/)
- [ç½‘æ˜“Androidå·¥ç¨‹æ¨¡æ¿åŒ–å®è·µ](https://www.jianshu.com/p/a264afa089bc)

ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œæ‰èƒ½çœ‹çš„æ›´è¿œ~
