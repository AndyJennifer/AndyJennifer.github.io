<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/bangbangtang-32*32.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/bangbangtang-16*16.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="å‰è¨€ å¹´åæœ€åä¸€ç¯‡æ–‡ç« å•¦ï¼Œåœ¨è¿™é‡Œå…ˆç¥å¤§å®¶æ–°å¹´å¿«ä¹~æœ€é‡è¦çš„æŠ½ä¸­å…¨å®¶ç¦ï¼Œæ˜å¹´ç»§ç»­ä¿®ç¦æŠ¥ğŸ¤£  ä»¥å‰å¤„ç† Fragment çš„æ‡’åŠ è½½ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨ Fragment ä¸­å¤„ç† setUserVisibleHint + onHiddenChanged è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œè€Œåœ¨ Androidx æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ FragmentTransaction.setMaxLifecycle() çš„æ–¹å¼æ¥å¤„ç† Fra">
<meta name="keywords" content="æ‡’åŠ è½½">
<meta property="og:type" content="article">
<meta property="og:title" content="Androidx ä¸‹ Fragment æ‡’åŠ è½½çš„æ–°å®ç°">
<meta property="og:url" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/index.html">
<meta property="og:site_name" content="AndyJennifer&#39;Blog">
<meta property="og:description" content="å‰è¨€ å¹´åæœ€åä¸€ç¯‡æ–‡ç« å•¦ï¼Œåœ¨è¿™é‡Œå…ˆç¥å¤§å®¶æ–°å¹´å¿«ä¹~æœ€é‡è¦çš„æŠ½ä¸­å…¨å®¶ç¦ï¼Œæ˜å¹´ç»§ç»­ä¿®ç¦æŠ¥ğŸ¤£  ä»¥å‰å¤„ç† Fragment çš„æ‡’åŠ è½½ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨ Fragment ä¸­å¤„ç† setUserVisibleHint + onHiddenChanged è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œè€Œåœ¨ Androidx æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ FragmentTransaction.setMaxLifecycle() çš„æ–¹å¼æ¥å¤„ç† Fra">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/Fragment.jpg">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/åŒçº§Fragment.jpg">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show1.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show2.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show3.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/viewpager1.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/viewpage2.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/viewpager_3.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/viewpager4.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/å¤æ‚åµŒå¥—Fragment.jpg">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/androix1.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/androix2.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/androidx3.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show_new1.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show_new2.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show_new3.png">
<meta property="og:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/ç‘•ç–µ.png">
<meta property="og:updated_time" content="2020-01-18T16:36:00.150Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Androidx ä¸‹ Fragment æ‡’åŠ è½½çš„æ–°å®ç°">
<meta name="twitter:description" content="å‰è¨€ å¹´åæœ€åä¸€ç¯‡æ–‡ç« å•¦ï¼Œåœ¨è¿™é‡Œå…ˆç¥å¤§å®¶æ–°å¹´å¿«ä¹~æœ€é‡è¦çš„æŠ½ä¸­å…¨å®¶ç¦ï¼Œæ˜å¹´ç»§ç»­ä¿®ç¦æŠ¥ğŸ¤£  ä»¥å‰å¤„ç† Fragment çš„æ‡’åŠ è½½ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨ Fragment ä¸­å¤„ç† setUserVisibleHint + onHiddenChanged è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œè€Œåœ¨ Androidx æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ FragmentTransaction.setMaxLifecycle() çš„æ–¹å¼æ¥å¤„ç† Fra">
<meta name="twitter:image" content="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/Fragment.jpg">






  <link rel="canonical" href="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Androidx ä¸‹ Fragment æ‡’åŠ è½½çš„æ–°å®ç° | AndyJennifer'Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">AndyJennifer'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">What would life be if we had no courage to attempt anything?</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>å…³äº</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/AndyJennifer" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="AndyJennifer">
      <meta itemprop="description" content="AndyJennifer ä¸ªäººç«™ï¼Œä¸»è¦æ¶‰åŠAndroidã€Javaã€Kotlinç­‰ç›¸å…³çŸ¥è¯†ï¼Œæ„¿ä¸å¤§å®¶å…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥">
      <meta itemprop="image" content="http://upload-images.jianshu.io/upload_images/2824145-e320240ea6ec767d.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AndyJennifer'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Androidx ä¸‹ Fragment æ‡’åŠ è½½çš„æ–°å®ç°

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-01-19 00:28:54 / ä¿®æ”¹æ—¶é—´ï¼š00:36:00" itemprop="dateCreated datePublished" datetime="2020-01-19T00:28:54+08:00">2020-01-19</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Fragment/" itemprop="url" rel="index"><span itemprop="name">Fragment</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             é˜…è¯»æ¬¡æ•°ï¼š 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">18k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">33 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/Fragment.jpg" title="Fragment">
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><blockquote>
<p>å¹´åæœ€åä¸€ç¯‡æ–‡ç« å•¦ï¼Œåœ¨è¿™é‡Œå…ˆç¥å¤§å®¶æ–°å¹´å¿«ä¹~æœ€é‡è¦çš„æŠ½ä¸­<code>å…¨å®¶ç¦</code>ï¼Œæ˜å¹´ç»§ç»­ä¿®ç¦æŠ¥ğŸ¤£</p>
</blockquote>
<p>ä»¥å‰å¤„ç† Fragment çš„æ‡’åŠ è½½ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨ Fragment ä¸­å¤„ç† <code>setUserVisibleHint + onHiddenChanged</code> è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œè€Œåœ¨ Androidx æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>FragmentTransaction.setMaxLifecycle()</code> çš„æ–¹å¼æ¥å¤„ç† Fragment çš„æ‡’åŠ è½½ã€‚</p>
<p>åœ¨æœ¬æ–‡ç« ä¸­ï¼Œæˆ‘ä¼šè¯¦ç»†ä»‹ç»ä¸åŒä½¿ç”¨åœºæ™¯ä¸‹ä¸¤ç§æ–¹æ¡ˆçš„å·®å¼‚ã€‚å¤§å®¶å¿«æ‹¿å¥½å°æ¿å‡³ã€‚ä¸€èµ·æ¥å­¦ä¹ æ–°çŸ¥è¯†å§ï¼</p>
<blockquote>
<p>æœ¬ç¯‡æ–‡ç« æ¶‰åŠåˆ°çš„ Demoï¼Œå·²ä¸Šä¼ è‡³Githubâ€”-&gt;<a href="https://github.com/AndyJennifer/AndroidxLazyLoad" target="_blank" rel="noopener">ä¼ é€é—¨</a></p>
</blockquote>
<h3 id="è€çš„æ‡’åŠ è½½å¤„ç†æ–¹æ¡ˆ"><a href="#è€çš„æ‡’åŠ è½½å¤„ç†æ–¹æ¡ˆ" class="headerlink" title="è€çš„æ‡’åŠ è½½å¤„ç†æ–¹æ¡ˆ"></a>è€çš„æ‡’åŠ è½½å¤„ç†æ–¹æ¡ˆ</h3><blockquote>
<p>å¦‚æœä½ ç†Ÿæ‚‰è€ä¸€å¥—çš„ Fragment æ‡’åŠ è½½æœºåˆ¶ï¼Œä½ å¯ä»¥ç›´æ¥æŸ¥çœ‹ Androix æ‡’åŠ è½½ç›¸å…³ç« èŠ‚</p>
</blockquote>
<h4 id="add-show-hide-æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ"><a href="#add-show-hide-æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ" class="headerlink" title="add+show+hide æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ"></a>add+show+hide æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ</h4><p>åœ¨æ²¡æœ‰æ·»åŠ æ‡’åŠ è½½ä¹‹å‰ï¼Œåªè¦ä½¿ç”¨ <code>add+show+hide</code> çš„æ–¹å¼æ§åˆ¶å¹¶æ˜¾ç¤º Fragment, é‚£ä¹ˆä¸ç®¡ Fragment æ˜¯å¦åµŒå¥—ï¼Œåœ¨åˆå§‹åŒ–åï¼Œå¦‚æœ<code>åªè°ƒç”¨äº†add+show</code>ï¼ŒåŒçº§ä¸‹çš„ Fragment çš„ç›¸å…³ç”Ÿå‘½å‘¨æœŸå‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ã€‚ä¸”è°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><code>onAttach -&gt; onCreate -&gt; onCreatedView -&gt; onActivityCreated -&gt; onStart -&gt; onResume</code></p>
<blockquote>
<p>Fragment å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼šonAttach -&gt; onCreate -&gt; onCreatedView -&gt; onActivityCreated -&gt; onStart -&gt; onResume -&gt; onPause -&gt; onStop -&gt; onDestroyView -&gt; onDestroy -&gt; onDetach</p>
</blockquote>
<p>ä»€ä¹ˆæ˜¯åŒçº§ Frament å‘¢ï¼Ÿçœ‹ä¸‹å›¾</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/åŒçº§Fragment.jpg" title="åŒçº§Fragment">
<blockquote>
<p>ä¸Šå›¾ä¸­ï¼Œéƒ½æ˜¯ä½¿ç”¨ <code>add+show+hide</code> çš„æ–¹å¼æ§åˆ¶ Fragment,</p>
</blockquote>
<p>åœ¨ä¸Šå›¾ä¸¤ç§æ¨¡å¼ä¸­:</p>
<ul>
<li>Fragment_1ã€Fragment_2ã€Fragment_3 å±äºåŒçº§ Fragment</li>
<li>Fragment_aã€Fragment_bã€Fragment_c å±äºåŒçº§ Fragment</li>
<li>Fragment_dã€Fragment_eã€Fragment_f å±äºåŒçº§ Fragment</li>
</ul>
<p>é‚£è¿™ç§æ–¹å¼ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿç»“åˆä¸‹å›¾æˆ‘ä»¬æ¥åˆ†åˆ«åˆ†æã€‚</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show1.png" title="show1">
<p>è§‚å¯Ÿä¸Šå›¾æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒåŒçº§çš„Fragment_1ã€Fragment_2ã€Fragment_3 éƒ½è°ƒç”¨äº† <code>onAttach...onResume</code> ç³»åˆ—æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å¯¹ Fragment è¿›è¡Œæ‡’åŠ è½½å¤„ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šæ— ç¼˜æ— æ•…çš„åŠ è½½ä¸€äº›å¹¶<code>ä¸å¯è§</code>çš„ Fragment , ä¹Ÿå°±ä¼šé€ æˆç”¨æˆ·æµé‡çš„æ— æ•…æ¶ˆè€—ï¼ˆæˆ‘ä»¬ä¼šåœ¨ Fragment ç›¸å…³ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ï¼Œè¯·æ±‚ç½‘ç»œæˆ–å…¶ä»–æ•°æ®æ“ä½œï¼‰ã€‚</p>
<blockquote>
<p>è¿™é‡Œ<code>&quot;ä¸å¯è§çš„Fragment&quot;</code>æ˜¯æŒ‡ï¼Œå®é™…ä¸å¯è§ä½†æ˜¯ç›¸å…³å¯è§ç”Ÿå‘½å‘¨æœŸå‡½æ•°(å¦‚ <code>onResume</code> æ–¹æ³•ï¼‰è¢«è°ƒç”¨çš„ Fragment</p>
</blockquote>
<p>å¦‚æœä½¿ç”¨åµŒå¥— Fragment ï¼Œè¿™ç§æµªè´¹æµé‡çš„è¡Œä¸ºå°±æ›´æ˜æ˜¾äº†ã€‚ä»¥æœ¬èŠ‚çš„å›¾ä¸€ä¸ºä¾‹ï¼Œå½“ Fragment_1 åŠ è½½æ—¶ï¼Œå¦‚æœä½ åœ¨ Fragment_1 ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ä½¿ç”¨ <code>show+add+hide</code> çš„æ–¹å¼æ·»åŠ  <code>Fragment_aã€Fragment_bã€Fragment_c</code> , é‚£ä¹ˆ Fragment_b åˆä¼šåœ¨å…¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ç»§ç»­åŠ è½½ <code>Fragment_dã€Fragment_eã€Fragment_f</code> ã€‚</p>
<p>é‚£å¦‚ä½•è§£å†³è¿™ç§é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­æ¥ç€ä¸Šé¢çš„ä¾‹å­èµ°ï¼Œå½“æˆ‘ä»¬ <code>show Fragment_2</code>ï¼Œå¹¶ hideå…¶ä»– Fragment æ—¶ï¼Œå¯¹åº” Fragment çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨å¦‚ä¸‹ï¼š</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show2.png" title="show2">
<p>ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º Fragment_2 ä¸ Fragment_3 éƒ½è°ƒç”¨äº† <code>onHiddenChanged</code> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å®˜æ–¹ API å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Called when the hidden state (as returned by &#123;<span class="doctag">@link</span> #isHidden()&#125; of</span></span><br><span class="line"><span class="comment"> * the fragment has changed.  Fragments start out not hidden; this will</span></span><br><span class="line"><span class="comment"> * be called whenever the fragment changes state from that.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hidden True if the fragment is now hidden, false otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onHiddenChanged</span><span class="params">(<span class="keyword">boolean</span> hidden)</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®å®˜æ–¹ API çš„æ³¨é‡Šï¼Œæˆ‘ä»¬å¤§æ¦‚èƒ½çŸ¥é“ï¼Œå½“ Fragment éšè—çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè¯¥å‡½æ•°å°†ä¼šè¢«è°ƒç”¨ï¼Œå¦‚æœå½“å‰ Fragment éšè—ï¼Œ <code>hidden</code> çš„å€¼ä¸º true, åä¹‹ä¸º falseã€‚æœ€ä¸ºé‡è¦çš„æ˜¯<code>hidden</code> çš„å€¼ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <code>isHidden()</code> å‡½æ•°è·å–ã€‚</p>
<p>é‚£ä¹ˆç»“åˆä¸Šè¿°çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬èƒ½æ¨å¯¼å‡ºï¼š</p>
<ul>
<li>å› ä¸º Fragment_1 çš„ <code>éšè—çŠ¶æ€</code> ä»<code>å¯è§è½¬ä¸ºäº†ä¸å¯è§</code>ï¼Œæ‰€ä»¥å…¶ <code>onHiddenChanged</code> å‡½æ•°è¢«è°ƒç”¨ï¼ŒåŒæ—¶ <code>hidden</code> çš„å€¼ä¸º trueã€‚</li>
<li>åŒç†å¯¹äº Fragment_2 ï¼Œå› ä¸ºå…¶ <code>éšè—çŠ¶æ€</code> ä» <code>ä¸å¯è§è½¬ä¸ºäº†å¯è§</code> ï¼Œæ‰€ä»¥å…¶ hidden å€¼ä¸º falseã€‚</li>
<li>å¯¹äº Fragment_3 ,å› ä¸ºå…¶éšè—çŠ¶æ€ä»å§‹è‡³ç»ˆéƒ½æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥å…¶ onHiddenChanged å‡½æ•°å¹¶ä¸ä¼šè°ƒç”¨ã€‚</li>
</ul>
<p>å—¯ï¼Œå¥½åƒæœ‰ç‚¹çœ‰ç›®äº†ã€‚ä¸æ€¥ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p>
<p> show Fragment_3 å¹¶ hide å…¶ä»– Fragment ï¼Œå¯¹åº”ç”Ÿå‘½å‘¨æœŸå‡½æ•°è°ƒç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show3.png" title="show3">
<p>ä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œç¡®å®åªæœ‰<code>éšè—çŠ¶æ€</code>å‘ç”Ÿäº†æ”¹å˜çš„ Fragment å…¶ <code>onHiddenChanged</code> å‡½æ•°æ‰ä¼šè°ƒç”¨ï¼Œé‚£ä¹ˆç»“åˆä»¥ä¸ŠçŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬èƒ½å¾—å‡ºå¦‚ä¸‹é‡è¦ç»“è®ºï¼š</p>
<p><strong>åªè¦é€šè¿‡ <code>show+hide</code> æ–¹å¼æ§åˆ¶ Fragment çš„æ˜¾éšï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–åï¼ŒFragment ä»»ä½•çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•éƒ½ä¸ä¼šè°ƒç”¨ï¼Œåªæœ‰ <code>onHiddenChanged</code> æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</strong></p>
<p>é‚£ä¹ˆï¼Œå‡å¦‚æˆ‘ä»¬è¦åœ¨ <code>add+show+hide</code> æ¨¡å¼ä¸‹æ§åˆ¶ Fragment çš„æ‡’åŠ è½½ï¼Œæˆ‘ä»¬åªéœ€è¦åšè¿™ä¸¤æ­¥ï¼š</p>
<ul>
<li>æˆ‘ä»¬éœ€è¦åœ¨ <code>onResume()</code> å‡½æ•°ä¸­è°ƒç”¨ <code>isHidden()</code> å‡½æ•°ï¼Œæ¥å¤„ç†é»˜è®¤æ˜¾ç¤ºçš„ Fragment</li>
<li>åœ¨ <code>onHiddenChanged</code> å‡½æ•°ä¸­æ§åˆ¶å…¶ä»–ä¸å¯è§çš„Fragmentï¼Œ</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¿™æ ·å¤„ç†ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyFragment</span>:<span class="type">Fragment</span></span>()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isLoaded = <span class="literal">false</span> <span class="comment">//æ§åˆ¶æ˜¯å¦æ‰§è¡Œæ‡’åŠ è½½</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResume</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume()</span><br><span class="line">        judgeLazyInit()</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onHiddenChanged</span><span class="params">(hidden: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onHiddenChanged(hidden)</span><br><span class="line">        isVisibleToUser = !hidden</span><br><span class="line">        judgeLazyInit()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">judgeLazyInit</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isLoaded &amp;&amp; !isHidden) &#123;</span><br><span class="line">            lazyInit()</span><br><span class="line">            isLoaded = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroyView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroyView()</span><br><span class="line">        isLoaded = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‡’åŠ è½½æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">lazyInit</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¯¥æ‡’åŠ è½½çš„å®ç°ï¼Œæ˜¯åœ¨ <code>onResume</code> æ–¹æ³•ä¸­æ“ä½œï¼Œå½“ç„¶ä½ å¯ä»¥åœ¨å…¶ä»–ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­æ§åˆ¶ã€‚ä½†æ˜¯å»ºè®®åœ¨è¯¥æ–¹æ³•ä¸­æ‰§è¡Œæ‡’åŠ è½½ã€‚</p>
</blockquote>
<h4 id="ViewPager-Fragment-æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ"><a href="#ViewPager-Fragment-æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ" class="headerlink" title="ViewPager+Fragment æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ"></a>ViewPager+Fragment æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ</h4><p>ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼å¤„ç† ViewPager ä¸­ Fragment çš„æ‡’åŠ è½½ï¼Œæˆ‘ä»¬éœ€è¦æ§åˆ¶ <code>setUserVisibleHint(boolean isVisibleToUser)</code> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å£°æ˜å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserVisibleHint</span><span class="params">(<span class="keyword">boolean</span> isVisibleToUser)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥å‡½æ•°ä¸ä¹‹å‰æˆ‘ä»¬ä»‹ç»çš„ <code>onHiddenChanged()</code> ä½œç”¨éå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ä¼ å…¥çš„å‚æ•°å€¼æ¥åˆ¤æ–­å½“å‰ Fragment æ˜¯å¦å¯¹ç”¨æˆ·å¯è§ï¼Œåªæ˜¯ <code>onHiddenChanged()</code> æ˜¯åœ¨ <code>add+show+hide</code> æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œè€Œ <code>setUserVisibleHint</code> æ˜¯åœ¨ ViewPager+Fragment æ¨¡å¼ä¸‹ä½¿ç”¨ã€‚</p>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç”¨ <code>FragmentPagerAdapter + ViewPager</code> ä¸ºä¾‹ï¼Œå‘å¤§å®¶è®²è§£å¦‚ä½•å®ç° Fragment çš„æ‡’åŠ è½½ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨æœ¬ä¾‹ä¸­æ²¡æœ‰è°ƒç”¨ <code>setOffscreenPageLimit</code> æ–¹æ³•å»è®¾ç½® ViewPager é¢„ç¼“å­˜çš„ Fragment ä¸ªæ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ ViewPager é¢„ç¼“å­˜ Fragment çš„ä¸ªæ•°ä¸º <code>1</code> ã€‚</p>
</blockquote>
<p>åˆå§‹åŒ– ViewPager æŸ¥çœ‹å†…éƒ¨ Fragment ç”Ÿå‘½å‘¨æœŸå‡½æ•°è°ƒç”¨æƒ…å†µï¼š</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/viewpager1.png" title="viewpager1">
<p>è§‚å¯Ÿä¸Šå›¾ï¼Œæˆ‘ä»¬èƒ½å‘ç° ViePager åˆå§‹åŒ–æ—¶ï¼Œé»˜è®¤ä¼šè°ƒç”¨å…¶å†…éƒ¨ Fragment çš„ setUserVisibleHint æ–¹æ³•ï¼Œå› ä¸ºå…¶é¢„ç¼“å­˜ Fragment ä¸ªæ•°ä¸º <code>1</code> çš„åŸå› ï¼Œæ‰€ä»¥åªæœ‰ Fragment_1 ä¸ Fragment_2 çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°è¢«è°ƒç”¨ã€‚</p>
<p>æˆ‘ä»¬ç»§ç»­åˆ‡æ¢åˆ° Fragment_2ï¼ŒæŸ¥çœ‹å„ä¸ªFragmentçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„è°ƒç”¨å˜åŒ–ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/viewpage2.png" title="viewpage2">
<p>è§‚å¯Ÿä¸Šå›¾ï¼Œæˆ‘ä»¬åŒæ ·å‘ç° Fragment çš„ setUserVisibleHint æ–¹æ³•è¢«è°ƒç”¨äº†ï¼Œå¹¶ä¸” Fragment_3 çš„ä¸€ç³»åˆ—ç”Ÿå‘½å‘¨æœŸå‡½æ•°è¢«è°ƒç”¨äº†ã€‚ç»§ç»­åˆ‡æ¢åˆ° Fragment_3:</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/viewpager_3.png" title="viewpager_3">
<p>è§‚å¯Ÿä¸Šå›¾å¯ä»¥å‘ç°ï¼ŒFragment_3 è°ƒç”¨äº† setUserVisibleHint æ–¹æ³•ï¼Œç»§ç»­åˆåˆ‡æ¢åˆ° Fragment_1ï¼ŒæŸ¥çœ‹è°ƒç”¨å‡½æ•°çš„å˜åŒ–ï¼š</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/viewpager4.png" title="viewpager4">
<blockquote>
<p>å› ä¸ºä¹‹å‰åœ¨åˆ‡æ¢åˆ° Fragment_3 æ—¶ï¼ŒFrafgment_1 å·²ç»èµ°äº† onDestoryView(å›¾äºŒï¼Œè“è‰²æ ‡è®°å¤„) æ–¹æ³•ï¼Œæ‰€ä»¥ Fragment_1 éœ€è¦é‡æ–°èµ°ä¸€æ¬¡ç”Ÿå‘½å‘¨æœŸã€‚</p>
</blockquote>
<p>é‚£ä¹ˆç»“åˆæœ¬èŠ‚çš„ä¸‰å¹…å›¾ï¼Œæˆ‘ä»¬èƒ½å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨ ViewPagerï¼Œåˆ‡æ¢å›ä¸Šä¸€ä¸ª Fragment é¡µé¢æ—¶ï¼ˆå·²ç»åˆå§‹åŒ–å®Œæ¯•ï¼‰ï¼Œä¸ä¼šå›è°ƒä»»ä½•ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä»¥åŠonHiddenChanged()ï¼Œåªæœ‰ setUserVisibleHint(boolean isVisibleToUser) ä¼šè¢«å›è°ƒã€‚</li>
<li>setUserVisibleHint(boolean isVisibleToUser) æ–¹æ³•æ€»æ˜¯ä¼šä¼˜å…ˆäº Fragment ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„è°ƒç”¨ã€‚</li>
</ul>
<p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³å¯¹ ViewPager ä¸­çš„ Fragment æ‡’åŠ è½½ï¼Œæˆ‘ä»¬éœ€è¦è¿™æ ·å¤„ç†ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦æ‰§è¡Œæ‡’åŠ è½½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isLoaded = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰Fragmentæ˜¯å¦å¯¹ç”¨æˆ·å¯è§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isVisibleToUser = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“ä½¿ç”¨ViewPager+Fragmentå½¢å¼ä¼šè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼ŒsetUserVisibleHintä¼šä¼˜å…ˆFragmentç”Ÿå‘½å‘¨æœŸå‡½æ•°è°ƒç”¨ï¼Œ</span></span><br><span class="line"><span class="comment">     * æ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±,ä¼šå¯¼è‡´åœ¨setUserVisibleHintæ–¹æ³•æ‰§è¡Œæ—¶å°±æ‰§è¡Œäº†æ‡’åŠ è½½ï¼Œ</span></span><br><span class="line"><span class="comment">     * è€Œä¸æ˜¯åœ¨onResumeæ–¹æ³•å®é™…è°ƒç”¨çš„æ—¶å€™æ‰§è¡Œæ‡’åŠ è½½ã€‚æ‰€ä»¥éœ€è¦è¿™ä¸ªå˜é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isCallResume = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResume</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume()</span><br><span class="line">        isCallResume = <span class="literal">true</span></span><br><span class="line">        judgeLazyInit()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">judgeLazyInit</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isLoaded &amp;&amp; isVisibleToUser &amp;&amp; isCallResume) &#123;</span><br><span class="line">            lazyInit()</span><br><span class="line">            Log.d(TAG, <span class="string">"lazyInit:!!!!!!!"</span>)</span><br><span class="line">            isLoaded = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onHiddenChanged</span><span class="params">(hidden: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onHiddenChanged(hidden)</span><br><span class="line">        isVisibleToUser = !hidden</span><br><span class="line">        judgeLazyInit()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åœ¨Fragmenté”€æ¯Viewçš„æ—¶å€™ï¼Œé‡ç½®çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroyView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroyView()</span><br><span class="line">        isLoaded = <span class="literal">false</span></span><br><span class="line">        isVisibleToUser = <span class="literal">false</span></span><br><span class="line">        isCallResume = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setUserVisibleHint</span><span class="params">(isVisibleToUser: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.setUserVisibleHint(isVisibleToUser)</span><br><span class="line">        <span class="keyword">this</span>.isVisibleToUser = isVisibleToUser</span><br><span class="line">        judgeLazyInit()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">lazyInit</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¤æ‚-Fragment-åµŒå¥—çš„æƒ…å†µ"><a href="#å¤æ‚-Fragment-åµŒå¥—çš„æƒ…å†µ" class="headerlink" title="å¤æ‚ Fragment åµŒå¥—çš„æƒ…å†µ"></a>å¤æ‚ Fragment åµŒå¥—çš„æƒ…å†µ</h4><p>å½“ç„¶ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°æ›´ä¸ºå¤æ‚çš„ Fragment åµŒå¥—ç»„åˆã€‚æ¯”å¦‚ Fragment+Fragmentã€Fragment+ViewPagerã€ViewPager+ViewPagerâ€¦.ç­‰ç­‰ã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/å¤æ‚åµŒå¥—Fragment.jpg" title="å¤æ‚åµŒå¥—Fragment">
<p>å¯¹äºä»¥ä¸Šåœºæ™¯ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡å†™æˆ‘ä»¬çš„æ‡’åŠ hè½½ï¼Œä»¥æ”¯æŒä¸åŒåµŒå¥—ç»„åˆæ¨¡å¼ä¸‹ Fragment æ­£ç¡®æ‡’åŠ è½½ã€‚æˆ‘ä»¬éœ€è¦å°† LazyFragment ä¿®æ”¹æˆå¦‚ä¸‹è¿™æ ·ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦æ‰§è¡Œæ‡’åŠ è½½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isLoaded = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“å‰Fragmentæ˜¯å¦å¯¹ç”¨æˆ·å¯è§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isVisibleToUser = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“ä½¿ç”¨ViewPager+Fragmentå½¢å¼ä¼šè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼ŒsetUserVisibleHintä¼šä¼˜å…ˆFragmentç”Ÿå‘½å‘¨æœŸå‡½æ•°è°ƒç”¨ï¼Œ</span></span><br><span class="line"><span class="comment">     * æ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±,ä¼šå¯¼è‡´åœ¨setUserVisibleHintæ–¹æ³•æ‰§è¡Œæ—¶å°±æ‰§è¡Œäº†æ‡’åŠ è½½ï¼Œ</span></span><br><span class="line"><span class="comment">     * è€Œä¸æ˜¯åœ¨onResumeæ–¹æ³•å®é™…è°ƒç”¨çš„æ—¶å€™æ‰§è¡Œæ‡’åŠ è½½ã€‚æ‰€ä»¥éœ€è¦è¿™ä¸ªå˜é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isCallResume = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦è°ƒç”¨äº†setUserVisibleHintæ–¹æ³•ã€‚å¤„ç†show+add+hideæ¨¡å¼ä¸‹ï¼Œé»˜è®¤å¯è§ Fragment ä¸è°ƒç”¨</span></span><br><span class="line"><span class="comment">     * onHiddenChanged æ–¹æ³•ï¼Œè¿›è€Œä¸æ‰§è¡Œæ‡’åŠ è½½æ–¹æ³•çš„é—®é¢˜ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isCallUserVisibleHint = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResume</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume()</span><br><span class="line">        isCallResume = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">if</span> (!isCallUserVisibleHint) isVisibleToUser = !isHidden</span><br><span class="line">        judgeLazyInit()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">judgeLazyInit</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isLoaded &amp;&amp; isVisibleToUser &amp;&amp; isCallResume) &#123;</span><br><span class="line">            lazyInit()</span><br><span class="line">            Log.d(TAG, <span class="string">"lazyInit:!!!!!!!"</span>)</span><br><span class="line">            isLoaded = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onHiddenChanged</span><span class="params">(hidden: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onHiddenChanged(hidden)</span><br><span class="line">        isVisibleToUser = !hidden</span><br><span class="line">        judgeLazyInit()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroyView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroyView()</span><br><span class="line">        isLoaded = <span class="literal">false</span></span><br><span class="line">        isVisibleToUser = <span class="literal">false</span></span><br><span class="line">        isCallUserVisibleHint = <span class="literal">false</span></span><br><span class="line">        isCallResume = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setUserVisibleHint</span><span class="params">(isVisibleToUser: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.setUserVisibleHint(isVisibleToUser)</span><br><span class="line">        <span class="keyword">this</span>.isVisibleToUser = isVisibleToUser</span><br><span class="line">        isCallUserVisibleHint = <span class="literal">true</span></span><br><span class="line">        judgeLazyInit()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">lazyInit</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Androidx-ä¸‹çš„æ‡’åŠ è½½"><a href="#Androidx-ä¸‹çš„æ‡’åŠ è½½" class="headerlink" title="Androidx ä¸‹çš„æ‡’åŠ è½½"></a>Androidx ä¸‹çš„æ‡’åŠ è½½</h3><p>è™½ç„¶ä¹‹å‰çš„æ–¹æ¡ˆå°±èƒ½è§£å†³è½»æ¾çš„è§£å†³ Fragment çš„æ‡’åŠ è½½ï¼Œä½†è¿™å¥—æ–¹æ¡ˆæœ‰ä¸€ä¸ªæœ€å¤§çš„å¼Šç«¯ï¼Œ<code>å°±æ˜¯ä¸å¯è§çš„ Fragment æ‰§è¡Œäº† onResume() æ–¹æ³•</code>ã€‚onResume æ–¹æ³•è®¾è®¡çš„åˆè¡·ï¼Œéš¾é“ä¸æ˜¯å½“å‰ Fragment å¯ä»¥å’Œç”¨æˆ·è¿›è¡Œäº¤äº’å—ï¼Ÿä½ ä»–å¦ˆæ—¢ä¸å¯è§ï¼Œåˆä¸èƒ½å’Œç”¨æˆ·è¿›è¡Œäº¤äº’ï¼Œä½ æ‰§è¡Œ onResume æ–¹æ³•å¹²å˜›ï¼Ÿ</p>
<p>åŸºäºæ­¤é—®é¢˜ï¼ŒGoogle åœ¨ Androidx åœ¨ <code>FragmentTransaction</code> ä¸­å¢åŠ äº† <code>setMaxLifecycle</code> æ–¹æ³•æ¥æ§åˆ¶ Fragment æ‰€èƒ½è°ƒç”¨çš„æœ€å¤§çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Set a ceiling for the state of an active fragment in this FragmentManager. If fragment is</span></span><br><span class="line"><span class="comment">  * already above the received state, it will be forced down to the correct state.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * &lt;p&gt;The fragment provided must currently be added to the FragmentManager to have it's</span></span><br><span class="line"><span class="comment">  * Lifecycle state capped, or previously added as part of this transaction. The</span></span><br><span class="line"><span class="comment">  * &#123;<span class="doctag">@link</span> Lifecycle.State&#125; passed in must at least be &#123;<span class="doctag">@link</span> Lifecycle.State#CREATED&#125;, otherwise</span></span><br><span class="line"><span class="comment">  * an &#123;<span class="doctag">@link</span> IllegalArgumentException&#125; will be thrown.&lt;/p&gt;</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> fragment the fragment to have it's state capped.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> state the ceiling state for the fragment.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> the same FragmentTransaction instance</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@NonNull</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> FragmentTransaction <span class="title">setMaxLifecycle</span><span class="params">(@NonNull Fragment fragment,</span></span></span><br><span class="line"><span class="function"><span class="params">         @NonNull Lifecycle.State state)</span> </span>&#123;</span><br><span class="line">     addOp(<span class="keyword">new</span> Op(OP_SET_MAX_LIFECYCLE, fragment, state));</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®å®˜æ–¹çš„æ³¨é‡Šï¼Œæˆ‘ä»¬èƒ½çŸ¥é“ï¼Œè¯¥æ–¹æ³•å¯ä»¥è®¾ç½®æ´»è·ƒçŠ¶æ€ä¸‹ Fragment æœ€å¤§çš„çŠ¶æ€ï¼Œå¦‚æœè¯¥ Fragment è¶…è¿‡äº†è®¾ç½®çš„æœ€å¤§çŠ¶æ€ï¼Œé‚£ä¹ˆä¼šå¼ºåˆ¶å°† Fragment é™çº§åˆ°æ­£ç¡®çš„çŠ¶æ€ã€‚</p>
<p>é‚£å¦‚ä½•ä½¿ç”¨è¯¥æ–¹æ³•å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹è¯¥æ–¹æ³•åœ¨ Androidx æ¨¡å¼ä¸‹ ViewPager+Fragment æ¨¡å¼ä¸‹çš„ä½¿ç”¨ä¾‹å­ã€‚</p>
<h4 id="ViewPager-Fragment-æ¨¡å¼ä¸‹çš„æ–¹æ¡ˆ"><a href="#ViewPager-Fragment-æ¨¡å¼ä¸‹çš„æ–¹æ¡ˆ" class="headerlink" title="ViewPager+Fragment æ¨¡å¼ä¸‹çš„æ–¹æ¡ˆ"></a>ViewPager+Fragment æ¨¡å¼ä¸‹çš„æ–¹æ¡ˆ</h4><p>åœ¨ FragmentPagerAdapter ä¸ FragmentStatePagerAdapter æ–°å¢äº†å«æœ‰  <code>behavior</code> å­—æ®µçš„æ„é€ å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FragmentPagerAdapter</span><span class="params">(@NonNull FragmentManager fm,</span></span></span><br><span class="line"><span class="function"><span class="params">          @Behavior <span class="keyword">int</span> behavior)</span> </span>&#123;</span><br><span class="line">      mFragmentManager = fm;</span><br><span class="line">      mBehavior = behavior;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FragmentStatePagerAdapter</span><span class="params">(@NonNull FragmentManager fm,</span></span></span><br><span class="line"><span class="function"><span class="params">          @Behavior <span class="keyword">int</span> behavior)</span> </span>&#123;</span><br><span class="line">      mFragmentManager = fm;</span><br><span class="line">      mBehavior = behavior;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ Behavior çš„å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line"> <span class="meta">@IntDef</span>(&#123;BEHAVIOR_SET_USER_VISIBLE_HINT, BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT&#125;)</span><br><span class="line"> <span class="keyword">private</span> <span class="meta">@interface</span> Behavior &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Indicates that &#123;<span class="doctag">@link</span> Fragment#setUserVisibleHint(boolean)&#125; will be called when the current</span></span><br><span class="line"><span class="comment">  * fragment changes.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@deprecated</span> This behavior relies on the deprecated</span></span><br><span class="line"><span class="comment">  * &#123;<span class="doctag">@link</span> Fragment#setUserVisibleHint(boolean)&#125; API. Use</span></span><br><span class="line"><span class="comment">  * &#123;<span class="doctag">@link</span> #BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT&#125; to switch to its replacement,</span></span><br><span class="line"><span class="comment">  * &#123;<span class="doctag">@link</span> FragmentTransaction#setMaxLifecycle&#125;.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@see</span> #FragmentPagerAdapter(FragmentManager, int)</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Deprecated</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BEHAVIOR_SET_USER_VISIBLE_HINT = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Indicates that only the current fragment will be in the &#123;<span class="doctag">@link</span> Lifecycle.State#RESUMED&#125;</span></span><br><span class="line"><span class="comment">  * state. All other Fragments are capped at &#123;<span class="doctag">@link</span> Lifecycle.State#STARTED&#125;.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@see</span> #FragmentPagerAdapter(FragmentManager, int)</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>ä»å®˜æ–¹çš„æ³¨é‡Šå£°æ˜ä¸­ï¼Œæˆ‘ä»¬èƒ½å¾—åˆ°å¦‚ä¸‹ä¸¤æ¡ç»“è®ºï¼š</p>
<ul>
<li>å¦‚æœ behavior çš„å€¼ä¸º <code>BEHAVIOR_SET_USER_VISIBLE_HINT</code>ï¼Œé‚£ä¹ˆå½“ Fragment å¯¹ç”¨æˆ·çš„å¯è§çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œ<code>setUserVisibleHint</code> æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</li>
<li>å¦‚æœ behavior çš„å€¼ä¸º <code>BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT</code> ï¼Œé‚£ä¹ˆå½“å‰é€‰ä¸­çš„ Fragment åœ¨ <code>Lifecycle.State#RESUMED</code> çŠ¶æ€ ï¼Œå…¶ä»–ä¸å¯è§çš„ Fragment ä¼šè¢«é™åˆ¶åœ¨ <code>Lifecycle.State#STARTED</code> çŠ¶æ€ã€‚</li>
</ul>
<p>é‚£ BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT è¿™ä¸ªå€¼åˆ°åº•æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<blockquote>
<p>åœ¨è¯¥ä¾‹å­ä¸­è®¾ç½®äº† ViewPager çš„é€‚é…å™¨ä¸º FragmentPagerAdapter ä¸” behavior å€¼ä¸º <code>BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT</code>ã€‚</p>
</blockquote>
<p>é»˜è®¤åˆå§‹åŒ–ViewPagerï¼ŒFragment ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/androix1.png" title="androix1">
<p>åˆ‡æ¢åˆ° Fragment_2 æ—¶ï¼Œæ—¥å¿—æƒ…å†µå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/androix2.png" title="androix2">
<p>åˆ‡æ¢åˆ° Fragment_3 æ—¶ï¼Œæ—¥å¿—æƒ…å†µå¦‚ä¸‹æ‰€ç¤º:</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/androidx3.png" title="androidx3">
<blockquote>
<p>å› ä¸ºç¯‡å¹…çš„åŸå› ï¼Œæœ¬æ–‡æ²¡æœ‰åœ¨è®²è§£ FragmentStatePagerAdapter è®¾ç½® behavior ä¸‹çš„ä½¿ç”¨æƒ…å†µï¼Œä½†æ˜¯åŸç†ä»¥åŠç”Ÿå‘½å‘¨æœŸå‡½æ•°è°ƒç”¨æƒ…å†µä¸€æ ·ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥æ ¹æ®  <a href="https://github.com/AndyJennifer/AndroidxLazyLoad" target="_blank" rel="noopener">AndroidxLazyLoad</a> é¡¹ç›®è‡ªè¡Œæµ‹è¯•ã€‚</p>
</blockquote>
<p>è§‚å¯Ÿä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä½¿ç”¨äº† <code>BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT</code> åï¼Œç¡®å®åªæœ‰å½“å‰å¯è§çš„ Fragment è°ƒç”¨äº† onResume æ–¹æ³•ã€‚è€Œå¯¼è‡´äº§ç”Ÿè¿™ç§æ”¹å˜çš„åŸå› ï¼Œæ˜¯å› ä¸º FragmentPagerAdapter åœ¨å…¶ <code>setPrimaryItem</code> æ–¹æ³•ä¸­è°ƒç”¨äº† <code>setMaxLifecycle</code> æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrimaryItem</span><span class="params">(@NonNull ViewGroup container, <span class="keyword">int</span> position, @NonNull Object object)</span> </span>&#123;</span><br><span class="line">    Fragment fragment = (Fragment)object;</span><br><span class="line">    <span class="comment">//å¦‚æœå½“å‰çš„fragmentä¸æ˜¯å½“å‰é€‰ä¸­å¹¶å¯è§çš„Fragment,é‚£ä¹ˆå°±ä¼šè°ƒç”¨</span></span><br><span class="line">    <span class="comment">// setMaxLifecycle è®¾ç½®å…¶æœ€å¤§ç”Ÿå‘½å‘¨æœŸä¸º Lifecycle.State.STARTED</span></span><br><span class="line">    <span class="keyword">if</span> (fragment != mCurrentPrimaryItem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mCurrentPrimaryItem != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mCurrentPrimaryItem.setMenuVisibility(<span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (mBehavior == BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mCurTransaction == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    mCurTransaction = mFragmentManager.beginTransaction();</span><br><span class="line">                &#125;</span><br><span class="line">                mCurTransaction.setMaxLifecycle(mCurrentPrimaryItem, Lifecycle.State.STARTED);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                mCurrentPrimaryItem.setUserVisibleHint(<span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//å¯¹äºå…¶ä»–éå¯è§çš„Fragment,åˆ™è®¾ç½®å…¶æœ€å¤§ç”Ÿå‘½å‘¨æœŸä¸º</span></span><br><span class="line">    <span class="comment">//Lifecycle.State.RESUMED</span></span><br><span class="line">        fragment.setMenuVisibility(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (mBehavior == BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mCurTransaction == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mCurTransaction = mFragmentManager.beginTransaction();</span><br><span class="line">            &#125;</span><br><span class="line">            mCurTransaction.setMaxLifecycle(fragment, Lifecycle.State.RESUMED);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fragment.setUserVisibleHint(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mCurrentPrimaryItem = fragment;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ—¢ç„¶åœ¨ä¸Šè¿°æ¡ä»¶ä¸‹ï¼Œåªæœ‰å®é™…å¯è§çš„ Fragment ä¼šè°ƒç”¨ onResume æ–¹æ³•ï¼Œ é‚£æ˜¯ä¸æ˜¯ä¸ºæˆ‘ä»¬æä¾›äº† ViewPager ä¸‹å®ç°æ‡’åŠ è½½çš„æ–°æ€è·¯å‘¢ï¼Ÿä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç° Fragment çš„æ‡’åŠ è½½ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isLoaded = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResume</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume()</span><br><span class="line">        <span class="keyword">if</span> (!isLoaded) &#123;</span><br><span class="line">            lazyInit()</span><br><span class="line">            Log.d(TAG, <span class="string">"lazyInit:!!!!!!!"</span>)</span><br><span class="line">            isLoaded = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroyView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroyView()</span><br><span class="line">        isLoaded = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">lazyInit</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="add-show-hide-æ¨¡å¼ä¸‹çš„æ–°æ–¹æ¡ˆ"><a href="#add-show-hide-æ¨¡å¼ä¸‹çš„æ–°æ–¹æ¡ˆ" class="headerlink" title="add+show+hide æ¨¡å¼ä¸‹çš„æ–°æ–¹æ¡ˆ"></a>add+show+hide æ¨¡å¼ä¸‹çš„æ–°æ–¹æ¡ˆ</h4><p>è™½ç„¶æˆ‘ä»¬å®ç°äº†Androidx åŒ…ä¸‹ ViewPagerä¸‹çš„æ‡’åŠ è½½ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶è¦è€ƒè™‘ add+show+hide æ¨¡å¼ä¸‹çš„ Fragment æ‡’åŠ è½½çš„æƒ…å†µï¼ŒåŸºäº ViewPager åœ¨ <code>setPrimaryItem</code> æ–¹æ³•ä¸­çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨ add+show+hide æ—¶ï¼Œè¿™æ ·å¤„ç†ï¼š</p>
<blockquote>
<p>å®Œæ•´çš„ä»£ç è¯·ç‚¹å‡»â€”&gt;<a href="https://github.com/AndyJennifer/AndroidxLazyLoad/blob/master/app/src/main/java/com/jennifer/andy/androidxlazyload/ext/ShowHideExt.kt" target="_blank" rel="noopener">ShowHideExt</a></p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨add+show+hideæ¨¡å¼åŠ è½½fragment</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * é»˜è®¤æ˜¾ç¤ºä½ç½®[showPosition]çš„Fragmentï¼Œæœ€å¤§Lifecycleä¸ºLifecycle.State.RESUMED</span></span><br><span class="line"><span class="comment"> * å…¶ä»–éšè—çš„Fragmentï¼Œæœ€å¤§Lifecycleä¸ºLifecycle.State.STARTED</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *<span class="doctag">@param</span> containerViewId å®¹å™¨id</span></span><br><span class="line"><span class="comment"> *<span class="doctag">@param</span> showPosition  fragments</span></span><br><span class="line"><span class="comment"> *<span class="doctag">@param</span> fragmentManager FragmentManager</span></span><br><span class="line"><span class="comment"> *<span class="doctag">@param</span> fragments  æ§åˆ¶æ˜¾ç¤ºçš„Fragments</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">loadFragmentsTransaction</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@IdRes</span> containerViewId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    showPosition: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    fragmentManager: <span class="type">FragmentManager</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">vararg</span> fragments: <span class="type">Fragment</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (fragments.isNotEmpty()) &#123;</span><br><span class="line">        fragmentManager.beginTransaction().apply &#123;</span><br><span class="line">            <span class="keyword">for</span> (index <span class="keyword">in</span> fragments.indices) &#123;</span><br><span class="line">                <span class="keyword">val</span> fragment = fragments[index]</span><br><span class="line">                add(containerViewId, fragment, fragment.javaClass.name)</span><br><span class="line">                <span class="keyword">if</span> (showPosition == index) &#123;</span><br><span class="line">                    setMaxLifecycle(fragment, Lifecycle.State.RESUMED)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    hide(fragment)</span><br><span class="line">                    setMaxLifecycle(fragment, Lifecycle.State.STARTED)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;.commit()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> IllegalStateException(</span><br><span class="line">            <span class="string">"fragments must not empty"</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** æ˜¾ç¤ºéœ€è¦æ˜¾ç¤ºçš„Fragment[showFragment]ï¼Œå¹¶è®¾ç½®å…¶æœ€å¤§Lifecycleä¸ºLifecycle.State.RESUMEDã€‚</span></span><br><span class="line"><span class="comment"> *  åŒæ—¶éšè—å…¶ä»–Fragment,å¹¶è®¾ç½®æœ€å¤§Lifecycleä¸ºLifecycle.State.STARTED</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fragmentManager</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> showFragment</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">showHideFragmentTransaction</span><span class="params">(fragmentManager: <span class="type">FragmentManager</span>, showFragment: <span class="type">Fragment</span>)</span></span> &#123;</span><br><span class="line">    fragmentManager.beginTransaction().apply &#123;</span><br><span class="line">        show(showFragment)</span><br><span class="line">        setMaxLifecycle(showFragment, Lifecycle.State.RESUMED)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–å…¶ä¸­æ‰€æœ‰çš„fragment,å…¶ä»–çš„fragmentè¿›è¡Œéšè—</span></span><br><span class="line">        <span class="keyword">val</span> fragments = fragmentManager.fragments</span><br><span class="line">        <span class="keyword">for</span> (fragment <span class="keyword">in</span> fragments) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fragment != showFragment) &#123;</span><br><span class="line">                hide(fragment)</span><br><span class="line">                setMaxLifecycle(fragment, Lifecycle.State.STARTED)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.commit()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç çš„å®ç°ä¹Ÿéå¸¸ç®€å•ï¼š</p>
<ul>
<li>å°†éœ€è¦æ˜¾ç¤ºçš„ Fragment ï¼Œåœ¨è°ƒç”¨ add æˆ– show æ–¹æ³•åï¼Œ<code>setMaxLifecycle(showFragment, Lifecycle.State.RESUMED)</code></li>
<li>å°†éœ€è¦éšè—çš„ Fragment ï¼Œåœ¨è°ƒç”¨ hide æ–¹æ³•åï¼Œ<code>setMaxLifecycle(fragment, Lifecycle.State.STARTED)</code></li>
</ul>
<p>ç»“åˆä¸Šè¿°æ“ä½œæ¨¡å¼ï¼ŒæŸ¥çœ‹ä½¿ç”¨ setMaxLifecycle åï¼ŒFragment ç”Ÿå‘½å‘¨æœŸå‡½æ•°è°ƒç”¨çš„æƒ…å†µã€‚</p>
<p>add Fragment_1ã€Fragment_2ã€Fragment_3ï¼Œå¹¶ hide Fragment_2,Fragment_3<br>:</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show_new1.png" title="show_new1">
<p>show Fragment_2ï¼Œhide å…¶ä»– Fragment:</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show_new2.png" title="show_new2">
<p>show Fragment_3 hide å…¶ä»– Fragment:</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/show_new3.png" title="show_new3">
<p>å‚è€ƒä¸Šå›¾ï¼Œå¥½åƒçœŸçš„ä¹Ÿèƒ½å¤„ç†æ‡’åŠ è½½ï¼ï¼ï¼ï¼ï¼ç¾æ»‹æ»‹</p>
<h4 id="å¹¶ä¸å®Œç¾çš„-setMaxLifecycle"><a href="#å¹¶ä¸å®Œç¾çš„-setMaxLifecycle" class="headerlink" title="å¹¶ä¸å®Œç¾çš„ setMaxLifecycle"></a>å¹¶ä¸å®Œç¾çš„ setMaxLifecycle</h4><p>å½“æˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨ setMaxLifycycle æ–¹æ³•æ—¶ï¼Œæˆ‘ä¹Ÿå’Œå¤§å®¶ä¸€æ ·è§‰å¾—ä¸‡äº‹å¤§å‰ã€‚ä½†è¿™å¥—æ–¹æ¡ˆä»ç„¶æœ‰ç‚¹ç‚¹ç‘•ç–µï¼Œå½“ Fragment çš„åµŒå¥—æ—¶ï¼Œå³ä½¿ä½¿ç”¨äº† setMaxLifycycle æ–¹æ³•ï¼Œç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ—¶ï¼ŒåŒçº§ä¸å¯è§çš„Fragmentï¼Œä»ç„¶ TMD è¦è°ƒç”¨å¯è§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<img src="/2020/01/19/Androidxä¸‹Fragmentçš„æ‡’åŠ è½½/ç‘•ç–µ.png" title="ç‘•ç–µ">
<p>ä¸çŸ¥é“æ˜¯å¦æ˜¯è°·æ­Œå¤§å¤§æ²¡æœ‰è€ƒè™‘åˆ° Fragment åµŒå¥—çš„æƒ…å†µï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¦å¯¹ä¹‹å‰çš„æ–¹æ¡ˆå°±è¡Œä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isLoaded = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResume</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume()</span><br><span class="line">        <span class="comment">//å¢åŠ äº†Fragmentæ˜¯å¦å¯è§çš„åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (!isLoaded &amp;&amp; !isHidden) &#123;</span><br><span class="line">            lazyInit()</span><br><span class="line">            Log.d(TAG, <span class="string">"lazyInit:!!!!!!!"</span>)</span><br><span class="line">            isLoaded = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroyView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroyView()</span><br><span class="line">        isLoaded = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">lazyInit</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå› ä¸ºåŒçº§çš„ Fragment åœ¨åµŒå¥—æ¨¡å¼ä¸‹ï¼Œä»ç„¶è¦è°ƒç”¨ onResume æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¢åŠ äº† Fragment å¯è§æ€§çš„åˆ¤æ–­ï¼Œè¿™æ ·å°±èƒ½ä¿è¯åµŒå¥—æ¨¡å¼ä¸‹ï¼Œæ–°æ–¹æ¡ˆä¹Ÿèƒ½å®Œç¾çš„æ”¯æŒ Fragment çš„æ‡’åŠ è½½ã€‚</p>
<h4 id="ViewPager2-çš„å¤„ç†æ–¹æ¡ˆ"><a href="#ViewPager2-çš„å¤„ç†æ–¹æ¡ˆ" class="headerlink" title="ViewPager2 çš„å¤„ç†æ–¹æ¡ˆ"></a>ViewPager2 çš„å¤„ç†æ–¹æ¡ˆ</h4><p>ViewPager2 æœ¬èº«å°±æ”¯æŒå¯¹å®é™…å¯è§çš„ Fragment æ‰è°ƒç”¨ onResume æ–¹æ³•ã€‚å…³äº ViewPager2 çš„å†…éƒ¨æœºåˆ¶ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹æºç ã€‚</p>
<p>å…³äº ViewPager2 çš„æ‡’åŠ è½½æµ‹è¯•ï¼Œå·²ä¸Šä¼ è‡³ <a href="https://github.com/AndyJennifer/AndroidxLazyLoad" target="_blank" rel="noopener">AndroidxLazyLoad</a>ï¼Œå¤§å®¶å¯ä»¥ç»“åˆé¡¹ç›®æŸ¥çœ‹Logæ—¥å¿—ã€‚</p>
<h3 id="ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”ä¸æ€»ç»“"><a href="#ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”ä¸æ€»ç»“" class="headerlink" title="ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”ä¸æ€»ç»“"></a>ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”ä¸æ€»ç»“</h3><h4 id="è€ä¸€å¥—çš„æ‡’åŠ è½½"><a href="#è€ä¸€å¥—çš„æ‡’åŠ è½½" class="headerlink" title="è€ä¸€å¥—çš„æ‡’åŠ è½½"></a>è€ä¸€å¥—çš„æ‡’åŠ è½½</h4><ul>
<li>ä¼˜ç‚¹ï¼šä¸ç”¨å»æ§åˆ¶ FragmentManagerçš„ add+show+hide æ–¹æ³•ï¼Œæ‰€æœ‰çš„æ‡’åŠ è½½éƒ½æ˜¯åœ¨Fragment å†…éƒ¨æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯æ§åˆ¶ <code>setUserVisibleHint + onHiddenChanged</code> è¿™ä¸¤ä¸ªå‡½æ•°ã€‚</li>
<li>ç¼ºç‚¹ï¼šå®é™…ä¸å¯è§çš„ Fragmentï¼Œå…¶ <code>onResume</code> æ–¹æ³•ä»»ç„¶ä¼šè¢«è°ƒç”¨ï¼Œè¿™ç§åå¸¸è§„çš„é€»è¾‘ï¼Œæ— æ³•å®¹å¿ã€‚</li>
</ul>
<h4 id="æ–°ä¸€å¥—çš„æ‡’åŠ è½½ï¼ˆAndroidxä¸‹setMaxLifecycleï¼‰"><a href="#æ–°ä¸€å¥—çš„æ‡’åŠ è½½ï¼ˆAndroidxä¸‹setMaxLifecycleï¼‰" class="headerlink" title="æ–°ä¸€å¥—çš„æ‡’åŠ è½½ï¼ˆAndroidxä¸‹setMaxLifecycleï¼‰"></a>æ–°ä¸€å¥—çš„æ‡’åŠ è½½ï¼ˆAndroidxä¸‹setMaxLifecycleï¼‰</h4><ul>
<li>ä¼˜ç‚¹ï¼š<code>åœ¨éç‰¹æ®Šçš„æƒ…å†µä¸‹(ç¼ºç‚¹1)</code>ï¼Œåªæœ‰å®é™…çš„å¯è§ Fragmentï¼Œå…¶ <code>onResume</code> æ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨ï¼Œè¿™æ ·æ‰ç¬¦åˆæ–¹æ³•è®¾è®¡çš„åˆè¡·ã€‚</li>
<li>ç¼ºç‚¹ï¼š<ol>
<li>å¯¹äº Fragment çš„åµŒå¥—ï¼ŒåŠæ—¶ä½¿ç”¨äº† <code>setMaxLifecycle</code> æ–¹æ³•ã€‚åŒçº§ä¸å¯è§çš„Fragmentï¼Œ ä»ç„¶è¦è°ƒç”¨ <code>onResume</code> æ–¹æ³•ã€‚</li>
<li>éœ€è¦åœ¨åŸæœ‰çš„ add+show+hide æ–¹æ³•ä¸­ï¼Œç»§ç»­è°ƒç”¨ setMaxLifecycle æ–¹æ³•æ¥æ§åˆ¶Fragment çš„æœ€å¤§ç”Ÿå‘½çŠ¶æ€ã€‚</li>
</ol>
</li>
</ul>
<h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>è¿™ä¸¤ç§æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹å·²ç»éå¸¸æ˜æ˜¾äº†ï¼Œåˆ°åº•è¯¥é€‰æ‹©ä½•ç§æ‡’åŠ è½½æ¨¡å¼ï¼Œè¿˜æ˜¯è¦åŸºäºå¤§å®¶çš„æ„æ„¿ï¼Œä½œè€…æˆ‘æ›´å€¾å‘äºä½¿ç”¨æ–°çš„æ–¹æ¡ˆã€‚å…³äº Fragment çš„æ‡’åŠ è½½å®ç°ï¼Œéå¸¸æ„¿æ„å¬åˆ°å¤§å®¶ä¸åŒçš„å£°éŸ³ï¼Œå¦‚æœä½ æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºç•™ä¸‹æ‚¨çš„ ideaï¼ŒæœŸå¾…æ‚¨çš„å›å¤ã€‚å¦‚æœæ‚¨è§‰å¾—æœ¬ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¯·ä¸è¦åå•¬ä½ çš„å…³æ³¨ä¸ç‚¹èµã€‚áƒ¦( Â´ï½¥á´—ï½¥` )æ¯”å¿ƒ</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/æ‡’åŠ è½½/" rel="tag"># æ‡’åŠ è½½</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/10/23/Android-æ³¨è§£ç³»åˆ—ä¹‹EventBus3åŸç†ï¼ˆå››ï¼‰/" rel="next" title="Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰">
                <i class="fa fa-chevron-left"></i> Android æ³¨è§£ç³»åˆ—ä¹‹ EventBus3 åŸç†ï¼ˆå››ï¼‰
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://upload-images.jianshu.io/upload_images/2824145-e320240ea6ec767d.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AndyJennifer">
            
              <p class="site-author-name" itemprop="name">AndyJennifer</p>
              <p class="site-description motion-element" itemprop="description">AndyJennifer ä¸ªäººç«™ï¼Œä¸»è¦æ¶‰åŠAndroidã€Javaã€Kotlinç­‰ç›¸å…³çŸ¥è¯†ï¼Œæ„¿ä¸å¤§å®¶å…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">58</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">18</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/AndyJennifer" title="GitHub &rarr; https://github.com/AndyJennifer" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="/andyjennifer@126.com" title="E-Mail &rarr; andyjennifer@126.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#å‰è¨€"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è€çš„æ‡’åŠ è½½å¤„ç†æ–¹æ¡ˆ"><span class="nav-number">2.</span> <span class="nav-text">è€çš„æ‡’åŠ è½½å¤„ç†æ–¹æ¡ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#add-show-hide-æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ"><span class="nav-number">2.1.</span> <span class="nav-text">add+show+hide æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ViewPager-Fragment-æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ"><span class="nav-number">2.2.</span> <span class="nav-text">ViewPager+Fragment æ¨¡å¼ä¸‹çš„è€æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤æ‚-Fragment-åµŒå¥—çš„æƒ…å†µ"><span class="nav-number">2.3.</span> <span class="nav-text">å¤æ‚ Fragment åµŒå¥—çš„æƒ…å†µ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Androidx-ä¸‹çš„æ‡’åŠ è½½"><span class="nav-number">3.</span> <span class="nav-text">Androidx ä¸‹çš„æ‡’åŠ è½½</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ViewPager-Fragment-æ¨¡å¼ä¸‹çš„æ–¹æ¡ˆ"><span class="nav-number">3.1.</span> <span class="nav-text">ViewPager+Fragment æ¨¡å¼ä¸‹çš„æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#add-show-hide-æ¨¡å¼ä¸‹çš„æ–°æ–¹æ¡ˆ"><span class="nav-number">3.2.</span> <span class="nav-text">add+show+hide æ¨¡å¼ä¸‹çš„æ–°æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¹¶ä¸å®Œç¾çš„-setMaxLifecycle"><span class="nav-number">3.3.</span> <span class="nav-text">å¹¶ä¸å®Œç¾çš„ setMaxLifecycle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ViewPager2-çš„å¤„ç†æ–¹æ¡ˆ"><span class="nav-number">3.4.</span> <span class="nav-text">ViewPager2 çš„å¤„ç†æ–¹æ¡ˆ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”ä¸æ€»ç»“"><span class="nav-number">4.</span> <span class="nav-text">ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”ä¸æ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#è€ä¸€å¥—çš„æ‡’åŠ è½½"><span class="nav-number">4.1.</span> <span class="nav-text">è€ä¸€å¥—çš„æ‡’åŠ è½½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ–°ä¸€å¥—çš„æ‡’åŠ è½½ï¼ˆAndroidxä¸‹setMaxLifecycleï¼‰"><span class="nav-number">4.2.</span> <span class="nav-text">æ–°ä¸€å¥—çš„æ‡’åŠ è½½ï¼ˆAndroidxä¸‹setMaxLifecycleï¼‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æœ€å"><span class="nav-number">5.</span> <span class="nav-text">æœ€å</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AndyJennifer</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="ç«™ç‚¹æ€»å­—æ•°">584k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">17:41</span>
  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="æ€»è®¿å®¢é‡">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="æ€»è®¿é—®é‡">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>


  
  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
